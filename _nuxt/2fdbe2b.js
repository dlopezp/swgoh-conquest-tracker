/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{955:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return $u})),n.d(e,"b",(function(){return Bc})),n.d(e,"c",(function(){return Ac})),n.d(e,"d",(function(){return pc})),n.d(e,"e",(function(){return bu})),n.d(e,"f",(function(){return jc})),n.d(e,"g",(function(){return C})),n.d(e,"h",(function(){return Gc})),n.d(e,"i",(function(){return Iu})),n.d(e,"j",(function(){return Tu})),n.d(e,"k",(function(){return $})),n.d(e,"l",(function(){return Hu})),n.d(e,"m",(function(){return lt})),n.d(e,"n",(function(){return pt})),n.d(e,"o",(function(){return J})),n.d(e,"p",(function(){return lc})),n.d(e,"q",(function(){return q})),n.d(e,"r",(function(){return tt})),n.d(e,"s",(function(){return E})),n.d(e,"t",(function(){return ac})),n.d(e,"u",(function(){return ah})),n.d(e,"v",(function(){return yh})),n.d(e,"w",(function(){return ph})),n.d(e,"x",(function(){return Lc})),n.d(e,"y",(function(){return vc})),n.d(e,"z",(function(){return bc})),n.d(e,"A",(function(){return mc})),n.d(e,"B",(function(){return oh})),n.d(e,"C",(function(){return gh})),n.d(e,"D",(function(){return Fc})),n.d(e,"E",(function(){return Ic})),n.d(e,"F",(function(){return kc})),n.d(e,"G",(function(){return Oc})),n.d(e,"H",(function(){return Mc})),n.d(e,"I",(function(){return Uu})),n.d(e,"J",(function(){return qu})),n.d(e,"K",(function(){return Cc})),n.d(e,"L",(function(){return hh})),n.d(e,"M",(function(){return Yu})),n.d(e,"N",(function(){return Ju})),n.d(e,"O",(function(){return Zu})),n.d(e,"P",(function(){return eh})),n.d(e,"Q",(function(){return nh})),n.d(e,"R",(function(){return sh})),n.d(e,"S",(function(){return wh})),n.d(e,"T",(function(){return Ru})),n.d(e,"U",(function(){return Lu})),n.d(e,"V",(function(){return Vc})),n.d(e,"W",(function(){return qc})),n.d(e,"X",(function(){return ch})),n.d(e,"Y",(function(){return uh})),n.d(e,"Z",(function(){return ku})),n.d(e,"ab",(function(){return Au})),n.d(e,"bb",(function(){return Ec})),n.d(e,"cb",(function(){return Tc})),n.d(e,"db",(function(){return fh})),n.d(e,"eb",(function(){return mh})),n.d(e,"fb",(function(){return rh})),n.d(e,"gb",(function(){return v})),n.d(e,"hb",(function(){return Su})),n.d(e,"ib",(function(){return Fu})),n.d(e,"jb",(function(){return Mu})),n.d(e,"kb",(function(){return ih})),n.d(e,"lb",(function(){return Pc})),n.d(e,"mb",(function(){return Cu}));var r=n(907),o=n(901),c=n(909),h=n(900),l=n(956);const d="@firebase/firestore";class f{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}f.UNAUTHENTICATED=new f(null),f.GOOGLE_CREDENTIALS=new f("google-credentials-uid"),f.FIRST_PARTY=new f("first-party-uid"),f.MOCK_USER=new f("mock-user");let m="9.6.7";const y=new c.b("@firebase/firestore");function w(){return y.logLevel}function v(t){y.setLogLevel(t)}function I(t,...e){if(y.logLevel<=c.a.DEBUG){const n=e.map(S);y.debug(`Firestore (${m}): ${t}`,...n)}}function T(t,...e){if(y.logLevel<=c.a.ERROR){const n=e.map(S);y.error(`Firestore (${m}): ${t}`,...n)}}function E(t,...e){if(y.logLevel<=c.a.WARN){const n=e.map(S);y.warn(`Firestore (${m}): ${t}`,...n)}}function S(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _(t="Unexpected state"){const e=`FIRESTORE (${m}) INTERNAL ASSERTION FAILED: `+t;throw T(e),new Error(e)}function x(t,e){t||_()}function q(t,e){t||_()}function A(t,e){return t}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends h.c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class D{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class k{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class O{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(f.UNAUTHENTICATED)))}shutdown(){}}class R{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class L{constructor(t){this.t=t,this.currentUser=f.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new D;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new D,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new D)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(x("string"==typeof e.accessToken),new k(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return x(null===t||"string"==typeof t),new f(t)}}class P{constructor(t,e,n){this.type="FirstParty",this.user=f.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const s=t.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class M{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new P(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(f.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class F{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class V{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const n=t=>{null!=t.error&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.p;return this.p=t.token,I("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?s(t):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(x("string"==typeof t.token),this.p=t.token,new F(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class U{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.I(t),this.T=t=>e.writeSequenceNumber(t))}I(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}function j(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}U.A=-1;class B{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=j(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function rt(t,e){return t<e?-1:t>e?1:0}function K(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}function G(t){return t+"\0"}class ${constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new C(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return $.fromMillis(Date.now())}static fromDate(t){return $.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new $(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?rt(this.nanoseconds,t.nanoseconds):rt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Q{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Q(t)}static min(){return new Q(new $(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function z(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function H(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function W(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class dt{constructor(t,e,n){void 0===e?e=0:e>t.length&&_(),void 0===n?n=t.length-e:n>t.length-e&&_(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===dt.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof dt?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Y extends dt{construct(t,e,n){return new Y(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new C(N.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const X=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class J extends dt{construct(t,e,n){return new J(t,e,n)}static isValidIdentifier(t){return X.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),J.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new J(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new C(N.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new C(N.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new C(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new C(N.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new J(e)}static emptyPath(){return new J([])}}class Z{constructor(t){this.fields=t,t.sort(J.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return K(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}function tt(){return"undefined"!=typeof atob}class et{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new et(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new et(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return rt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}et.EMPTY_BYTE_STRING=new et("");const nt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function st(t){if(x(!!t),"string"==typeof t){let e=0;const n=nt.exec(t);if(x(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:it(t.seconds),nanos:it(t.nanos)}}function it(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ot(t){return"string"==typeof t?et.fromBase64String(t):et.fromUint8Array(t)}function at(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ct(t){const e=t.mapValue.fields.__previous_value__;return at(e)?ct(e):e}function ut(t){const e=st(t.mapValue.fields.__local_write_time__.timestampValue);return new $(e.seconds,e.nanos)}class ht{constructor(t,e,n,s,i,r,o,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=c}}class lt{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new lt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof lt&&t.projectId===this.projectId&&t.database===this.database}}function ft(t){return null==t}function gt(t){return 0===t&&1/t==-1/0}function mt(t){return"number"==typeof t&&Number.isInteger(t)&&!gt(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class pt{constructor(t){this.path=t}static fromPath(t){return new pt(Y.fromString(t))}static fromName(t){return new pt(Y.fromString(t).popFirst(5))}static empty(){return new pt(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Y.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new pt(new Y(t.slice()))}}const yt={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function wt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?at(t)?4:10:_()}function vt(t,e){if(t===e)return!0;const n=wt(t);if(n!==wt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ut(t).isEqual(ut(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=st(t.timestampValue),s=st(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ot(t.bytesValue).isEqual(ot(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return it(t.geoPointValue.latitude)===it(e.geoPointValue.latitude)&&it(t.geoPointValue.longitude)===it(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return it(t.integerValue)===it(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=it(t.doubleValue),s=it(e.doubleValue);return n===s?gt(n)===gt(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return K(t.arrayValue.values||[],e.arrayValue.values||[],vt);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(z(n)!==z(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!vt(n[t],s[t])))return!1;return!0}(t,e);default:return _()}}function bt(t,e){return void 0!==(t.values||[]).find((t=>vt(t,e)))}function It(t,e){if(t===e)return 0;const n=wt(t),s=wt(e);if(n!==s)return rt(n,s);switch(n){case 0:return 0;case 1:return rt(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=it(t.integerValue||t.doubleValue),s=it(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Tt(t.timestampValue,e.timestampValue);case 4:return Tt(ut(t),ut(e));case 5:return rt(t.stringValue,e.stringValue);case 6:return function(t,e){const n=ot(t),s=ot(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=rt(n[t],s[t]);if(0!==e)return e}return rt(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=rt(it(t.latitude),it(e.latitude));return 0!==n?n:rt(it(t.longitude),it(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=It(n[t],s[t]);if(e)return e}return rt(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=rt(s[t],r[t]);if(0!==e)return e;const o=It(n[s[t]],i[r[t]]);if(0!==o)return o}return rt(s.length,r.length)}(t.mapValue,e.mapValue);default:throw _()}}function Tt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return rt(t,e);const n=st(t),s=st(e),i=rt(n.seconds,s.seconds);return 0!==i?i:rt(n.nanos,s.nanos)}function Et(t){return St(t)}function St(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=st(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ot(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,pt.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=St(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${St(t.fields[i])}`;return n+"}"}(t.mapValue):_();var e,n}function _t(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function xt(t){return!!t&&"integerValue"in t}function At(t){return!!t&&"arrayValue"in t}function Nt(t){return!!t&&"nullValue"in t}function Ct(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Dt(t){return!!t&&"mapValue"in t}function kt(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return H(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=kt(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=kt(t.arrayValue.values[n]);return e}return Object.assign({},t)}class Ot{constructor(t){this.value=t}static empty(){return new Ot({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Dt(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=kt(e)}setAll(t){let e=J.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=kt(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Dt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return vt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Dt(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){H(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ot(kt(this.value))}}function Rt(t){const e=[];return H(t.fields,((t,n)=>{const s=new J([t]);if(Dt(n)){const t=Rt(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new Z(e)}class Lt{constructor(t,e,n,s,i,r){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.data=i,this.documentState=r}static newInvalidDocument(t){return new Lt(t,0,Q.min(),Q.min(),Ot.empty(),0)}static newFoundDocument(t,e,n){return new Lt(t,1,e,Q.min(),n,0)}static newNoDocument(t,e){return new Lt(t,2,e,Q.min(),Ot.empty(),0)}static newUnknownDocument(t,e){return new Lt(t,3,e,Q.min(),Ot.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ot.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Lt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Lt(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Pt{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}Pt.UNKNOWN_ID=-1;class Mt{constructor(t,e){this.fieldPath=t,this.kind=e}}class Ft{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new Ft(0,Vt.min())}}class Vt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Vt(Q.min(),pt.empty(),-1)}}class qt{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.P=null}}function Ut(t,e=null,n=[],s=[],i=null,r=null,o=null){return new qt(t,e,n,s,i,r,o)}function jt(t){const e=A(t);if(null===e.P){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+Et(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),ft(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Et(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Et(t))).join(",")),e.P=t}return e.P}function Bt(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ee(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!vt(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!se(t.startAt,e.startAt)&&se(t.endAt,e.endAt)}function Kt(t){return pt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Gt extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.v(t,e,n):new $t(t,e,n):"array-contains"===e?new Wt(t,n):"in"===e?new Yt(t,n):"not-in"===e?new Xt(t,n):"array-contains-any"===e?new Jt(t,n):new Gt(t,e,n)}static v(t,e,n){return"in"===e?new Qt(t,n):new zt(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.V(It(e,this.value)):null!==e&&wt(this.value)===wt(e)&&this.V(It(e,this.value))}V(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class $t extends Gt{constructor(t,e,n){super(t,e,n),this.key=pt.fromName(n.referenceValue)}matches(t){const e=pt.comparator(t.key,this.key);return this.V(e)}}class Qt extends Gt{constructor(t,e){super(t,"in",e),this.keys=Ht("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class zt extends Gt{constructor(t,e){super(t,"not-in",e),this.keys=Ht("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Ht(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>pt.fromName(t.referenceValue)))}class Wt extends Gt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return At(e)&&bt(e.arrayValue,this.value)}}class Yt extends Gt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&bt(this.value.arrayValue,e)}}class Xt extends Gt{constructor(t,e){super(t,"not-in",e)}matches(t){if(bt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!bt(this.value.arrayValue,e)}}class Jt extends Gt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!At(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>bt(this.value.arrayValue,t)))}}class Zt{constructor(t,e){this.position=t,this.inclusive=e}}class te{constructor(t,e="asc"){this.field=t,this.dir=e}}function ee(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ne(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?pt.comparator(pt.fromName(o.referenceValue),n.key):It(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function se(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!vt(t.position[n],e.position[n]))return!1;return!0}class re{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=c,this.D=null,this.C=null,this.startAt,this.endAt}}function ie(t,e,n,s,i,r,o,c){return new re(t,e,n,s,i,r,o,c)}function oe(t){return new re(t)}function ae(t){return!ft(t.limit)&&"F"===t.limitType}function ce(t){return!ft(t.limit)&&"L"===t.limitType}function ue(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function he(t){for(const e of t.filters)if(e.S())return e.field;return null}function le(t){return null!==t.collectionGroup}function de(t){const e=A(t);if(null===e.D){e.D=[];const t=he(e),n=ue(e);if(null!==t&&null===n)t.isKeyField()||e.D.push(new te(t)),e.D.push(new te(J.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.D.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.D.push(new te(J.keyField(),t))}}}return e.D}function fe(t){const e=A(t);if(!e.C)if("F"===e.limitType)e.C=Ut(e.path,e.collectionGroup,de(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of de(e)){const e="desc"===n.dir?"asc":"desc";t.push(new te(n.field,e))}const n=e.endAt?new Zt(e.endAt.position,!e.endAt.inclusive):null,s=e.startAt?new Zt(e.startAt.position,!e.startAt.inclusive):null;e.C=Ut(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.C}function ge(t,e,n){return new re(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function me(t,e){return Bt(fe(t),fe(e))&&t.limitType===e.limitType}function pe(t){return`${jt(fe(t))}|lt:${t.limitType}`}function ye(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Et(e.value)}`;var e})).join(", ")}]`),ft(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Et(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Et(t))).join(",")),`Target(${e})`}(fe(t))}; limitType=${t.limitType})`}function we(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):pt.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=ne(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,de(t),e))&&!(t.endAt&&!function(t,e,n){const s=ne(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,de(t),e))}(t,e)}function ve(t){return(e,n)=>{let s=!1;for(const i of de(t)){const t=be(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function be(t,e,n){const s=t.field.isKeyField()?pt.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?It(s,i):_()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return _()}}function Ie(t,e){if(t.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gt(e)?"-0":e}}function Te(t){return{integerValue:""+t}}function Ee(t,e){return mt(e)?Te(e):Ie(t,e)}class Se{constructor(){this._=void 0}}function _e(t,e,n){return t instanceof Ne?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ce?De(t,e):t instanceof ke?Oe(t,e):function(t,e){const n=Ae(t,e),s=Le(n)+Le(t.k);return xt(n)&&xt(t.k)?Te(s):Ie(t.O,s)}(t,e)}function xe(t,e,n){return t instanceof Ce?De(t,e):t instanceof ke?Oe(t,e):n}function Ae(t,e){return t instanceof Re?xt(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Ne extends Se{}class Ce extends Se{constructor(t){super(),this.elements=t}}function De(t,e){const n=Pe(e);for(const e of t.elements)n.some((t=>vt(t,e)))||n.push(e);return{arrayValue:{values:n}}}class ke extends Se{constructor(t){super(),this.elements=t}}function Oe(t,e){let n=Pe(e);for(const e of t.elements)n=n.filter((t=>!vt(t,e)));return{arrayValue:{values:n}}}class Re extends Se{constructor(t,e){super(),this.O=t,this.k=e}}function Le(t){return it(t.integerValue||t.doubleValue)}function Pe(t){return At(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Me{constructor(t,e){this.field=t,this.transform=e}}class Fe{constructor(t,e){this.version=t,this.transformResults=e}}class Ve{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ve}static exists(t){return new Ve(void 0,t)}static updateTime(t){return new Ve(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function qe(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ue{}function je(t,e,n){t instanceof Qe?function(t,e,n){const s=t.value.clone(),i=We(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof ze?function(t,e,n){if(!qe(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=We(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(He(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Be(t,e,n){t instanceof Qe?function(t,e,n){if(!qe(t.precondition,e))return;const s=t.value.clone(),i=Ye(t.fieldTransforms,n,e);s.setAll(i),e.convertToFoundDocument($e(e),s).setHasLocalMutations()}(t,e,n):t instanceof ze?function(t,e,n){if(!qe(t.precondition,e))return;const s=Ye(t.fieldTransforms,n,e),i=e.data;i.setAll(He(t)),i.setAll(s),e.convertToFoundDocument($e(e),i).setHasLocalMutations()}(t,e,n):function(t,e){qe(t.precondition,e)&&e.convertToNoDocument(Q.min())}(t,e)}function Ke(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=Ae(s.transform,t||null);null!=i&&(null==n&&(n=Ot.empty()),n.set(s.field,i))}return n||null}function Ge(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&K(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ce&&e instanceof Ce||t instanceof ke&&e instanceof ke?K(t.elements,e.elements,vt):t instanceof Re&&e instanceof Re?vt(t.k,e.k):t instanceof Ne&&e instanceof Ne}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function $e(t){return t.isFoundDocument()?t.version:Q.min()}class Qe extends Ue{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}}class ze extends Ue{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}}function He(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function We(t,e,n){const s=new Map;x(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,c=e.data.field(r.field);s.set(r.field,xe(o,c,n[i]))}return s}function Ye(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,_e(t,r,e))}return s}class Xe extends Ue{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class Je extends Ue{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class Ze{constructor(t){this.count=t}}var tn,en;function nn(t){switch(t){default:return _();case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0}}function sn(t){if(void 0===t)return T("GRPC error has no .code"),N.UNKNOWN;switch(t){case tn.OK:return N.OK;case tn.CANCELLED:return N.CANCELLED;case tn.UNKNOWN:return N.UNKNOWN;case tn.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case tn.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case tn.INTERNAL:return N.INTERNAL;case tn.UNAVAILABLE:return N.UNAVAILABLE;case tn.UNAUTHENTICATED:return N.UNAUTHENTICATED;case tn.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case tn.NOT_FOUND:return N.NOT_FOUND;case tn.ALREADY_EXISTS:return N.ALREADY_EXISTS;case tn.PERMISSION_DENIED:return N.PERMISSION_DENIED;case tn.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case tn.ABORTED:return N.ABORTED;case tn.OUT_OF_RANGE:return N.OUT_OF_RANGE;case tn.UNIMPLEMENTED:return N.UNIMPLEMENTED;case tn.DATA_LOSS:return N.DATA_LOSS;default:return _()}}(en=tn||(tn={}))[en.OK=0]="OK",en[en.CANCELLED=1]="CANCELLED",en[en.UNKNOWN=2]="UNKNOWN",en[en.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",en[en.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",en[en.NOT_FOUND=5]="NOT_FOUND",en[en.ALREADY_EXISTS=6]="ALREADY_EXISTS",en[en.PERMISSION_DENIED=7]="PERMISSION_DENIED",en[en.UNAUTHENTICATED=16]="UNAUTHENTICATED",en[en.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",en[en.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",en[en.ABORTED=10]="ABORTED",en[en.OUT_OF_RANGE=11]="OUT_OF_RANGE",en[en.UNIMPLEMENTED=12]="UNIMPLEMENTED",en[en.INTERNAL=13]="INTERNAL",en[en.UNAVAILABLE=14]="UNAVAILABLE",en[en.DATA_LOSS=15]="DATA_LOSS";class rn{constructor(t,e){this.comparator=t,this.root=e||an.EMPTY}insert(t,e){return new rn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,an.BLACK,null,null))}remove(t){return new rn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,an.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new on(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new on(this.root,t,this.comparator,!1)}getReverseIterator(){return new on(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new on(this.root,t,this.comparator,!0)}}class on{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class an{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:an.RED,this.left=null!=s?s:an.EMPTY,this.right=null!=i?i:an.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new an(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return an.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return an.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,an.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,an.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _();if(this.right.isRed())throw _();const t=this.left.check();if(t!==this.right.check())throw _();return t+(this.isRed()?0:1)}}an.EMPTY=null,an.RED=!0,an.BLACK=!1,an.EMPTY=new class{constructor(){this.size=0}get key(){throw _()}get value(){throw _()}get color(){throw _()}get left(){throw _()}get right(){throw _()}copy(t,e,n,s,i){return this}insert(t,e,n){return new an(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class cn{constructor(t){this.comparator=t,this.data=new rn(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new un(this.data.getIterator())}getIteratorFrom(t){return new un(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof cn))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new cn(this.comparator);return e.data=t,e}}class un{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function hn(t){return t.hasNext()?t.getNext():void 0}const ln=new rn(pt.comparator);function dn(){return ln}const fn=new rn(pt.comparator);function gn(){return fn}const mn=new rn(pt.comparator),pn=new cn(pt.comparator);function yn(...t){let e=pn;for(const n of t)e=e.add(n);return e}const wn=new cn(rt);function vn(){return wn}class bn{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,In.createSynthesizedTargetChangeForCurrentChange(t,e)),new bn(Q.min(),n,vn(),dn(),yn())}}class In{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new In(et.EMPTY_BYTE_STRING,e,yn(),yn(),yn())}}class Tn{constructor(t,e,n,s){this.M=t,this.removedTargetIds=e,this.key=n,this.$=s}}class En{constructor(t,e){this.targetId=t,this.F=e}}class Sn{constructor(t,e,n=et.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class _n{constructor(){this.B=0,this.L=Nn(),this.U=et.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(t){t.approximateByteSize()>0&&(this.K=!0,this.U=t)}H(){let t=yn(),e=yn(),n=yn();return this.L.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:_()}})),new In(this.U,this.q,t,e,n)}J(){this.K=!1,this.L=Nn()}Y(t,e){this.K=!0,this.L=this.L.insert(t,e)}X(t){this.K=!0,this.L=this.L.remove(t)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class xn{constructor(t){this.nt=t,this.st=new Map,this.it=dn(),this.rt=An(),this.ot=new cn(rt)}ct(t){for(const e of t.M)t.$&&t.$.isFoundDocument()?this.ut(e,t.$):this.at(e,t.key,t.$);for(const e of t.removedTargetIds)this.at(e,t.key,t.$)}ht(t){this.forEachTarget(t,(e=>{const n=this.lt(e);switch(t.state){case 0:this.ft(e)&&n.W(t.resumeToken);break;case 1:n.tt(),n.G||n.J(),n.W(t.resumeToken);break;case 2:n.tt(),n.G||this.removeTarget(e);break;case 3:this.ft(e)&&(n.et(),n.W(t.resumeToken));break;case 4:this.ft(e)&&(this.dt(e),n.W(t.resumeToken));break;default:_()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.st.forEach(((t,n)=>{this.ft(n)&&e(n)}))}_t(t){const e=t.targetId,n=t.F.count,s=this.wt(e);if(s){const t=s.target;if(Kt(t))if(0===n){const n=new pt(t.path);this.at(e,n,Lt.newNoDocument(n,Q.min()))}else x(1===n);else this.gt(e)!==n&&(this.dt(e),this.ot=this.ot.add(e))}}yt(t){const e=new Map;this.st.forEach(((n,s)=>{const i=this.wt(s);if(i){if(n.current&&Kt(i.target)){const e=new pt(i.target.path);null!==this.it.get(e)||this.It(s,e)||this.at(s,e,Lt.newNoDocument(e,t))}n.j&&(e.set(s,n.H()),n.J())}}));let n=yn();this.rt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.wt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.it.forEach(((e,n)=>n.setReadTime(t)));const s=new bn(t,e,this.ot,this.it,n);return this.it=dn(),this.rt=An(),this.ot=new cn(rt),s}ut(t,e){if(!this.ft(t))return;const n=this.It(t,e.key)?2:0;this.lt(t).Y(e.key,n),this.it=this.it.insert(e.key,e),this.rt=this.rt.insert(e.key,this.Et(e.key).add(t))}at(t,e,n){if(!this.ft(t))return;const s=this.lt(t);this.It(t,e)?s.Y(e,1):s.X(e),this.rt=this.rt.insert(e,this.Et(e).delete(t)),n&&(this.it=this.it.insert(e,n))}removeTarget(t){this.st.delete(t)}gt(t){const e=this.lt(t).H();return this.nt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Z(t){this.lt(t).Z()}lt(t){let e=this.st.get(t);return e||(e=new _n,this.st.set(t,e)),e}Et(t){let e=this.rt.get(t);return e||(e=new cn(rt),this.rt=this.rt.insert(t,e)),e}ft(t){const e=null!==this.wt(t);return e||I("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.st.get(t);return e&&e.G?null:this.nt.Tt(t)}dt(t){this.st.set(t,new _n),this.nt.getRemoteKeysForTarget(t).forEach((e=>{this.at(t,e,null)}))}It(t,e){return this.nt.getRemoteKeysForTarget(t).has(e)}}function An(){return new rn(pt.comparator)}function Nn(){return new rn(pt.comparator)}const Cn={asc:"ASCENDING",desc:"DESCENDING"},Dn={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class kn{constructor(t,e){this.databaseId=t,this.N=e}}function On(t,e){return t.N?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Rn(t,e){return t.N?e.toBase64():e.toUint8Array()}function Ln(t,e){return On(t,e.toTimestamp())}function Pn(t){return x(!!t),Q.fromTimestamp(function(t){const e=st(t);return new $(e.seconds,e.nanos)}(t))}function Mn(t,e){return function(t){return new Y(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Fn(t){const e=Y.fromString(t);return x(is(e)),e}function Vn(t,e){return Mn(t.databaseId,e.path)}function qn(t,e){const n=Fn(e);if(n.get(1)!==t.databaseId.projectId)throw new C(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new C(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new pt(Kn(n))}function Un(t,e){return Mn(t.databaseId,e)}function jn(t){const e=Fn(t);return 4===e.length?Y.emptyPath():Kn(e)}function Bn(t){return new Y(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Kn(t){return x(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Gn(t,e,n){return{name:Vn(t,e),fields:n.value.mapValue.fields}}function $n(t,e,n){const s=qn(t,e.name),i=Pn(e.updateTime),r=new Ot({mapValue:{fields:e.fields}}),o=Lt.newFoundDocument(s,i,r);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Qn(t,e){let n;if(e instanceof Qe)n={update:Gn(t,e.key,e.value)};else if(e instanceof Xe)n={delete:Vn(t,e.key)};else if(e instanceof ze)n={update:Gn(t,e.key,e.data),updateMask:rs(e.fieldMask)};else{if(!(e instanceof Je))return _();n={verify:Vn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ne)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ce)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ke)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Re)return{fieldPath:e.field.canonicalString(),increment:n.k};throw _()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ln(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_()}(t,e.precondition)),n}function zn(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Ve.updateTime(Pn(t.updateTime)):void 0!==t.exists?Ve.exists(t.exists):Ve.none()}(e.currentDocument):Ve.none(),s=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)x("REQUEST_TIME"===e.setToServerValue),n=new Ne;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ce(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new ke(t)}else"increment"in e?n=new Re(t,e.increment):_();const s=J.fromServerFormat(e.fieldPath);return new Me(s,n)}(t,e))):[];if(e.update){e.update.name;const i=qn(t,e.update.name),r=new Ot({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Z(e.map((t=>J.fromServerFormat(t))))}(e.updateMask);return new ze(i,r,t,n,s)}return new Qe(i,r,n,s)}if(e.delete){const s=qn(t,e.delete);return new Xe(s,n)}if(e.verify){const s=qn(t,e.verify);return new Je(s,n)}return _()}function Hn(t,e){return{documents:[Un(t,e.path)]}}function Wn(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=Un(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Un(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Ct(t.value))return{unaryFilter:{field:ts(t.field),op:"IS_NAN"}};if(Nt(t.value))return{unaryFilter:{field:ts(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ct(t.value))return{unaryFilter:{field:ts(t.field),op:"IS_NOT_NAN"}};if(Nt(t.value))return{unaryFilter:{field:ts(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ts(t.field),op:Zn(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:ts(t.field),direction:Jn(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.N||ft(e)?e:{value:e}}(t,e.limit);var c;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(c=e.startAt).inclusive,values:c.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Yn(t){let e=jn(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){x(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=Xn(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new te(es(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let c=null;n.limit&&(c=function(t){let e;return e="object"==typeof t?t.value:t,ft(e)?null:e}(n.limit));let u=null;n.startAt&&(u=function(t){const e=!!t.before,n=t.values||[];return new Zt(n,e)}(n.startAt));let a=null;return n.endAt&&(a=function(t){const e=!t.before,n=t.values||[];return new Zt(n,e)}(n.endAt)),ie(e,i,o,r,c,"F",u,a)}function Xn(t){return t?void 0!==t.unaryFilter?[ss(t)]:void 0!==t.fieldFilter?[ns(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Xn(t))).reduce(((t,e)=>t.concat(e))):_():[]}function Jn(t){return Cn[t]}function Zn(t){return Dn[t]}function ts(t){return{fieldPath:t.canonicalString()}}function es(t){return J.fromServerFormat(t.fieldPath)}function ns(t){return Gt.create(es(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _()}}(t.fieldFilter.op),t.fieldFilter.value)}function ss(t){switch(t.unaryFilter.op){case"IS_NAN":const e=es(t.unaryFilter.field);return Gt.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=es(t.unaryFilter.field);return Gt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=es(t.unaryFilter.field);return Gt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=es(t.unaryFilter.field);return Gt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return _()}}function rs(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function is(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function os(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=cs(e)),e=as(t.get(n),e);return cs(e)}function as(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function cs(t){return t+""}function us(t){const e=t.length;if(x(e>=2),2===e)return x(""===t.charAt(0)&&""===t.charAt(1)),Y.emptyPath();const n=e-2,s=[];let i="";for(let r=0;r<e;){const e=t.indexOf("",r);switch((e<0||e>n)&&_(),t.charAt(e+1)){case"":const n=t.substring(r,e);let o;0===i.length?o=n:(i+=n,o=i,i=""),s.push(o);break;case"":i+=t.substring(r,e),i+="\0";break;case"":i+=t.substring(r,e+1);break;default:_()}r=e+2}return new Y(s)}class hs{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class ls{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}ls.store="owner",ls.key="owner";class ds{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}ds.store="mutationQueues",ds.keyPath="userId";class fs{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}fs.store="mutations",fs.keyPath="batchId",fs.userMutationsIndex="userMutationsIndex",fs.userMutationsKeyPath=["userId","batchId"];class gs{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,os(e)]}static key(t,e,n){return[t,os(e),n]}}gs.store="documentMutations",gs.PLACEHOLDER=new gs;class ms{constructor(t,e){this.path=t,this.readTime=e}}class ps{constructor(t,e){this.path=t,this.version=e}}class ys{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}ys.store="remoteDocuments",ys.readTimeIndex="readTimeIndex",ys.readTimeIndexPath="readTime",ys.collectionReadTimeIndex="collectionReadTimeIndex",ys.collectionReadTimeIndexPath=["parentPath","readTime"];class ws{constructor(t){this.byteSize=t}}ws.store="remoteDocumentGlobal",ws.key="remoteDocumentGlobalKey";class vs{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}vs.store="targets",vs.keyPath="targetId",vs.queryTargetsIndexName="queryTargetsIndex",vs.queryTargetsKeyPath=["canonicalId","targetId"];class bs{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}bs.store="targetDocuments",bs.keyPath=["targetId","path"],bs.documentTargetsIndex="documentTargetsIndex",bs.documentTargetsKeyPath=["path","targetId"];class Is{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}Is.key="targetGlobalKey",Is.store="targetGlobal";class Ts{constructor(t,e){this.collectionId=t,this.parent=e}}Ts.store="collectionParents",Ts.keyPath=["collectionId","parent"];class Es{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}Es.store="clientMetadata",Es.keyPath="clientId";class Ss{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}Ss.store="bundles",Ss.keyPath="bundleId";class _s{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}_s.store="namedQueries",_s.keyPath="name";class xs{constructor(t,e,n){this.indexId=t,this.collectionGroup=e,this.fields=n}}xs.store="indexConfiguration",xs.keyPath="indexId",xs.collectionGroupIndex="collectionGroupIndex",xs.collectionGroupIndexPath="collectionGroup";class As{constructor(t,e,n,s,i,r){this.indexId=t,this.uid=e,this.sequenceNumber=n,this.readTime=s,this.documentKey=i,this.largestBatchId=r}}As.store="indexState",As.keyPath=["indexId","uid"],As.sequenceNumberIndex="sequenceNumberIndex",As.sequenceNumberIndexPath=["uid","sequenceNumber"];class Ns{constructor(t,e,n,s,i){this.indexId=t,this.uid=e,this.arrayValue=n,this.directionalValue=s,this.documentKey=i}}Ns.store="indexEntries",Ns.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],Ns.documentKeyIndex="documentKeyIndex",Ns.documentKeyIndexPath=["indexId","uid","documentKey"];class Cs{constructor(t,e,n,s,i,r){this.userId=t,this.collectionPath=e,this.documentId=n,this.collectionGroup=s,this.largestBatchId=i,this.overlayMutation=r}}Cs.store="documentOverlays",Cs.keyPath=["userId","collectionPath","documentId"],Cs.collectionPathOverlayIndex="collectionPathOverlayIndex",Cs.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],Cs.collectionGroupOverlayIndex="collectionGroupOverlayIndex",Cs.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];const Ds=[ds.store,fs.store,gs.store,ys.store,vs.store,ls.store,Is.store,bs.store,Es.store,ws.store,Ts.store,Ss.store,_s.store],ks=[...Ds,Cs.store],Os=[...ks,xs.store,As.store,Ns.store],Rs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ls{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class Ps{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&_(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ps(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Ps?e:Ps.resolve(e)}catch(t){return Ps.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Ps.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Ps.reject(e)}static resolve(t){return new Ps(((e,n)=>{e(t)}))}static reject(t){return new Ps(((e,n)=>{n(t)}))}static waitFor(t){return new Ps(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=Ps.resolve(!1);for(const n of t)e=e.next((t=>t?Ps.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}}class Ms{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.At=new D,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{e.error?this.At.reject(new qs(t,e.error)):this.At.resolve()},this.transaction.onerror=e=>{const n=Ks(e.target.error);this.At.reject(new qs(t,n))}}static open(t,e,n,s){try{return new Ms(e,t.transaction(s,n))}catch(t){throw new qs(e,t)}}get Rt(){return this.At.promise}abort(t){t&&this.At.reject(t),this.aborted||(I("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new js(e)}}class Fs{constructor(t,e,n){this.name=t,this.version=e,this.bt=n,12.2===Fs.vt(Object(h.n)())&&T("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return I("SimpleDb","Removing database:",t),Bs(window.indexedDB.deleteDatabase(t)).toPromise()}static Vt(){if(!Object(h.t)())return!1;if(Fs.St())return!0;const t=Object(h.n)(),e=Fs.vt(t),n=0<e&&e<10,s=Fs.Dt(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static St(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Ct)}static Nt(t,e){return t.store(e)}static vt(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Dt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async xt(t){return this.db||(I("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new qs(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new C(N.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new C(N.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new qs(t,s))},s.onupgradeneeded=t=>{I("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.bt.kt(e,s.transaction,t.oldVersion,this.version).next((()=>{I("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Ot&&(this.db.onversionchange=t=>this.Ot(t)),this.db}Mt(t){this.Ot=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i="readonly"===e;let r=0;for(;;){++r;try{this.db=await this.xt(t);const e=Ms.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).next((t=>(e.Pt(),t))).catch((t=>(e.abort(t),Ps.reject(t)))).toPromise();return r.catch((()=>{})),await e.Rt,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(I("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Vs{constructor(t){this.$t=t,this.Ft=!1,this.Bt=null}get isDone(){return this.Ft}get Lt(){return this.Bt}set cursor(t){this.$t=t}done(){this.Ft=!0}Ut(t){this.Bt=t}delete(){return Bs(this.$t.delete())}}class qs extends C{constructor(t,e){super(N.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Us(t){return"IndexedDbTransactionError"===t.name}class js{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(I("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Bs(n)}add(t){return I("SimpleDb","ADD",this.store.name,t,t),Bs(this.store.add(t))}get(t){return Bs(this.store.get(t)).next((e=>(void 0===e&&(e=null),I("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return I("SimpleDb","DELETE",this.store.name,t),Bs(this.store.delete(t))}count(){return I("SimpleDb","COUNT",this.store.name),Bs(this.store.count())}qt(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.Kt(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new Ps(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}Gt(t,e){I("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.jt=!1;const s=this.cursor(n);return this.Kt(s,((t,e,n)=>n.delete()))}Qt(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.Kt(s,e)}Wt(t){const e=this.cursor({});return new Ps(((n,s)=>{e.onerror=t=>{const e=Ks(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}Kt(t,e){const n=[];return new Ps(((s,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void s();const r=new Vs(i),o=e(i.primaryKey,i.value,r);if(o instanceof Ps){const t=o.catch((t=>(r.done(),Ps.reject(t))));n.push(t)}r.isDone?s():null===r.Lt?i.continue():i.continue(r.Lt)}})).next((()=>Ps.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.jt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Bs(t){return new Ps(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Ks(t.target.error);n(e)}}))}let li=!1;function Ks(t){const e=Fs.vt(Object(h.n)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return li||(li=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Gs extends Ls{constructor(t,e){super(),this.zt=t,this.currentSequenceNumber=e}}function $s(t,e){const n=A(t);return Fs.Nt(n.zt,e)}class Qs{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&je(s,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Be(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&Be(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),s=n;this.applyToLocalView(s),n.isValidDocument()||s.convertToNoDocument(Q.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),yn())}isEqual(t){return this.batchId===t.batchId&&K(this.mutations,t.mutations,((t,e)=>Ge(t,e)))&&K(this.baseMutations,t.baseMutations,((t,e)=>Ge(t,e)))}}class zs{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){x(t.mutations.length===n.length);let s=mn;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new zs(t,e,n,s)}}class Hs{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ws{constructor(t,e,n,s,i=Q.min(),r=Q.min(),o=et.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new Ws(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Ws(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Ws(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Ys{constructor(t){this.Ht=t}}function Xs(t,e){let n;if(e.document)n=$n(t.Ht,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=pt.fromSegments(e.noDocument.path),s=sr(e.noDocument.readTime);n=Lt.newNoDocument(t,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return _();{const t=pt.fromSegments(e.unknownDocument.path),s=sr(e.unknownDocument.version);n=Lt.newUnknownDocument(t,s)}}return e.readTime&&n.setReadTime(er(e.readTime)),n}function Js(t,e){const n=Zs(e.readTime),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const i=function(t,e){return{name:Vn(t,e.key),fields:e.data.value.mapValue.fields,updateTime:On(t,e.version.toTimestamp())}}(t.Ht,e),r=e.hasCommittedMutations;return new ys(null,null,i,r,n,s)}if(e.isNoDocument()){const t=e.key.path.toArray(),i=nr(e.version),r=e.hasCommittedMutations;return new ys(null,new ms(t,i),null,r,n,s)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),i=nr(e.version);return new ys(new ps(t,i),null,null,!0,n,s)}return _()}function Zs(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function er(t){const e=new $(t[0],t[1]);return Q.fromTimestamp(e)}function nr(t){const e=t.toTimestamp();return new hs(e.seconds,e.nanoseconds)}function sr(t){const e=new $(t.seconds,t.nanoseconds);return Q.fromTimestamp(e)}function rr(t,e){const n=(e.baseMutations||[]).map((e=>zn(t.Ht,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map((e=>zn(t.Ht,e))),i=$.fromMillis(e.localWriteTimeMs);return new Qs(e.batchId,i,n,s)}function ir(t){const e=sr(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?sr(t.lastLimboFreeSnapshotVersion):Q.min();let s;var i;return void 0!==t.query.documents?(x(1===(i=t.query).documents.length),s=fe(oe(jn(i.documents[0])))):s=function(t){return fe(Yn(t))}(t.query),new Ws(s,t.targetId,0,t.lastListenSequenceNumber,e,n,et.fromBase64String(t.resumeToken))}function or(t,e){const n=nr(e.snapshotVersion),s=nr(e.lastLimboFreeSnapshotVersion);let i;i=Kt(e.target)?Hn(t.Ht,e.target):Wn(t.Ht,e.target);const r=e.resumeToken.toBase64();return new vs(e.targetId,jt(e.target),n,r,e.sequenceNumber,s,i)}function ar(t){const e=Yn({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?ge(e,e.limit,"L"):e}function cr(t,e){return new Hs(e.largestBatchId,zn(t.Ht,e.overlayMutation))}function ur(t,e){const n=e.path.lastSegment();return[t,os(e.path.popLast()),n]}class lr{getBundleMetadata(t,e){return dr(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:sr(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return dr(t).put({bundleId:(n=e).id,createTime:nr(Pn(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return fr(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:ar(e.bundledQuery),readTime:sr(e.readTime)};var e}))}saveNamedQuery(t,e){return fr(t).put(function(t){return{name:t.name,readTime:nr(Pn(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function dr(t){return $s(t,Ss.store)}function fr(t){return $s(t,_s.store)}class gr{constructor(t,e){this.O=t,this.userId=e}static Jt(t,e){const n=e.uid||"";return new gr(t,n)}getOverlay(t,e){return mr(t).get(ur(this.userId,e)).next((t=>t?cr(this.O,t):null))}saveOverlays(t,e,n){const s=[];return n.forEach((n=>{const i=new Hs(e,n);s.push(this.Yt(t,i))})),Ps.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((t=>s.add(os(t.getCollectionPath()))));const i=[];return s.forEach((e=>{const s=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(mr(t).Gt(Cs.collectionPathOverlayIndex,s))})),Ps.waitFor(i)}getOverlaysForCollection(t,e,n){const s=new Map,i=os(e),r=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return mr(t).qt(Cs.collectionPathOverlayIndex,r).next((t=>{for(const e of t){const t=cr(this.O,e);s.set(t.getKey(),t)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const i=new Map;let r;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return mr(t).Qt({index:Cs.collectionGroupOverlayIndex,range:o},((t,e,n)=>{const o=cr(this.O,e);i.size<s||o.largestBatchId===r?(i.set(o.getKey(),o),r=o.largestBatchId):n.done()})).next((()=>i))}Yt(t,e){return mr(t).put(function(t,e,n){const[s,i,r]=ur(e,n.mutation.key);return new Cs(e,i,r,n.mutation.key.getCollectionGroup(),n.largestBatchId,Qn(t.Ht,n.mutation))}(this.O,this.userId,e))}}function mr(t){return $s(t,Cs.store)}class pr{constructor(){}Xt(t,e){this.Zt(t,e),e.te()}Zt(t,e){if("nullValue"in t)this.ee(e,5);else if("booleanValue"in t)this.ee(e,10),e.ne(t.booleanValue?1:0);else if("integerValue"in t)this.ee(e,15),e.ne(it(t.integerValue));else if("doubleValue"in t){const n=it(t.doubleValue);isNaN(n)?this.ee(e,13):(this.ee(e,15),gt(n)?e.ne(0):e.ne(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ee(e,20),"string"==typeof n?e.se(n):(e.se(`${n.seconds||""}`),e.ne(n.nanos||0))}else if("stringValue"in t)this.ie(t.stringValue,e),this.re(e);else if("bytesValue"in t)this.ee(e,30),e.oe(ot(t.bytesValue)),this.re(e);else if("referenceValue"in t)this.ce(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ee(e,45),e.ne(n.latitude||0),e.ne(n.longitude||0)}else"mapValue"in t?vt(t,yt)?this.ee(e,Number.MAX_SAFE_INTEGER):(this.ue(t.mapValue,e),this.re(e)):"arrayValue"in t?(this.ae(t.arrayValue,e),this.re(e)):_()}ie(t,e){this.ee(e,25),this.he(t,e)}he(t,e){e.se(t)}ue(t,e){const n=t.fields||{};this.ee(e,55);for(const t of Object.keys(n))this.ie(t,e),this.Zt(n[t],e)}ae(t,e){const n=t.values||[];this.ee(e,50);for(const t of n)this.Zt(t,e)}ce(t,e){this.ee(e,37),pt.fromName(t).path.forEach((t=>{this.ee(e,60),this.he(t,e)}))}ee(t,e){t.ne(e)}re(t){t.ne(2)}}function yr(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function wr(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const s=yr(255&t[n]);if(e+=s,8!==s)break}return e}(t);return Math.ceil(e/8)}pr.le=new pr;class vr{constructor(){this.buffer=new Uint8Array(1024),this.position=0}fe(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.de(n.value),n=e.next();this._e()}we(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.me(n.value),n=e.next();this.ge()}ye(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.de(t);else if(t<2048)this.de(960|t>>>6),this.de(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.de(480|t>>>12),this.de(128|63&t>>>6),this.de(128|63&t);else{const t=e.codePointAt(0);this.de(240|t>>>18),this.de(128|63&t>>>12),this.de(128|63&t>>>6),this.de(128|63&t)}}this._e()}pe(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.me(t);else if(t<2048)this.me(960|t>>>6),this.me(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.me(480|t>>>12),this.me(128|63&t>>>6),this.me(128|63&t);else{const t=e.codePointAt(0);this.me(240|t>>>18),this.me(128|63&t>>>12),this.me(128|63&t>>>6),this.me(128|63&t)}}this.ge()}Ie(t){const e=this.Ee(t),n=wr(e);this.Te(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}Ae(t){const e=this.Ee(t),n=wr(e);this.Te(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}Re(){this.Pe(255),this.Pe(255)}be(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(t){this.Te(t.length),this.buffer.set(t,this.position),this.position+=t.length}Ve(){return this.buffer.slice(0,this.position)}Ee(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}de(t){const e=255&t;0===e?(this.Pe(0),this.Pe(255)):255===e?(this.Pe(255),this.Pe(0)):this.Pe(e)}me(t){const e=255&t;0===e?(this.ve(0),this.ve(255)):255===e?(this.ve(255),this.ve(0)):this.ve(t)}_e(){this.Pe(0),this.Pe(1)}ge(){this.ve(0),this.ve(1)}Pe(t){this.Te(1),this.buffer[this.position++]=t}ve(t){this.Te(1),this.buffer[this.position++]=~t}Te(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class Ir{constructor(t){this.Se=t}oe(t){this.Se.fe(t)}se(t){this.Se.ye(t)}ne(t){this.Se.Ie(t)}te(){this.Se.Re()}}class Tr{constructor(t){this.Se=t}oe(t){this.Se.we(t)}se(t){this.Se.pe(t)}ne(t){this.Se.Ae(t)}te(){this.Se.be()}}class Er{constructor(){this.Se=new vr,this.De=new Ir(this.Se),this.Ce=new Tr(this.Se)}seed(t){this.Se.seed(t)}Ne(t){return 0===t?this.De:this.Ce}Ve(){return this.Se.Ve()}reset(){this.Se.reset()}}class Sr{constructor(t,e,n,s){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=s}}function _r(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=pt.comparator(t.documentKey,e.documentKey),0!==n?n:(n=xr(t.arrayValue,e.arrayValue),0!==n?n:xr(t.directionalValue,e.directionalValue)))}function xr(t,e){for(let n=0;n<t.length&&n<e.length;++n){const s=t[n]-e[n];if(0!==s)return s}return t.length-e.length}class Ar{constructor(){this.xe=new Nr}addToCollectionParentIndex(t,e){return this.xe.add(e),Ps.resolve()}getCollectionParents(t,e){return Ps.resolve(this.xe.getEntries(e))}addFieldIndex(t,e){return Ps.resolve()}deleteFieldIndex(t,e){return Ps.resolve()}getDocumentsMatchingTarget(t,e,n){return Ps.resolve(yn())}getFieldIndex(t,e){return Ps.resolve(null)}getFieldIndexes(t,e){return Ps.resolve([])}getNextCollectionGroupToUpdate(t){return Ps.resolve(null)}updateCollectionGroup(t,e,n){return Ps.resolve()}updateIndexEntries(t,e){return Ps.resolve()}}class Nr{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new cn(Y.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new cn(Y.comparator)).toArray()}}class Cr{constructor(t){this.user=t,this.ke=new Nr,this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.ke.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.ke.add(e)}));const i={collectionId:n,parent:os(s)};return Dr(t).put(i)}return Ps.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[G(e),""],!1,!0);return Dr(t).qt(s).next((t=>{for(const s of t){if(s.collectionId!==e)break;n.push(us(s.parent))}return n}))}addFieldIndex(t,e){const n=Or(t),s=function(t){return new xs(t.indexId,t.collectionGroup,t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind])))}(e);return delete s.indexId,n.add(s).next()}deleteFieldIndex(t,e){const n=Or(t),s=Rr(t),i=kr(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e,n){return Ps.resolve(yn())}getFieldIndex(t,e){return Ps.resolve(null)}Oe(t,e){const n=new Er;for(const s of function(t){return t.fields.filter((t=>2!==t.kind))}(t)){const t=e.data.field(s.fieldPath);if(null==t)return null;const i=n.Ne(s.kind);pr.le.Xt(t,i)}return n.Ve()}Me(t){const e=new Er;return pr.le.Xt(t,e.Ne(0)),e.Ve()}getFieldIndexes(t,e){const n=Or(t),s=Rr(t);return(e?n.qt(xs.collectionGroupIndex,IDBKeyRange.bound(e,e)):n.qt()).next((t=>{const e=[];return Ps.forEach(t,(t=>s.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new Ft(e.sequenceNumber,new Vt(sr(e.readTime),new pt(us(e.documentKey)),e.largestBatchId)):Ft.empty(),s=t.fields.map((([t,e])=>new Mt(J.fromServerFormat(t),e)));return new Pt(t.indexId,t.collectionGroup,s,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>t.indexState.sequenceNumber-e.indexState.sequenceNumber)),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=Or(t),i=Rr(t);return this.$e(t).next((t=>s.qt(xs.collectionGroupIndex,IDBKeyRange.bound(e,e)).next((e=>Ps.forEach(e,(e=>i.put(function(t,e,n,s){return new As(t,e.uid||"",n,nr(s.readTime),os(s.documentKey.path),s.largestBatchId)}(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return Ps.forEach(e,((e,s)=>{const i=n.get(e.collectionGroup);return(i?Ps.resolve(i):this.getFieldIndexes(t,e.collectionGroup)).next((i=>(n.set(e.collectionGroup,i),Ps.forEach(i,(n=>this.Fe(t,e,n).next((e=>{const i=this.Be(s,n);return e.isEqual(i)?Ps.resolve():this.Le(t,s,e,i)})))))))}))}Ue(t,e,n){return kr(t).put(new Ns(n.indexId,this.uid,n.arrayValue,n.directionalValue,os(e.key.path)))}qe(t,e,n){return kr(t).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,os(e.key.path)])}Fe(t,e,n){const s=kr(t);let i=new cn(_r);return s.Qt({index:Ns.documentKeyIndex,range:IDBKeyRange.only([n.indexId,this.uid,os(e.path)])},((t,s)=>{i=i.add(new Sr(n.indexId,e,s.arrayValue,s.directionalValue))})).next((()=>i))}Be(t,e){let n=new cn(_r);const s=this.Oe(e,t);if(null==s)return n;const i=function(t){return t.fields.find((t=>2===t.kind))}(e);if(null!=i){const r=t.data.field(i.fieldPath);if(At(r))for(const i of r.arrayValue.values||[])n=n.add(new Sr(e.indexId,t.key,this.Me(i),s))}else n=n.add(new Sr(e.indexId,t.key,new Uint8Array,s));return n}Le(t,e,n,s){I("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const i=[];return function(t,e,n,s,i){const r=t.getIterator(),o=e.getIterator();let c=hn(r),u=hn(o);for(;c||u;){let t=!1,e=!1;if(c&&u){const s=n(c,u);s<0?e=!0:s>0&&(t=!0)}else null!=c?e=!0:t=!0;t?(s(u),u=hn(o)):e?(i(c),c=hn(r)):(c=hn(r),u=hn(o))}}(n,s,_r,(n=>{i.push(this.Ue(t,e,n))}),(n=>{i.push(this.qe(t,e,n))})),Ps.waitFor(i)}$e(t){let e=1;return Rr(t).Qt({index:As.sequenceNumberIndex,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,s)=>{s.done(),e=n.sequenceNumber+1})).next((()=>e))}}function Dr(t){return $s(t,Ts.store)}function kr(t){return $s(t,Ns.store)}function Or(t){return $s(t,xs.store)}function Rr(t){return $s(t,As.store)}const tr={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Lr{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Lr(t,Lr.DEFAULT_COLLECTION_PERCENTILE,Lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Pr(t,e,n){const s=t.store(fs.store),i=t.store(gs.store),r=[],o=IDBKeyRange.only(n.batchId);let c=0;const u=s.Qt({range:o},((t,e,n)=>(c++,n.delete())));r.push(u.next((()=>{x(1===c)})));const a=[];for(const t of n.mutations){const s=gs.key(e,t.key.path,n.batchId);r.push(i.delete(s)),a.push(t.key)}return Ps.waitFor(r).next((()=>a))}function Mr(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _();e=t.noDocument}return JSON.stringify(e).length}Lr.DEFAULT_COLLECTION_PERCENTILE=10,Lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lr.DEFAULT=new Lr(41943040,Lr.DEFAULT_COLLECTION_PERCENTILE,Lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lr.DISABLED=new Lr(-1,0,0);class Fr{constructor(t,e,n,s){this.userId=t,this.O=e,this.indexManager=n,this.referenceDelegate=s,this.Ke={}}static Jt(t,e,n,s){x(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new Fr(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return qr(t).Qt({index:fs.userMutationsIndex,range:n},((t,n,s)=>{e=!1,s.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=Ur(t),r=qr(t);return r.add({}).next((o=>{x("number"==typeof o);const c=new Qs(o,e,n,s),u=function(t,e,n){const s=n.baseMutations.map((e=>Qn(t.Ht,e))),i=n.mutations.map((e=>Qn(t.Ht,e)));return new fs(e,n.batchId,n.localWriteTime.toMillis(),s,i)}(this.O,this.userId,c),a=[];let h=new cn(((t,e)=>rt(t.canonicalString(),e.canonicalString())));for(const t of s){const e=gs.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),a.push(r.put(u)),a.push(i.put(e,gs.PLACEHOLDER))}return h.forEach((e=>{a.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Ke[o]=c.keys()})),Ps.waitFor(a).next((()=>c))}))}lookupMutationBatch(t,e){return qr(t).get(e).next((t=>t?(x(t.userId===this.userId),rr(this.O,t)):null))}Ge(t,e){return this.Ke[e]?Ps.resolve(this.Ke[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Ke[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return qr(t).Qt({index:fs.userMutationsIndex,range:s},((t,e,s)=>{e.userId===this.userId&&(x(e.batchId>=n),i=rr(this.O,e)),s.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return qr(t).Qt({index:fs.userMutationsIndex,range:e,reverse:!0},((t,e,s)=>{n=e.batchId,s.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return qr(t).qt(fs.userMutationsIndex,e).next((t=>t.map((t=>rr(this.O,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=gs.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Ur(t).Qt({range:s},((n,s,r)=>{const[o,c,u]=n,a=us(c);if(o===this.userId&&e.path.isEqual(a))return qr(t).get(u).next((t=>{if(!t)throw _();x(t.userId===this.userId),i.push(rr(this.O,t))}));r.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new cn(rt);const s=[];return e.forEach((e=>{const i=gs.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=Ur(t).Qt({range:r},((t,s,i)=>{const[r,o,c]=t,u=us(o);r===this.userId&&e.path.isEqual(u)?n=n.add(c):i.done()}));s.push(o)})),Ps.waitFor(s).next((()=>this.je(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=gs.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new cn(rt);return Ur(t).Qt({range:r},((t,e,i)=>{const[r,c,u]=t,a=us(c);r===this.userId&&n.isPrefixOf(a)?a.length===s&&(o=o.add(u)):i.done()})).next((()=>this.je(t,o)))}je(t,e){const n=[],s=[];return e.forEach((e=>{s.push(qr(t).get(e).next((t=>{if(null===t)throw _();x(t.userId===this.userId),n.push(rr(this.O,t))})))})),Ps.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return Pr(t.zt,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Qe(e.batchId)})),Ps.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Qe(t){delete this.Ke[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Ps.resolve();const n=IDBKeyRange.lowerBound(gs.prefixForUser(this.userId)),s=[];return Ur(t).Qt({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=us(t[1]);s.push(e)}else n.done()})).next((()=>{x(0===s.length)}))}))}containsKey(t,e){return Vr(t,this.userId,e)}We(t){return jr(t).get(this.userId).next((t=>t||new ds(this.userId,-1,"")))}}function Vr(t,e,n){const s=gs.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return Ur(t).Qt({range:r,jt:!0},((t,n,s)=>{const[r,c,u]=t;r===e&&c===i&&(o=!0),s.done()})).next((()=>o))}function qr(t){return $s(t,fs.store)}function Ur(t){return $s(t,gs.store)}function jr(t){return $s(t,ds.store)}class Br{constructor(t){this.ze=t}next(){return this.ze+=2,this.ze}static He(){return new Br(0)}static Je(){return new Br(-1)}}class hr{constructor(t,e){this.referenceDelegate=t,this.O=e}allocateTargetId(t){return this.Ye(t).next((e=>{const n=new Br(e.highestTargetId);return e.highestTargetId=n.next(),this.Xe(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Ye(t).next((t=>Q.fromTimestamp(new $(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Ye(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Ye(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Xe(t,s))))}addTargetData(t,e){return this.Ze(t,e).next((()=>this.Ye(t).next((n=>(n.targetCount+=1,this.tn(e,n),this.Xe(t,n))))))}updateTargetData(t,e){return this.Ze(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Kr(t).delete(e.targetId))).next((()=>this.Ye(t))).next((e=>(x(e.targetCount>0),e.targetCount-=1,this.Xe(t,e))))}removeTargets(t,e,n){let s=0;const i=[];return Kr(t).Qt(((r,o)=>{const c=ir(o);c.sequenceNumber<=e&&null===n.get(c.targetId)&&(s++,i.push(this.removeTargetData(t,c)))})).next((()=>Ps.waitFor(i))).next((()=>s))}forEachTarget(t,e){return Kr(t).Qt(((t,n)=>{const s=ir(n);e(s)}))}Ye(t){return Gr(t).get(Is.key).next((t=>(x(null!==t),t)))}Xe(t,e){return Gr(t).put(Is.key,e)}Ze(t,e){return Kr(t).put(or(this.O,e))}tn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Ye(t).next((t=>t.targetCount))}getTargetData(t,e){const n=jt(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Kr(t).Qt({range:s,index:vs.queryTargetsIndexName},((t,n,s)=>{const r=ir(n);Bt(e,r.target)&&(i=r,s.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=$r(t);return e.forEach((e=>{const r=os(e.path);s.push(i.put(new bs(n,r))),s.push(this.referenceDelegate.addReference(t,n,e))})),Ps.waitFor(s)}removeMatchingKeys(t,e,n){const s=$r(t);return Ps.forEach(e,(e=>{const i=os(e.path);return Ps.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=$r(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=$r(t);let i=yn();return s.Qt({range:n,jt:!0},((t,e,n)=>{const s=us(t[1]),r=new pt(s);i=i.add(r)})).next((()=>i))}containsKey(t,e){const n=os(e.path),s=IDBKeyRange.bound([n],[G(n)],!1,!0);let i=0;return $r(t).Qt({index:bs.documentTargetsIndex,jt:!0,range:s},(([t,e],n,s)=>{0!==t&&(i++,s.done())})).next((()=>i>0))}Tt(t,e){return Kr(t).get(e).next((t=>t?ir(t):null))}}function Kr(t){return $s(t,vs.store)}function Gr(t){return $s(t,Is.store)}function $r(t){return $s(t,bs.store)}async function Qr(t){if(t.code!==N.FAILED_PRECONDITION||t.message!==Rs)throw t;I("LocalStore","Unexpectedly lost primary lease")}function zr([t,e],[n,s]){const i=rt(t,n);return 0===i?rt(e,s):i}class Hr{constructor(t){this.en=t,this.buffer=new cn(zr),this.nn=0}sn(){return++this.nn}rn(t){const e=[t,this.sn()];if(this.buffer.size<this.en)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();zr(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Wr{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.on=!1,this.cn=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.un(t)}stop(){this.cn&&(this.cn.cancel(),this.cn=null)}get started(){return null!==this.cn}un(t){const e=this.on?3e5:6e4;I("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.cn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.cn=null,this.on=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){Us(t)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Qr(t)}await this.un(t)}))}}class Yr{constructor(t,e){this.an=t,this.params=e}calculateTargetCount(t,e){return this.an.hn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Ps.resolve(U.A);const n=new Hr(e);return this.an.forEachTarget(t,(t=>n.rn(t.sequenceNumber))).next((()=>this.an.ln(t,(t=>n.rn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.an.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.an.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector","Garbage collection skipped; disabled"),Ps.resolve(tr)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),tr):this.fn(t,e)))}getCacheSize(t){return this.an.getCacheSize(t)}fn(t,e){let n,s,i,r,o,u,a;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,r=Date.now(),this.nthSequenceNumber(t,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,u=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(a=Date.now(),w()<=c.a.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-h}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(u-o)+"ms\n"+`\tRemoved ${t} documents in `+(a-u)+"ms\n"+`Total Duration: ${a-h}ms`),Ps.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:t}))))}}class Xr{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Yr(t,e)}(this,e)}hn(t){const e=this.dn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}dn(t){let e=0;return this.ln(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}ln(t,e){return this._n(t,((t,n)=>e(n)))}addReference(t,e,n){return Jr(t,n)}removeReference(t,e,n){return Jr(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Jr(t,e)}wn(t,e){return function(t,e){let n=!1;return jr(t).Wt((s=>Vr(t,s,e).next((t=>(t&&(n=!0),Ps.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this._n(t,((r,o)=>{if(o<=e){const e=this.wn(t,r).next((e=>{if(!e)return i++,n.getEntry(t,r).next((()=>(n.removeEntry(r,Q.min()),$r(t).delete([0,os(r.path)]))))}));s.push(e)}})).next((()=>Ps.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Jr(t,e)}_n(t,e){const n=$r(t);let s,i=U.A;return n.Qt({index:bs.documentTargetsIndex},(([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==U.A&&e(new pt(us(s)),i),i=o,s=r):i=U.A})).next((()=>{i!==U.A&&e(new pt(us(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Jr(t,e){return $r(t).put(function(t,e){return new bs(0,os(t.path),e)}(e,t.currentSequenceNumber))}class Zr{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),!0;return!1}forEach(t){H(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return W(this.inner)}}class ti{constructor(){this.changes=new Zr((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Lt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ps.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class ei{constructor(t){this.O=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return br(t).put(ri(e),n)}removeEntry(t,e){const n=br(t),s=ri(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.mn(t,n))))}getEntry(t,e){return br(t).get(ri(e)).next((t=>this.gn(e,t)))}yn(t,e){return br(t).get(ri(e)).next((t=>({document:this.gn(e,t),size:Mr(t)})))}getEntries(t,e){let n=dn();return this.pn(t,e,((t,e)=>{const s=this.gn(t,e);n=n.insert(t,s)})).next((()=>n))}In(t,e){let n=dn(),s=new rn(pt.comparator);return this.pn(t,e,((t,e)=>{const i=this.gn(t,e);n=n.insert(t,i),s=s.insert(t,Mr(e))})).next((()=>({documents:n,En:s})))}pn(t,e,n){if(e.isEmpty())return Ps.resolve();const s=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator();let r=i.getNext();return br(t).Qt({range:s},((t,e,s)=>{const o=pt.fromSegments(t);for(;r&&pt.comparator(r,o)<0;)n(r,null),r=i.getNext();r&&r.isEqual(o)&&(n(r,e),r=i.hasNext()?i.getNext():null),r?s.Ut(r.path.toArray()):s.done()})).next((()=>{for(;r;)n(r,null),r=i.hasNext()?i.getNext():null}))}getAll(t,e,n){let s=dn();const i=e.length+1,r={};if(n.isEqual(Q.min())){const t=e.toArray();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.toArray(),s=Zs(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=ys.collectionReadTimeIndex}return br(t).Qt(r,((t,n,r)=>{if(t.length!==i)return;const o=this.gn(pt.fromSegments(t),n);e.isPrefixOf(o.key.path)?s=s.insert(o.key,o):r.done()})).next((()=>s))}newChangeBuffer(t){return new ni(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return si(t).get(ws.key).next((t=>(x(!!t),t)))}mn(t,e){return si(t).put(ws.key,e)}gn(t,e){if(e){const t=Xs(this.O,e);if(!t.isNoDocument()||!t.version.isEqual(Q.min()))return t}return Lt.newInvalidDocument(t)}}class ni extends ti{constructor(t,e){super(),this.Tn=t,this.trackRemovals=e,this.An=new Zr((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,s=new cn(((t,e)=>rt(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,r)=>{const o=this.An.get(i);if(r.isValidDocument()){const c=Js(this.Tn.O,r);s=s.add(i.path.popLast());const u=Mr(c);n+=u-o,e.push(this.Tn.addEntry(t,i,c))}else if(n-=o,this.trackRemovals){const n=Js(this.Tn.O,r.convertToNoDocument(Q.min()));e.push(this.Tn.addEntry(t,i,n))}else e.push(this.Tn.removeEntry(t,i))})),s.forEach((n=>{e.push(this.Tn.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.Tn.updateMetadata(t,n)),Ps.waitFor(e)}getFromCache(t,e){return this.Tn.yn(t,e).next((t=>(this.An.set(e,t.size),t.document)))}getAllFromCache(t,e){return this.Tn.In(t,e).next((({documents:t,En:e})=>(e.forEach(((t,e)=>{this.An.set(t,e)})),t)))}}function si(t){return $s(t,ws.store)}function br(t){return $s(t,ys.store)}function ri(t){return t.path.toArray()}class ii{constructor(t){this.O=t}kt(t,e,n,s){const i=new Ms("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore(ls.store)}(t),function(t){t.createObjectStore(ds.store,{keyPath:ds.keyPath}),t.createObjectStore(fs.store,{keyPath:fs.keyPath,autoIncrement:!0}).createIndex(fs.userMutationsIndex,fs.userMutationsKeyPath,{unique:!0}),t.createObjectStore(gs.store)}(t),oi(t),function(t){t.createObjectStore(ys.store)}(t));let r=Ps.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(bs.store),t.deleteObjectStore(vs.store),t.deleteObjectStore(Is.store)}(t),oi(t)),r=r.next((()=>function(t){const e=t.store(Is.store),n=new Is(0,0,Q.min().toTimestamp(),0);return e.put(Is.key,n)}(i)))),n<4&&s>=4&&(0!==n&&(r=r.next((()=>function(t,e){return e.store(fs.store).qt().next((n=>{t.deleteObjectStore(fs.store),t.createObjectStore(fs.store,{keyPath:fs.keyPath,autoIncrement:!0}).createIndex(fs.userMutationsIndex,fs.userMutationsKeyPath,{unique:!0});const s=e.store(fs.store),i=n.map((t=>s.put(t)));return Ps.waitFor(i)}))}(t,i)))),r=r.next((()=>{!function(t){t.createObjectStore(Es.store,{keyPath:Es.keyPath})}(t)}))),n<5&&s>=5&&(r=r.next((()=>this.Rn(i)))),n<6&&s>=6&&(r=r.next((()=>(function(t){t.createObjectStore(ws.store)}(t),this.Pn(i))))),n<7&&s>=7&&(r=r.next((()=>this.bn(i)))),n<8&&s>=8&&(r=r.next((()=>this.vn(t,i)))),n<9&&s>=9&&(r=r.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(ys.store);e.createIndex(ys.readTimeIndex,ys.readTimeIndexPath,{unique:!1}),e.createIndex(ys.collectionReadTimeIndex,ys.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&s>=10&&(r=r.next((()=>this.Vn(i)))),n<11&&s>=11&&(r=r.next((()=>{!function(t){t.createObjectStore(Ss.store,{keyPath:Ss.keyPath})}(t),function(t){t.createObjectStore(_s.store,{keyPath:_s.keyPath})}(t)}))),n<12&&s>=12&&(r=r.next((()=>{!function(t){const e=t.createObjectStore(Cs.store,{keyPath:Cs.keyPath});e.createIndex(Cs.collectionPathOverlayIndex,Cs.collectionPathOverlayIndexPath,{unique:!1}),e.createIndex(Cs.collectionGroupOverlayIndex,Cs.collectionGroupOverlayIndexPath,{unique:!1})}(t)}))),n<13&&s>=13&&(r=r.next((()=>{!function(t){t.createObjectStore(xs.store,{keyPath:xs.keyPath,autoIncrement:!0}).createIndex(xs.collectionGroupIndex,xs.collectionGroupIndexPath,{unique:!1}),t.createObjectStore(As.store,{keyPath:As.keyPath}).createIndex(As.sequenceNumberIndex,As.sequenceNumberIndexPath,{unique:!1}),t.createObjectStore(Ns.store,{keyPath:Ns.keyPath}).createIndex(Ns.documentKeyIndex,Ns.documentKeyIndexPath,{unique:!1})}(t)}))),r}Pn(t){let e=0;return t.store(ys.store).Qt(((t,n)=>{e+=Mr(n)})).next((()=>{const n=new ws(e);return t.store(ws.store).put(ws.key,n)}))}Rn(t){const e=t.store(ds.store),n=t.store(fs.store);return e.qt().next((e=>Ps.forEach(e,(e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.qt(fs.userMutationsIndex,s).next((n=>Ps.forEach(n,(n=>{x(n.userId===e.userId);const s=rr(this.O,n);return Pr(t,e.userId,s).next((()=>{}))}))))}))))}bn(t){const e=t.store(bs.store),n=t.store(ys.store);return t.store(Is.store).get(Is.key).next((t=>{const s=[];return n.Qt(((n,i)=>{const r=new Y(n),o=function(t){return[0,os(t)]}(r);s.push(e.get(o).next((n=>n?Ps.resolve():(n=>e.put(new bs(0,os(n),t.highestListenSequenceNumber)))(r))))})).next((()=>Ps.waitFor(s)))}))}vn(t,e){t.createObjectStore(Ts.store,{keyPath:Ts.keyPath});const n=e.store(Ts.store),s=new Nr,i=t=>{if(s.add(t)){const e=t.lastSegment(),s=t.popLast();return n.put({collectionId:e,parent:os(s)})}};return e.store(ys.store).Qt({jt:!0},((t,e)=>{const n=new Y(t);return i(n.popLast())})).next((()=>e.store(gs.store).Qt({jt:!0},(([t,e,n],s)=>{const r=us(e);return i(r.popLast())}))))}Vn(t){const e=t.store(vs.store);return e.Qt(((t,n)=>{const s=ir(n),i=or(this.O,s);return e.put(i)}))}}function oi(t){t.createObjectStore(bs.store,{keyPath:bs.keyPath}).createIndex(bs.documentTargetsIndex,bs.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(vs.store,{keyPath:vs.keyPath}).createIndex(vs.queryTargetsIndexName,vs.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Is.store)}const ai="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ci{constructor(t,e,n,s,i,r,o,c,u,a,h=12){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Sn=i,this.window=r,this.document=o,this.Dn=u,this.Cn=a,this.schemaVersion=h,this.Nn=null,this.xn=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kn=null,this.inForeground=!1,this.On=null,this.Mn=null,this.$n=Number.NEGATIVE_INFINITY,this.Fn=t=>Promise.resolve(),!ci.Vt())throw new C(N.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Xr(this,s),this.Bn=e+"main",this.O=new Ys(c),this.Ln=new Fs(this.Bn,this.schemaVersion,new ii(this.O)),this.Un=new hr(this.referenceDelegate,this.O),this.qn=function(t){return new ei(t)}(this.O),this.Kn=new lr,this.window&&this.window.localStorage?this.Gn=this.window.localStorage:(this.Gn=null,!1===a&&T("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.jn().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(N.FAILED_PRECONDITION,ai);return this.Qn(),this.Wn(),this.zn(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Un.getHighestSequenceNumber(t)))})).then((t=>{this.Nn=new U(t,this.Dn)})).then((()=>{this.xn=!0})).catch((t=>(this.Ln&&this.Ln.close(),Promise.reject(t))))}Hn(t){return this.Fn=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ln.Mt((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Sn.enqueueAndForget((async()=>{this.started&&await this.jn()})))}jn(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>hi(t).put(new Es(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.Jn(t).next((t=>{t||(this.isPrimary=!1,this.Sn.enqueueRetryable((()=>this.Fn(!1))))}))})).next((()=>this.Yn(t))).next((e=>this.isPrimary&&!e?this.Xn(t).next((()=>!1)):!!e&&this.Zn(t).next((()=>!0)))))).catch((t=>{if(Us(t))return I("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Sn.enqueueRetryable((()=>this.Fn(t))),this.isPrimary=t}))}Jn(t){return ui(t).get(ls.key).next((t=>Ps.resolve(this.ts(t))))}es(t){return hi(t).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.ss(this.$n,18e5)){this.$n=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=$s(t,Es.store);return e.qt().next((t=>{const n=this.rs(t,18e5),s=t.filter((t=>-1===n.indexOf(t)));return Ps.forEach(s,(t=>e.delete(t.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.Gn)for(const e of t)this.Gn.removeItem(this.os(e.clientId))}}zn(){this.Mn=this.Sn.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.jn().then((()=>this.ns())).then((()=>this.zn()))))}ts(t){return!!t&&t.ownerId===this.clientId}Yn(t){return this.Cn?Ps.resolve(!0):ui(t).get(ls.key).next((e=>{if(null!==e&&this.ss(e.leaseTimestampMs,5e3)&&!this.cs(e.ownerId)){if(this.ts(e)&&this.networkEnabled)return!0;if(!this.ts(e)){if(!e.allowTabSynchronization)throw new C(N.FAILED_PRECONDITION,ai);return!1}}return!(!this.networkEnabled||!this.inForeground)||hi(t).qt().next((t=>void 0===this.rs(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.xn=!1,this.us(),this.Mn&&(this.Mn.cancel(),this.Mn=null),this.hs(),this.ls(),await this.Ln.runTransaction("shutdown","readwrite",[ls.store,Es.store],(t=>{const e=new Gs(t,U.A);return this.Xn(e).next((()=>this.es(e)))})),this.Ln.close(),this.fs()}rs(t,e){return t.filter((t=>this.ss(t.updateTimeMs,e)&&!this.cs(t.clientId)))}ds(){return this.runTransaction("getActiveClients","readonly",(t=>hi(t).qt().next((t=>this.rs(t,18e5).map((t=>t.clientId))))))}get started(){return this.xn}getMutationQueue(t,e){return Fr.Jt(t,this.O,e,this.referenceDelegate)}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getIndexManager(t){return new Cr(t)}getDocumentOverlayCache(t){return gr.Jt(this.O,t)}getBundleCache(){return this.Kn}runTransaction(t,e,n){I("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite",i=13===(r=this.schemaVersion)?Os:12===r?ks:11===r?Ds:void _();var r;let o;return this.Ln.runTransaction(t,s,i,(s=>(o=new Gs(s,this.Nn?this.Nn.next():U.A),"readwrite-primary"===e?this.Jn(o).next((t=>!!t||this.Yn(o))).next((e=>{if(!e)throw T(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Sn.enqueueRetryable((()=>this.Fn(!1))),new C(N.FAILED_PRECONDITION,Rs);return n(o)})).next((t=>this.Zn(o).next((()=>t)))):this._s(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}_s(t){return ui(t).get(ls.key).next((t=>{if(null!==t&&this.ss(t.leaseTimestampMs,5e3)&&!this.cs(t.ownerId)&&!this.ts(t)&&!(this.Cn||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(N.FAILED_PRECONDITION,ai)}))}Zn(t){const e=new ls(this.clientId,this.allowTabSynchronization,Date.now());return ui(t).put(ls.key,e)}static Vt(){return Fs.Vt()}Xn(t){const e=ui(t);return e.get(ls.key).next((t=>this.ts(t)?(I("IndexedDbPersistence","Releasing primary lease."),e.delete(ls.key)):Ps.resolve()))}ss(t,e){const n=Date.now();return!(t<n-e||t>n&&(T(`Detected an update time that is in the future: ${t} > ${n}`),1))}Qn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.On=()=>{this.Sn.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.jn())))},this.document.addEventListener("visibilitychange",this.On),this.inForeground="visible"===this.document.visibilityState)}hs(){this.On&&(this.document.removeEventListener("visibilitychange",this.On),this.On=null)}Wn(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.kn=()=>{this.us(),Object(h.x)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Sn.enterRestrictedMode(!0),this.Sn.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.kn))}ls(){this.kn&&(this.window.removeEventListener("pagehide",this.kn),this.kn=null)}cs(t){var e;try{const n=null!==(null===(e=this.Gn)||void 0===e?void 0:e.getItem(this.os(t)));return I("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return T("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}us(){if(this.Gn)try{this.Gn.setItem(this.os(this.clientId),String(Date.now()))}catch(t){T("Failed to set zombie client id.",t)}}fs(){if(this.Gn)try{this.Gn.removeItem(this.os(this.clientId))}catch(t){}}os(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function ui(t){return $s(t,ls.store)}function hi(t){return $s(t,Es.store)}function di(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class fi{constructor(t,e){this.progress=t,this.ws=e}}class gi{constructor(t,e,n){this.qn=t,this.gs=e,this.indexManager=n}ys(t,e){return this.gs.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.ps(t,e,n)))}ps(t,e,n){return this.qn.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}Is(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}Es(t,e){return this.qn.getEntries(t,e).next((e=>this.Ts(t,e).next((()=>e))))}Ts(t,e){return this.gs.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.Is(e,t)))}As(t,e,n){return function(t){return pt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Rs(t,e.path):le(e)?this.Ps(t,e,n):this.bs(t,e,n)}Rs(t,e){return this.ys(t,new pt(e)).next((t=>{let e=gn();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Ps(t,e,n){const s=e.collectionGroup;let i=gn();return this.indexManager.getCollectionParents(t,s).next((r=>Ps.forEach(r,(r=>{const o=function(t,e){return new re(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.bs(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}bs(t,e,n){let s;return this.qn.getAll(t,e.path,n).next((n=>(s=n,this.gs.getAllMutationBatchesAffectingQuery(t,e)))).next((t=>{for(const e of t)for(const t of e.mutations){const n=t.key;let i=s.get(n);null==i&&(i=Lt.newInvalidDocument(n),s=s.insert(n,i)),Be(t,i,e.localWriteTime),i.isFoundDocument()||(s=s.remove(n))}})).next((()=>(s.forEach(((t,n)=>{we(e,n)||(s=s.remove(t))})),s)))}}class mi{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.vs=n,this.Vs=s}static Ss(t,e){let n=yn(),s=yn();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new mi(t,e.fromCache,n,s)}}class pi{Ds(t){this.Cs=t}As(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Q.min())?this.Ns(t,e):this.Cs.Es(t,s).next((i=>{const r=this.xs(e,i);return(ae(e)||ce(e))&&this.ks(e.limitType,r,s,n)?this.Ns(t,e):(w()<=c.a.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ye(e)),this.Cs.As(t,e,n).next((t=>(r.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}xs(t,e){let n=new cn(ve(t));return e.forEach(((e,s)=>{we(t,s)&&(n=n.add(s))})),n}ks(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ns(t,e){return w()<=c.a.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",ye(e)),this.Cs.As(t,e,Q.min())}}class yi{constructor(t,e,n,s){this.persistence=t,this.Os=e,this.O=s,this.Ms=new rn(rt),this.$s=new Zr((t=>jt(t)),Bt),this.Fs=Q.min(),this.Bs=t.getRemoteDocumentCache(),this.Un=t.getTargetCache(),this.Kn=t.getBundleCache(),this.Ls(n)}Ls(t){this.indexManager=this.persistence.getIndexManager(t),this.gs=this.persistence.getMutationQueue(t,this.indexManager),this.Us=new gi(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function wi(t,e,n,s){return new yi(t,e,n,s)}async function vi(t,e){const n=A(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.gs.getAllMutationBatches(t).next((i=>(s=i,n.Ls(e),n.gs.getAllMutationBatches(t)))).next((e=>{const i=[],r=[];let o=yn();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.Us.Es(t,o).next((t=>({qs:t,removedBatchIds:i,addedBatchIds:r})))}))}))}function bi(t){const e=A(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Un.getLastRemoteSnapshotVersion(t)))}function Ii(t,e,n){let s=yn();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=dn();return n.forEach(((n,i)=>{const r=t.get(n);i.isNoDocument()&&i.version.isEqual(Q.min())?(e.removeEntry(n,i.readTime),s=s.insert(n,i)):!r.isValidDocument()||i.version.compareTo(r.version)>0||0===i.version.compareTo(r.version)&&r.hasPendingWrites?(e.addEntry(i),s=s.insert(n,i)):I("LocalStore","Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",i.version)})),s}))}function Ti(t,e){const n=A(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.gs.getNextMutationBatchAfterBatchId(t,e))))}function Ei(t,e){const n=A(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Un.getTargetData(t,e).next((i=>i?(s=i,Ps.resolve(s)):n.Un.allocateTargetId(t).next((i=>(s=new Ws(e,i,0,t.currentSequenceNumber),n.Un.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.Ms.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.$s.set(e,t.targetId)),t}))}async function Si(t,e,n){const s=A(t),i=s.Ms.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Us(t))throw t;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ms=s.Ms.remove(e),s.$s.delete(i.target)}function _i(t,e,n){const s=A(t);let i=Q.min(),r=yn();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=A(t),i=s.$s.get(n);return void 0!==i?Ps.resolve(s.Ms.get(i)):s.Un.getTargetData(e,n)}(s,t,fe(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Un.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.Os.As(t,e,n?i:Q.min(),n?r:yn()))).next((t=>({documents:t,Ks:r})))))}function xi(t,e){const n=A(t),s=A(n.Un),i=n.Ms.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(t=>s.Tt(t,e).next((t=>t?t.target:null))))}function Ai(t){const e=A(t);return e.persistence.runTransaction("Get new document changes","readonly",(t=>function(t,e,n){const s=A(t);let i=dn(),r=Zs(n);const o=br(e),c=IDBKeyRange.lowerBound(r,!0);return o.Qt({index:ys.readTimeIndex,range:c},((t,e)=>{const n=Xs(s.O,e);i=i.insert(n.key,n),r=e.readTime})).next((()=>({ws:i,readTime:er(r)})))}(e.Bs,t,e.Fs))).then((({ws:t,readTime:n})=>(e.Fs=n,t)))}async function Ni(t,e,n=yn()){const s=await Ei(t,fe(ar(e.bundledQuery))),i=A(t);return i.persistence.runTransaction("Save named query","readwrite",(t=>{const r=Pn(e.readTime);if(s.snapshotVersion.compareTo(r)>=0)return i.Kn.saveNamedQuery(t,e);const o=s.withResumeToken(et.EMPTY_BYTE_STRING,r);return i.Ms=i.Ms.insert(o.targetId,o),i.Un.updateTargetData(t,o).next((()=>i.Un.removeMatchingKeysForTargetId(t,s.targetId))).next((()=>i.Un.addMatchingKeys(t,n,s.targetId))).next((()=>i.Kn.saveNamedQuery(t,e)))}))}class Ci{constructor(t){this.O=t,this.Ws=new Map,this.zs=new Map}getBundleMetadata(t,e){return Ps.resolve(this.Ws.get(e))}saveBundleMetadata(t,e){var n;return this.Ws.set(e.id,{id:(n=e).id,version:n.version,createTime:Pn(n.createTime)}),Ps.resolve()}getNamedQuery(t,e){return Ps.resolve(this.zs.get(e))}saveNamedQuery(t,e){return this.zs.set(e.name,function(t){return{name:t.name,query:ar(t.bundledQuery),readTime:Pn(t.readTime)}}(e)),Ps.resolve()}}class Di{constructor(){this.overlays=new rn(pt.comparator),this.Hs=new Map}getOverlay(t,e){return Ps.resolve(this.overlays.get(e))}saveOverlays(t,e,n){return n.forEach((n=>{this.Yt(t,e,n)})),Ps.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.Hs.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.Hs.delete(n)),Ps.resolve()}getOverlaysForCollection(t,e,n){const s=new Map,i=e.length+1,r=new pt(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&t.largestBatchId>n&&s.set(t.getKey(),t)}return Ps.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new rn(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=new Map,i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=new Map,c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((t,e)=>o.set(e,t))),!(o.size>=s)););return Ps.resolve(o)}Yt(t,e,n){if(null===n)return;const s=this.overlays.get(n.key);null!==s&&this.Hs.get(s.largestBatchId).delete(n.key),this.overlays=this.overlays.insert(n.key,new Hs(e,n));let i=this.Hs.get(e);void 0===i&&(i=new Set,this.Hs.set(e,i)),i.add(n.key)}}class ki{constructor(){this.Js=new cn(Oi.Ys),this.Xs=new cn(Oi.Zs)}isEmpty(){return this.Js.isEmpty()}addReference(t,e){const n=new Oi(t,e);this.Js=this.Js.add(n),this.Xs=this.Xs.add(n)}ti(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ei(new Oi(t,e))}ni(t,e){t.forEach((t=>this.removeReference(t,e)))}si(t){const e=new pt(new Y([])),n=new Oi(e,t),s=new Oi(e,t+1),i=[];return this.Xs.forEachInRange([n,s],(t=>{this.ei(t),i.push(t.key)})),i}ii(){this.Js.forEach((t=>this.ei(t)))}ei(t){this.Js=this.Js.delete(t),this.Xs=this.Xs.delete(t)}ri(t){const e=new pt(new Y([])),n=new Oi(e,t),s=new Oi(e,t+1);let i=yn();return this.Xs.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Oi(t,0),n=this.Js.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Oi{constructor(t,e){this.key=t,this.oi=e}static Ys(t,e){return pt.comparator(t.key,e.key)||rt(t.oi,e.oi)}static Zs(t,e){return rt(t.oi,e.oi)||pt.comparator(t.key,e.key)}}class Ri{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.gs=[],this.ci=1,this.ui=new cn(Oi.Ys)}checkEmpty(t){return Ps.resolve(0===this.gs.length)}addMutationBatch(t,e,n,s){const i=this.ci;this.ci++,this.gs.length>0&&this.gs[this.gs.length-1];const r=new Qs(i,e,n,s);this.gs.push(r);for(const e of s)this.ui=this.ui.add(new Oi(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ps.resolve(r)}lookupMutationBatch(t,e){return Ps.resolve(this.ai(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.hi(n),i=s<0?0:s;return Ps.resolve(this.gs.length>i?this.gs[i]:null)}getHighestUnacknowledgedBatchId(){return Ps.resolve(0===this.gs.length?-1:this.ci-1)}getAllMutationBatches(t){return Ps.resolve(this.gs.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Oi(e,0),s=new Oi(e,Number.POSITIVE_INFINITY),i=[];return this.ui.forEachInRange([n,s],(t=>{const e=this.ai(t.oi);i.push(e)})),Ps.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new cn(rt);return e.forEach((t=>{const e=new Oi(t,0),s=new Oi(t,Number.POSITIVE_INFINITY);this.ui.forEachInRange([e,s],(t=>{n=n.add(t.oi)}))})),Ps.resolve(this.li(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;pt.isDocumentKey(i)||(i=i.child(""));const r=new Oi(new pt(i),0);let o=new cn(rt);return this.ui.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.oi)),!0)}),r),Ps.resolve(this.li(o))}li(t){const e=[];return t.forEach((t=>{const n=this.ai(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){x(0===this.fi(e.batchId,"removed")),this.gs.shift();let n=this.ui;return Ps.forEach(e.mutations,(s=>{const i=new Oi(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.ui=n}))}Qe(t){}containsKey(t,e){const n=new Oi(e,0),s=this.ui.firstAfterOrEqual(n);return Ps.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.gs.length,Ps.resolve()}fi(t,e){return this.hi(t)}hi(t){return 0===this.gs.length?0:t-this.gs[0].batchId}ai(t){const e=this.hi(t);return e<0||e>=this.gs.length?null:this.gs[e]}}class Li{constructor(t){this.di=t,this.docs=new rn(pt.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,r=this.di(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ps.resolve(n?n.document.mutableCopy():Lt.newInvalidDocument(e))}getEntries(t,e){let n=dn();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Lt.newInvalidDocument(t))})),Ps.resolve(n)}getAll(t,e,n){let s=dn();const i=new pt(e.child("")),r=this.docs.getIteratorFrom(i);for(;r.hasNext();){const{key:t,value:{document:i}}=r.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||i.readTime.compareTo(n)<=0||(s=s.insert(i.key,i.mutableCopy()))}return Ps.resolve(s)}_i(t,e){return Ps.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Pi(this)}getSize(t){return Ps.resolve(this.size)}}class Pi extends ti{constructor(t){super(),this.Tn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Tn.addEntry(t,s)):this.Tn.removeEntry(n)})),Ps.waitFor(e)}getFromCache(t,e){return this.Tn.getEntry(t,e)}getAllFromCache(t,e){return this.Tn.getEntries(t,e)}}class Mi{constructor(t){this.persistence=t,this.wi=new Zr((t=>jt(t)),Bt),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.mi=0,this.gi=new ki,this.targetCount=0,this.yi=Br.He()}forEachTarget(t,e){return this.wi.forEach(((t,n)=>e(n))),Ps.resolve()}getLastRemoteSnapshotVersion(t){return Ps.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ps.resolve(this.mi)}allocateTargetId(t){return this.highestTargetId=this.yi.next(),Ps.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.mi&&(this.mi=e),Ps.resolve()}Ze(t){this.wi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.yi=new Br(e),this.highestTargetId=e),t.sequenceNumber>this.mi&&(this.mi=t.sequenceNumber)}addTargetData(t,e){return this.Ze(e),this.targetCount+=1,Ps.resolve()}updateTargetData(t,e){return this.Ze(e),Ps.resolve()}removeTargetData(t,e){return this.wi.delete(e.target),this.gi.si(e.targetId),this.targetCount-=1,Ps.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.wi.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.wi.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),Ps.waitFor(i).next((()=>s))}getTargetCount(t){return Ps.resolve(this.targetCount)}getTargetData(t,e){const n=this.wi.get(e)||null;return Ps.resolve(n)}addMatchingKeys(t,e,n){return this.gi.ti(e,n),Ps.resolve()}removeMatchingKeys(t,e,n){this.gi.ni(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),Ps.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.gi.si(e),Ps.resolve()}getMatchingKeysForTargetId(t,e){const n=this.gi.ri(e);return Ps.resolve(n)}containsKey(t,e){return Ps.resolve(this.gi.containsKey(e))}}class Fi{constructor(t,e){this.pi={},this.overlays={},this.Nn=new U(0),this.xn=!1,this.xn=!0,this.referenceDelegate=t(this),this.Un=new Mi(this),this.indexManager=new Ar,this.qn=function(t){return new Li(t)}((t=>this.referenceDelegate.Ii(t))),this.O=new Ys(e),this.Kn=new Ci(this.O)}start(){return Promise.resolve()}shutdown(){return this.xn=!1,Promise.resolve()}get started(){return this.xn}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Di,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.pi[t.toKey()];return n||(n=new Ri(e,this.referenceDelegate),this.pi[t.toKey()]=n),n}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getBundleCache(){return this.Kn}runTransaction(t,e,n){I("MemoryPersistence","Starting transaction:",t);const s=new Vi(this.Nn.next());return this.referenceDelegate.Ei(),n(s).next((t=>this.referenceDelegate.Ti(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Ai(t,e){return Ps.or(Object.values(this.pi).map((n=>()=>n.containsKey(t,e))))}}class Vi extends Ls{constructor(t){super(),this.currentSequenceNumber=t}}class qi{constructor(t){this.persistence=t,this.Ri=new ki,this.Pi=null}static bi(t){return new qi(t)}get vi(){if(this.Pi)return this.Pi;throw _()}addReference(t,e,n){return this.Ri.addReference(n,e),this.vi.delete(n.toString()),Ps.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.vi.add(n.toString()),Ps.resolve()}markPotentiallyOrphaned(t,e){return this.vi.add(e.toString()),Ps.resolve()}removeTarget(t,e){this.Ri.si(e.targetId).forEach((t=>this.vi.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.vi.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ei(){this.Pi=new Set}Ti(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ps.forEach(this.vi,(n=>{const s=pt.fromPath(n);return this.Vi(t,s).next((t=>{t||e.removeEntry(s,Q.min())}))})).next((()=>(this.Pi=null,e.apply(t))))}updateLimboDocument(t,e){return this.Vi(t,e).next((t=>{t?this.vi.delete(e.toString()):this.vi.add(e.toString())}))}Ii(t){return 0}Vi(t,e){return Ps.or([()=>Ps.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}function Ui(t,e){return`firestore_clients_${t}_${e}`}function ji(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function Bi(t,e){return`firestore_targets_${t}_${e}`}class Ki{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Si(t,e,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new C(s.error.code,s.error.message))),r?new Ki(t,e,s.state,i):(T("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Di(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Gi{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Si(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new C(n.error.code,n.error.message))),i?new Gi(t,n.state,s):(T("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Di(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class $i{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Si(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=vn();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=mt(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new $i(t,i):(T("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Qi{constructor(t,e){this.clientId=t,this.onlineState=e}static Si(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Qi(e.clientId,e.onlineState):(T("SharedClientState",`Failed to parse online state: ${t}`),null)}}class zi{constructor(){this.activeTargetIds=vn()}Ci(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ni(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Di(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Hi{constructor(t,e,n,s,i){this.window=t,this.Sn=e,this.persistenceKey=n,this.xi=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ki=this.Oi.bind(this),this.Mi=new rn(rt),this.started=!1,this.$i=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Fi=Ui(this.persistenceKey,this.xi),this.Bi=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.Mi=this.Mi.insert(this.xi,new zi),this.Li=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.Ui=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.qi=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.Ki=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Gi=function(t){return`firestore_bundle_loaded_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.ki)}static Vt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.ds();for(const e of t){if(e===this.xi)continue;const t=this.getItem(Ui(this.persistenceKey,e));if(t){const n=$i.Si(e,t);n&&(this.Mi=this.Mi.insert(n.clientId,n))}}this.ji();const e=this.storage.getItem(this.Ki);if(e){const t=this.Qi(e);t&&this.Wi(t)}for(const t of this.$i)this.Oi(t);this.$i=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.Bi,JSON.stringify(t))}getAllActiveQueryTargets(){return this.zi(this.Mi)}isActiveQueryTarget(t){let e=!1;return this.Mi.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.Hi(t,"pending")}updateMutationState(t,e,n){this.Hi(t,e,n),this.Ji(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(Bi(this.persistenceKey,t));if(n){const s=Gi.Si(t,n);s&&(e=s.state)}}return this.Yi.Ci(t),this.ji(),e}removeLocalQueryTarget(t){this.Yi.Ni(t),this.ji()}isLocalQueryTarget(t){return this.Yi.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Bi(this.persistenceKey,t))}updateQueryState(t,e,n){this.Xi(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Ji(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Zi(t)}notifyBundleLoaded(){this.tr()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ki),this.removeItem(this.Fi),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return I("SharedClientState","READ",t,e),e}setItem(t,e){I("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){I("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Oi(t){const e=t;if(e.storageArea===this.storage){if(I("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Fi)return void T("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Sn.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.Li.test(e.key)){if(null==e.newValue){const t=this.er(e.key);return this.nr(t,null)}{const t=this.sr(e.key,e.newValue);if(t)return this.nr(t.clientId,t)}}else if(this.Ui.test(e.key)){if(null!==e.newValue){const t=this.ir(e.key,e.newValue);if(t)return this.rr(t)}}else if(this.qi.test(e.key)){if(null!==e.newValue){const t=this.cr(e.key,e.newValue);if(t)return this.ur(t)}}else if(e.key===this.Ki){if(null!==e.newValue){const t=this.Qi(e.newValue);if(t)return this.Wi(t)}}else if(e.key===this.Bi){const t=function(t){let e=U.A;if(null!=t)try{const n=JSON.parse(t);x("number"==typeof n),e=n}catch(t){T("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==U.A&&this.sequenceNumberHandler(t)}else if(e.key===this.Gi)return this.syncEngine.ar()}else this.$i.push(e)}))}}get Yi(){return this.Mi.get(this.xi)}ji(){this.setItem(this.Fi,this.Yi.Di())}Hi(t,e,n){const s=new Ki(this.currentUser,t,e,n),i=ji(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Di())}Ji(t){const e=ji(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Zi(t){const e={clientId:this.xi,onlineState:t};this.storage.setItem(this.Ki,JSON.stringify(e))}Xi(t,e,n){const s=Bi(this.persistenceKey,t),i=new Gi(t,e,n);this.setItem(s,i.Di())}tr(){this.setItem(this.Gi,"value-not-used")}er(t){const e=this.Li.exec(t);return e?e[1]:null}sr(t,e){const n=this.er(t);return $i.Si(n,e)}ir(t,e){const n=this.Ui.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ki.Si(new f(i),s,e)}cr(t,e){const n=this.qi.exec(t),s=Number(n[1]);return Gi.Si(s,e)}Qi(t){return Qi.Si(t)}async rr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.hr(t.batchId,t.state,t.error);I("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}ur(t){return this.syncEngine.lr(t.targetId,t.state,t.error)}nr(t,e){const n=e?this.Mi.insert(t,e):this.Mi.remove(t),s=this.zi(this.Mi),i=this.zi(n),r=[],o=[];return i.forEach((t=>{s.has(t)||r.push(t)})),s.forEach((t=>{i.has(t)||o.push(t)})),this.syncEngine.dr(r,o).then((()=>{this.Mi=n}))}Wi(t){this.Mi.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}zi(t){let e=vn();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class Wi{constructor(){this._r=new zi,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this._r.Ci(t),this.wr[t]||"not-current"}updateQueryState(t,e,n){this.wr[t]=e}removeLocalQueryTarget(t){this._r.Ni(t)}isLocalQueryTarget(t){return this._r.activeTargetIds.has(t)}clearQueryState(t){delete this.wr[t]}getAllActiveQueryTargets(){return this._r.activeTargetIds}isActiveQueryTarget(t){return this._r.activeTargetIds.has(t)}start(){return this._r=new zi,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class Yi{mr(t){}shutdown(){}}class Xi{constructor(){this.gr=()=>this.yr(),this.pr=()=>this.Ir(),this.Er=[],this.Tr()}mr(t){this.Er.push(t)}shutdown(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}Tr(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}yr(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Er)t(0)}Ir(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Er)t(1)}static Vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Ji={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Zi{constructor(t){this.Ar=t.Ar,this.Rr=t.Rr}Pr(t){this.br=t}vr(t){this.Vr=t}onMessage(t){this.Sr=t}close(){this.Rr()}send(t){this.Ar(t)}Dr(){this.br()}Cr(t){this.Vr(t)}Nr(t){this.Sr(t)}}class to extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.kr=e+"://"+t.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Mr(t,e,n,s,i){const r=this.$r(t,e);I("RestConnection","Sending: ",r,n);const o={};return this.Fr(o,s,i),this.Br(t,r,o,n).then((t=>(I("RestConnection","Received: ",t),t)),(e=>{throw E("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}Lr(t,e,n,s,i){return this.Mr(t,e,n,s,i)}Fr(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+m,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}$r(t,e){const n=Ji[t];return`${this.kr}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}Br(t,e,n,s){return new Promise(((i,r)=>{const o=new l.g;o.listenOnce(l.c.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case l.a.NO_ERROR:const e=o.getResponseJson();I("Connection","XHR received:",JSON.stringify(e)),i(e);break;case l.a.TIMEOUT:I("Connection",'RPC "'+t+'" timed out'),r(new C(N.DEADLINE_EXCEEDED,"Request time out"));break;case l.a.HTTP_ERROR:const n=o.getStatus();if(I("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(e)>=0?e:N.UNKNOWN}(t.status);r(new C(e,t.message))}else r(new C(N.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new C(N.UNAVAILABLE,"Connection failed."));break;default:_()}}finally{I("Connection",'RPC "'+t+'" completed.')}}));const c=JSON.stringify(s);o.send(e,"POST",c,n,15)}))}Ur(t,e,n){const s=[this.kr,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Object(l.h)(),r=Object(l.i)(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new l.d({})),this.Fr(o.initMessageHeaders,e,n),Object(h.u)()||Object(h.w)()||Object(h.q)()||Object(h.s)()||Object(h.y)()||Object(h.p)()||(o.httpHeadersOverwriteParam="$httpHeaders");const c=s.join("");I("Connection","Creating WebChannel: "+c,o);const u=i.createWebChannel(c,o);let a=!1,d=!1;const f=new Zi({Ar:t=>{d?I("Connection","Not sending because WebChannel is closed:",t):(a||(I("Connection","Opening WebChannel transport."),u.open(),a=!0),I("Connection","WebChannel sending:",t),u.send(t))},Rr:()=>u.close()}),m=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return m(u,l.f.EventType.OPEN,(()=>{d||I("Connection","WebChannel transport opened.")})),m(u,l.f.EventType.CLOSE,(()=>{d||(d=!0,I("Connection","WebChannel transport closed"),f.Cr())})),m(u,l.f.EventType.ERROR,(t=>{d||(d=!0,E("Connection","WebChannel transport errored:",t),f.Cr(new C(N.UNAVAILABLE,"The operation could not be completed")))})),m(u,l.f.EventType.MESSAGE,(t=>{var e;if(!d){const n=t.data[0];x(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){I("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=tn[t];if(void 0!==e)return sn(e)}(t),n=i.message;void 0===e&&(e=N.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),d=!0,f.Cr(new C(e,n)),u.close()}else I("Connection","WebChannel received:",n),f.Nr(n)}})),m(r,l.b.STAT_EVENT,(t=>{t.stat===l.e.PROXY?I("Connection","Detected buffering proxy"):t.stat===l.e.NOPROXY&&I("Connection","Detected no buffering proxy")})),setTimeout((()=>{f.Dr()}),0),f}}function eo(){return"undefined"!=typeof window?window:null}function no(){return"undefined"!=typeof document?document:null}function so(t){return new kn(t,!0)}class ro{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Sn=t,this.timerId=e,this.qr=n,this.Kr=s,this.Gr=i,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}reset(){this.jr=0}zr(){this.jr=this.Gr}Hr(t){this.cancel();const e=Math.floor(this.jr+this.Jr()),n=Math.max(0,Date.now()-this.Wr),s=Math.max(0,e-n);s>0&&I("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.jr} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,s,(()=>(this.Wr=Date.now(),t()))),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}Yr(){null!==this.Qr&&(this.Qr.skipDelay(),this.Qr=null)}cancel(){null!==this.Qr&&(this.Qr.cancel(),this.Qr=null)}Jr(){return(Math.random()-.5)*this.jr}}class io{constructor(t,e,n,s,i,r,o,c){this.Sn=t,this.Xr=n,this.Zr=s,this.eo=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new ro(t,e)}oo(){return 1===this.state||5===this.state||this.co()}co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.uo()}async stop(){this.oo()&&await this.close(0)}ao(){this.state=0,this.ro.reset()}ho(){this.co()&&null===this.so&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,(()=>this.lo())))}fo(t){this._o(),this.stream.send(t)}async lo(){if(this.co())return this.close(0)}_o(){this.so&&(this.so.cancel(),this.so=null)}wo(){this.io&&(this.io.cancel(),this.io=null)}async close(t,e){this._o(),this.wo(),this.ro.cancel(),this.no++,4!==t?this.ro.reset():e&&e.code===N.RESOURCE_EXHAUSTED?(T(e.toString()),T("Using maximum backoff delay to prevent overloading the backend."),this.ro.zr()):e&&e.code===N.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.mo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.vr(e)}mo(){}auth(){this.state=1;const t=this.yo(this.no),e=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.no===e&&this.po(t,n)}),(e=>{t((()=>{const t=new C(N.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Io(t)}))}))}po(t,e){const n=this.yo(this.no);this.stream=this.Eo(t,e),this.stream.Pr((()=>{n((()=>(this.state=2,this.io=this.Sn.enqueueAfterDelay(this.Zr,1e4,(()=>(this.co()&&(this.state=3),Promise.resolve()))),this.listener.Pr())))})),this.stream.vr((t=>{n((()=>this.Io(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}uo(){this.state=5,this.ro.Hr((async()=>{this.state=0,this.start()}))}Io(t){return I("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}yo(t){return e=>{this.Sn.enqueueAndForget((()=>this.no===t?e():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class oo extends io{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.O=i}Eo(t,e){return this.eo.Ur("Listen",t,e)}onMessage(t){this.ro.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.N?(x(void 0===e||"string"==typeof e),et.fromBase64String(e||"")):(x(void 0===e||e instanceof Uint8Array),et.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(t){const e=void 0===t.code?N.UNKNOWN:sn(t.code);return new C(e,t.message||"")}(o);n=new Sn(s,i,r,c||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=qn(t,s.document.name),r=Pn(s.document.updateTime),o=new Ot({mapValue:{fields:s.document.fields}}),c=Lt.newFoundDocument(i,r,o),u=s.targetIds||[],a=s.removedTargetIds||[];n=new Tn(u,a,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=qn(t,s.document),r=s.readTime?Pn(s.readTime):Q.min(),o=Lt.newNoDocument(i,r),c=s.removedTargetIds||[];n=new Tn([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=qn(t,s.document),r=s.removedTargetIds||[];n=new Tn([],r,i,null)}else{if(!("filter"in e))return _();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new Ze(s),r=t.targetId;n=new En(r,i)}}return n}(this.O,t),n=function(t){if(!("targetChange"in t))return Q.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Q.min():e.readTime?Pn(e.readTime):Q.min()}(t);return this.listener.To(e,n)}Ao(t){const e={};e.database=Bn(this.O),e.addTarget=function(t,e){let n;const s=e.target;return n=Kt(s)?{documents:Hn(t,s)}:{query:Wn(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Rn(t,e.resumeToken):e.snapshotVersion.compareTo(Q.min())>0&&(n.readTime=On(t,e.snapshotVersion.toTimestamp())),n}(this.O,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.O,t);n&&(e.labels=n),this.fo(e)}Ro(t){const e={};e.database=Bn(this.O),e.removeTarget=t,this.fo(e)}}class ao extends io{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.O=i,this.Po=!1}get bo(){return this.Po}start(){this.Po=!1,this.lastStreamToken=void 0,super.start()}mo(){this.Po&&this.vo([])}Eo(t,e){return this.eo.Ur("Write",t,e)}onMessage(t){if(x(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Po){this.ro.reset();const e=function(t,e){return t&&t.length>0?(x(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Pn(t.updateTime):Pn(e);return n.isEqual(Q.min())&&(n=Pn(e)),new Fe(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Pn(t.commitTime);return this.listener.Vo(n,e)}return x(!t.writeResults||0===t.writeResults.length),this.Po=!0,this.listener.So()}Do(){const t={};t.database=Bn(this.O),this.fo(t)}vo(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Qn(this.O,t)))};this.fo(e)}}class co extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.eo=n,this.O=s,this.Co=!1}No(){if(this.Co)throw new C(N.FAILED_PRECONDITION,"The client has already been terminated.")}Mr(t,e,n){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.eo.Mr(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new C(N.UNKNOWN,t.toString())}))}Lr(t,e,n){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.eo.Lr(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new C(N.UNKNOWN,t.toString())}))}terminate(){this.Co=!0}}class uo{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}Mo(){0===this.xo&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ko=null,this.Fo("Backend didn't respond within 10 seconds."),this.$o("Offline"),Promise.resolve()))))}Bo(t){"Online"===this.state?this.$o("Unknown"):(this.xo++,this.xo>=1&&(this.Lo(),this.Fo(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.$o("Offline")))}set(t){this.Lo(),this.xo=0,"Online"===t&&(this.Oo=!1),this.$o(t)}$o(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Fo(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Oo?(T(e),this.Oo=!1):I("OnlineStateTracker",e)}Lo(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}}class ho{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=i,this.jo.mr((t=>{n.enqueueAndForget((async()=>{bo(this)&&(I("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=A(t);e.Ko.add(4),await fo(e),e.Qo.set("Unknown"),e.Ko.delete(4),await lo(e)}(this))}))})),this.Qo=new uo(n,s)}}async function lo(t){if(bo(t))for(const e of t.Go)await e(!0)}async function fo(t){for(const e of t.Go)await e(!1)}function go(t,e){const n=A(t);n.qo.has(e.targetId)||(n.qo.set(e.targetId,e),vo(n)?wo(n):Vo(n).co()&&po(n,e))}function mo(t,e){const n=A(t),s=Vo(n);n.qo.delete(e),s.co()&&yo(n,e),0===n.qo.size&&(s.co()?s.ho():bo(n)&&n.Qo.set("Unknown"))}function po(t,e){t.Wo.Z(e.targetId),Vo(t).Ao(e)}function yo(t,e){t.Wo.Z(e),Vo(t).Ro(e)}function wo(t){t.Wo=new xn({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.qo.get(e)||null}),Vo(t).start(),t.Qo.Mo()}function vo(t){return bo(t)&&!Vo(t).oo()&&t.qo.size>0}function bo(t){return 0===A(t).Ko.size}function Io(t){t.Wo=void 0}async function To(t){t.qo.forEach(((e,n)=>{po(t,e)}))}async function Eo(t,e){Io(t),vo(t)?(t.Qo.Bo(e),wo(t)):t.Qo.set("Unknown")}async function So(t,e,n){if(t.Qo.set("Online"),e instanceof Sn&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.qo.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.qo.delete(s),t.Wo.removeTarget(s))}(t,e)}catch(n){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await _o(t,n)}else if(e instanceof Tn?t.Wo.ct(e):e instanceof En?t.Wo._t(e):t.Wo.ht(e),!n.isEqual(Q.min()))try{const e=await bi(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Wo.yt(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.qo.get(s);i&&t.qo.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.qo.get(e);if(!n)return;t.qo.set(e,n.withResumeToken(et.EMPTY_BYTE_STRING,n.snapshotVersion)),yo(t,e);const s=new Ws(n.target,e,1,n.sequenceNumber);po(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){I("RemoteStore","Failed to raise snapshot:",e),await _o(t,e)}}async function _o(t,e,n){if(!Us(e))throw e;t.Ko.add(1),await fo(t),t.Qo.set("Offline"),n||(n=()=>bi(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{I("RemoteStore","Retrying IndexedDB access"),await n(),t.Ko.delete(1),await lo(t)}))}function xo(t,e){return e().catch((n=>_o(t,n,e)))}async function Ao(t){const e=A(t),n=qo(e);let s=e.Uo.length>0?e.Uo[e.Uo.length-1].batchId:-1;for(;No(e);)try{const t=await Ti(e.localStore,s);if(null===t){0===e.Uo.length&&n.ho();break}s=t.batchId,Co(e,t)}catch(t){await _o(e,t)}Do(e)&&ko(e)}function No(t){return bo(t)&&t.Uo.length<10}function Co(t,e){t.Uo.push(e);const n=qo(t);n.co()&&n.bo&&n.vo(e.mutations)}function Do(t){return bo(t)&&!qo(t).oo()&&t.Uo.length>0}function ko(t){qo(t).start()}async function Oo(t){qo(t).Do()}async function Ro(t){const e=qo(t);for(const n of t.Uo)e.vo(n.mutations)}async function Lo(t,e,n){const s=t.Uo.shift(),i=zs.from(s,e,n);await xo(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Ao(t)}async function Po(t,e){e&&qo(t).bo&&await async function(t,e){if(nn(n=e.code)&&n!==N.ABORTED){const n=t.Uo.shift();qo(t).ao(),await xo(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Ao(t)}var n}(t,e),Do(t)&&ko(t)}async function Mo(t,e){const n=A(t);n.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const s=bo(n);n.Ko.add(3),await fo(n),s&&n.Qo.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ko.delete(3),await lo(n)}async function Fo(t,e){const n=A(t);e?(n.Ko.delete(2),await lo(n)):e||(n.Ko.add(2),await fo(n),n.Qo.set("Unknown"))}function Vo(t){return t.zo||(t.zo=function(t,e,n){const s=A(t);return s.No(),new oo(e,s.eo,s.authCredentials,s.appCheckCredentials,s.O,n)}(t.datastore,t.asyncQueue,{Pr:To.bind(null,t),vr:Eo.bind(null,t),To:So.bind(null,t)}),t.Go.push((async e=>{e?(t.zo.ao(),vo(t)?wo(t):t.Qo.set("Unknown")):(await t.zo.stop(),Io(t))}))),t.zo}function qo(t){return t.Ho||(t.Ho=function(t,e,n){const s=A(t);return s.No(),new ao(e,s.eo,s.authCredentials,s.appCheckCredentials,s.O,n)}(t.datastore,t.asyncQueue,{Pr:Oo.bind(null,t),vr:Po.bind(null,t),So:Ro.bind(null,t),Vo:Lo.bind(null,t)}),t.Go.push((async e=>{e?(t.Ho.ao(),await Ao(t)):(await t.Ho.stop(),t.Uo.length>0&&(I("RemoteStore",`Stopping write stream with ${t.Uo.length} pending writes`),t.Uo=[]))}))),t.Ho}class Uo{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new D,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new Uo(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(N.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function jo(t,e){if(T("AsyncQueue",`${e}: ${t}`),Us(t))return new C(N.UNAVAILABLE,`${e}: ${t}`);throw t}class Bo{constructor(t){this.comparator=t?(e,n)=>t(e,n)||pt.comparator(e.key,n.key):(t,e)=>pt.comparator(t.key,e.key),this.keyedMap=gn(),this.sortedSet=new rn(this.comparator)}static emptySet(t){return new Bo(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Bo))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Bo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Ko{constructor(){this.Jo=new rn(pt.comparator)}track(t){const e=t.doc.key,n=this.Jo.get(e);n?0!==t.type&&3===n.type?this.Jo=this.Jo.insert(e,t):3===t.type&&1!==n.type?this.Jo=this.Jo.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jo=this.Jo.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jo=this.Jo.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jo=this.Jo.remove(e):1===t.type&&2===n.type?this.Jo=this.Jo.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jo=this.Jo.insert(e,{type:2,doc:t.doc}):_():this.Jo=this.Jo.insert(e,t)}Yo(){const t=[];return this.Jo.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Go{constructor(t,e,n,s,i,r,o,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=c}static fromInitialDocuments(t,e,n,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new Go(t,e,Bo.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&me(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class $o{constructor(){this.Xo=void 0,this.listeners=[]}}class Qo{constructor(){this.queries=new Zr((t=>pe(t)),me),this.onlineState="Unknown",this.Zo=new Set}}async function zo(t,e){const n=A(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new $o),i)try{r.Xo=await n.onListen(s)}catch(t){const n=jo(t,`Initialization of query '${ye(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.tc(n.onlineState),r.Xo&&e.ec(r.Xo)&&Xo(n)}async function Ho(t,e){const n=A(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function Wo(t,e){const n=A(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.ec(t)&&(s=!0);i.Xo=t}}s&&Xo(n)}function Yo(t,e,n){const s=A(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function Xo(t){t.Zo.forEach((t=>{t.next()}))}class Jo{constructor(t,e,n){this.query=t,this.nc=e,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=n||{}}ec(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Go(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.sc?this.rc(t)&&(this.nc.next(t),e=!0):this.oc(t,this.onlineState)&&(this.cc(t),e=!0),this.ic=t,e}onError(t){this.nc.error(t)}tc(t){this.onlineState=t;let e=!1;return this.ic&&!this.sc&&this.oc(this.ic,t)&&(this.cc(this.ic),e=!0),e}oc(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.uc&&n||t.docs.isEmpty()&&"Offline"!==e)}rc(t){if(t.docChanges.length>0)return!0;const e=this.ic&&this.ic.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}cc(t){t=Go.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.sc=!0,this.nc.next(t)}}class Zo{constructor(t,e){this.payload=t,this.byteLength=e}ac(){return"metadata"in this.payload}}class ta{constructor(t){this.O=t}Gs(t){return qn(this.O,t)}js(t){return t.metadata.exists?$n(this.O,t.document,!1):Lt.newNoDocument(this.Gs(t.metadata.name),this.Qs(t.metadata.readTime))}Qs(t){return Pn(t)}}class ea{constructor(t,e,n){this.hc=t,this.localStore=e,this.O=n,this.queries=[],this.documents=[],this.progress=na(t)}lc(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}fc(t){const e=new Map,n=new ta(this.O);for(const s of t)if(s.metadata.queries){const t=n.Gs(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||yn()).add(t);e.set(n,s)}}return e}async complete(){const t=await async function(t,e,n,s){const i=A(t);let r=yn(),o=dn();for(const t of n){const n=e.Gs(t.metadata.name);t.document&&(r=r.add(n));const s=e.js(t);s.setReadTime(e.Qs(t.metadata.readTime)),o=o.insert(n,s)}const c=i.Bs.newChangeBuffer({trackRemovals:!0}),u=await Ei(i,function(t){return fe(oe(Y.fromString(`__bundle__/docs/${t}`)))}(s));return i.persistence.runTransaction("Apply bundle documents","readwrite",(t=>Ii(t,c,o).next((e=>(c.apply(t),e))).next((e=>i.Un.removeMatchingKeysForTargetId(t,u.targetId).next((()=>i.Un.addMatchingKeys(t,r,u.targetId))).next((()=>i.Us.Ts(t,e))).next((()=>e))))))}(this.localStore,new ta(this.O),this.documents,this.hc.id),e=this.fc(this.documents);for(const t of this.queries)await Ni(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",new fi(Object.assign({},this.progress),t)}}function na(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class sa{constructor(t){this.key=t}}class ra{constructor(t){this.key=t}}class ia{constructor(t,e){this.query=t,this.dc=e,this._c=null,this.current=!1,this.wc=yn(),this.mutatedKeys=yn(),this.mc=ve(t),this.gc=new Bo(this.mc)}get yc(){return this.dc}Ic(t,e){const n=e?e.Ec:new Ko,s=e?e.gc:this.gc;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const c=ae(this.query)&&s.size===this.query.limit?s.last():null,u=ce(this.query)&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const a=s.get(t),h=we(this.query,e)?e:null,l=!!a&&this.mutatedKeys.has(a.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;a&&h?a.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Tc(a,h)||(n.track({type:2,doc:h}),f=!0,(c&&this.mc(h,c)>0||u&&this.mc(h,u)<0)&&(o=!0)):!a&&h?(n.track({type:0,doc:h}),f=!0):a&&!h&&(n.track({type:1,doc:a}),f=!0,(c||u)&&(o=!0)),f&&(h?(r=r.add(h),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),ae(this.query)||ce(this.query))for(;r.size>this.query.limit;){const t=ae(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{gc:r,Ec:n,ks:o,mutatedKeys:i}}Tc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.gc;this.gc=t.gc,this.mutatedKeys=t.mutatedKeys;const i=t.Ec.Yo();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _()}};return n(t)-n(e)}(t.type,e.type)||this.mc(t.doc,e.doc))),this.Ac(n);const r=e?this.Rc():[],o=0===this.wc.size&&this.current?1:0,c=o!==this._c;return this._c=o,0!==i.length||c?{snapshot:new Go(this.query,t.gc,s,i,t.mutatedKeys,0===o,c,!1),Pc:r}:{Pc:r}}tc(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new Ko,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}bc(t){return!this.dc.has(t)&&!!this.gc.has(t)&&!this.gc.get(t).hasLocalMutations}Ac(t){t&&(t.addedDocuments.forEach((t=>this.dc=this.dc.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.dc=this.dc.delete(t))),this.current=t.current)}Rc(){if(!this.current)return[];const t=this.wc;this.wc=yn(),this.gc.forEach((t=>{this.bc(t.key)&&(this.wc=this.wc.add(t.key))}));const e=[];return t.forEach((t=>{this.wc.has(t)||e.push(new ra(t))})),this.wc.forEach((n=>{t.has(n)||e.push(new sa(n))})),e}vc(t){this.dc=t.Ks,this.wc=yn();const e=this.Ic(t.documents);return this.applyChanges(e,!0)}Vc(){return Go.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,0===this._c)}}class oa{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class aa{constructor(t){this.key=t,this.Sc=!1}}class ca{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.Dc={},this.Cc=new Zr((t=>pe(t)),me),this.Nc=new Map,this.xc=new Set,this.kc=new rn(pt.comparator),this.Oc=new Map,this.Mc=new ki,this.$c={},this.Fc=new Map,this.Bc=Br.Je(),this.onlineState="Unknown",this.Lc=void 0}get isPrimaryClient(){return!0===this.Lc}}async function ua(t,e){const n=Pa(t);let s,i;const r=n.Cc.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.Vc();else{const t=await Ei(n.localStore,fe(e));n.isPrimaryClient&&go(n.remoteStore,t);const r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await ha(n,e,s,"current"===r)}return i}async function ha(t,e,n,s){t.Uc=(e,n,s)=>async function(t,e,n,s){let i=e.view.Ic(n);i.ks&&(i=await _i(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ic(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return Ia(t,e.targetId,o.Pc),o.snapshot}(t,e,n,s);const i=await _i(t.localStore,e,!0),r=new ia(e,i.Ks),o=r.Ic(i.documents),c=In.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState),u=r.applyChanges(o,t.isPrimaryClient,c);Ia(t,n,u.Pc);const a=new oa(e,n,r);return t.Cc.set(e,a),t.Nc.has(n)?t.Nc.get(n).push(e):t.Nc.set(n,[e]),u.snapshot}async function la(t,e){const n=A(t),s=n.Cc.get(e),i=n.Nc.get(s.targetId);if(i.length>1)return n.Nc.set(s.targetId,i.filter((t=>!me(t,e)))),void n.Cc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Si(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),mo(n.remoteStore,s.targetId),va(n,s.targetId)})).catch(Qr)):(va(n,s.targetId),await Si(n.localStore,s.targetId,!0))}async function da(t,e){const n=A(t);try{const t=await function(t,e){const n=A(t),s=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.Ms;const o=[];e.targetChanges.forEach(((r,c)=>{const u=i.get(c);if(!u)return;o.push(n.Un.removeMatchingKeys(t,r.removedDocuments,c).next((()=>n.Un.addMatchingKeys(t,r.addedDocuments,c))));let a=u.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(c)?a=a.withResumeToken(et.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):r.resumeToken.approximateByteSize()>0&&(a=a.withResumeToken(r.resumeToken,s)),i=i.insert(c,a),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(u,a,r)&&o.push(n.Un.updateTargetData(t,a))}));let c=dn();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(Ii(t,r,e.documentUpdates).next((t=>{c=t}))),!s.isEqual(Q.min())){const e=n.Un.getLastRemoteSnapshotVersion(t).next((e=>n.Un.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return Ps.waitFor(o).next((()=>r.apply(t))).next((()=>n.Us.Ts(t,c))).next((()=>c))})).then((t=>(n.Ms=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.Oc.get(e);s&&(x(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.Sc=!0:t.modifiedDocuments.size>0?x(s.Sc):t.removedDocuments.size>0&&(x(s.Sc),s.Sc=!1))})),await Sa(n,t,e)}catch(t){await Qr(t)}}function fa(t,e,n){const s=A(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.Cc.forEach(((n,s)=>{const i=s.view.tc(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=A(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.tc(e)&&(s=!0)})),s&&Xo(n)}(s.eventManager,e),t.length&&s.Dc.To(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function ga(t,e,n){const s=A(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Oc.get(e),r=i&&i.key;if(r){let t=new rn(pt.comparator);t=t.insert(r,Lt.newNoDocument(r,Q.min()));const n=yn().add(r),i=new bn(Q.min(),new Map,new cn(rt),t,n);await da(s,i),s.kc=s.kc.remove(r),s.Oc.delete(e),Ea(s)}else await Si(s.localStore,e,!1).then((()=>va(s,e,n))).catch(Qr)}async function ma(t,e){const n=A(t),s=e.batch.batchId;try{const t=await function(t,e){const n=A(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.Bs.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Ps.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);x(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.gs.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.gs.performConsistencyCheck(t))).next((()=>n.Us.Es(t,s)))}))}(n.localStore,e);wa(n,s,null),ya(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Sa(n,t)}catch(t){await Qr(t)}}async function pa(t,e,n){const s=A(t);try{const t=await function(t,e){const n=A(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.gs.lookupMutationBatch(t,e).next((e=>(x(null!==e),s=e.keys(),n.gs.removeMutationBatch(t,e)))).next((()=>n.gs.performConsistencyCheck(t))).next((()=>n.Us.Es(t,s)))}))}(s.localStore,e);wa(s,e,n),ya(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Sa(s,t)}catch(n){await Qr(n)}}function ya(t,e){(t.Fc.get(e)||[]).forEach((t=>{t.resolve()})),t.Fc.delete(e)}function wa(t,e,n){const s=A(t);let i=s.$c[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.$c[s.currentUser.toKey()]=i}}function va(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Nc.get(e))t.Cc.delete(s),n&&t.Dc.qc(s,n);t.Nc.delete(e),t.isPrimaryClient&&t.Mc.si(e).forEach((e=>{t.Mc.containsKey(e)||ba(t,e)}))}function ba(t,e){t.xc.delete(e.path.canonicalString());const n=t.kc.get(e);null!==n&&(mo(t.remoteStore,n),t.kc=t.kc.remove(e),t.Oc.delete(n),Ea(t))}function Ia(t,e,n){for(const s of n)s instanceof sa?(t.Mc.addReference(s.key,e),Ta(t,s)):s instanceof ra?(I("SyncEngine","Document no longer in limbo: "+s.key),t.Mc.removeReference(s.key,e),t.Mc.containsKey(s.key)||ba(t,s.key)):_()}function Ta(t,e){const n=e.key,s=n.path.canonicalString();t.kc.get(n)||t.xc.has(s)||(I("SyncEngine","New document in limbo: "+n),t.xc.add(s),Ea(t))}function Ea(t){for(;t.xc.size>0&&t.kc.size<t.maxConcurrentLimboResolutions;){const e=t.xc.values().next().value;t.xc.delete(e);const n=new pt(Y.fromString(e)),s=t.Bc.next();t.Oc.set(s,new aa(n)),t.kc=t.kc.insert(n,s),go(t.remoteStore,new Ws(fe(oe(n.path)),s,2,U.A))}}async function Sa(t,e,n){const s=A(t),i=[],r=[],o=[];s.Cc.isEmpty()||(s.Cc.forEach(((t,c)=>{o.push(s.Uc(c,e,n).then((t=>{if(t){s.isPrimaryClient&&s.sharedClientState.updateQueryState(c.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=mi.Ss(c.targetId,t);r.push(e)}})))})),await Promise.all(o),s.Dc.To(i),await async function(t,e){const n=A(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Ps.forEach(e,(e=>Ps.forEach(e.vs,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>Ps.forEach(e.Vs,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!Us(t))throw t;I("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ms.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.Ms=n.Ms.insert(e,i)}}}(s.localStore,r))}async function _a(t,e){const n=A(t);if(!n.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const t=await vi(n.localStore,e);n.currentUser=e,function(t,e){t.Fc.forEach((t=>{t.forEach((t=>{t.reject(new C(N.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Sa(n,t.qs)}}function xa(t,e){const n=A(t),s=n.Oc.get(e);if(s&&s.Sc)return yn().add(s.key);{let t=yn();const s=n.Nc.get(e);if(!s)return t;for(const e of s){const s=n.Cc.get(e);t=t.unionWith(s.view.yc)}return t}}async function Aa(t,e){const n=A(t),s=await _i(n.localStore,e.query,!0),i=e.view.vc(s);return n.isPrimaryClient&&Ia(n,e.targetId,i.Pc),i}async function Na(t){const e=A(t);return Ai(e.localStore).then((t=>Sa(e,t)))}async function Ca(t,e,n,s){const i=A(t),r=await function(t,e){const n=A(t),s=A(n.gs);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>s.Ge(t,e).next((e=>e?n.Us.Es(t,e):Ps.resolve(null)))))}(i.localStore,e);null!==r?("pending"===n?await Ao(i.remoteStore):"acknowledged"===n||"rejected"===n?(wa(i,e,s||null),ya(i,e),function(t,e){A(A(t).gs).Qe(e)}(i.localStore,e)):_(),await Sa(i,r)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Da(t,e,n){const s=A(t),i=[],r=[];for(const t of e){let e;const n=s.Nc.get(t);if(n&&0!==n.length){e=await Ei(s.localStore,fe(n[0]));for(const t of n){const e=s.Cc.get(t),n=await Aa(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await xi(s.localStore,t);e=await Ei(s.localStore,n),await ha(s,ka(n),t,!1)}i.push(e)}return s.Dc.To(r),i}function ka(t){return ie(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Oa(t){const e=A(t);return A(A(e.localStore).persistence).ds()}async function Ra(t,e,n,s){const i=A(t);if(i.Lc)I("SyncEngine","Ignoring unexpected query state notification.");else if(i.Nc.has(e))switch(n){case"current":case"not-current":{const t=await Ai(i.localStore),s=bn.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await Sa(i,t,s);break}case"rejected":await Si(i.localStore,e,!0),va(i,e,s);break;default:_()}}async function La(t,e,n){const s=Pa(t);if(s.Lc){for(const t of e){if(s.Nc.has(t)){I("SyncEngine","Adding an already active target "+t);continue}const e=await xi(s.localStore,t),n=await Ei(s.localStore,e);await ha(s,ka(e),n.targetId,!1),go(s.remoteStore,n)}for(const t of n)s.Nc.has(t)&&await Si(s.localStore,t,!1).then((()=>{mo(s.remoteStore,t),va(s,t)})).catch(Qr)}}function Pa(t){const e=A(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=da.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xa.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ga.bind(null,e),e.Dc.To=Wo.bind(null,e.eventManager),e.Dc.qc=Yo.bind(null,e.eventManager),e}function Ma(t){const e=A(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ma.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pa.bind(null,e),e}class Fa{constructor(){this.synchronizeTabs=!1}async initialize(t){this.O=so(t.databaseInfo.databaseId),this.sharedClientState=this.Gc(t),this.persistence=this.jc(t),await this.persistence.start(),this.gcScheduler=this.Qc(t),this.localStore=this.Wc(t)}Qc(t){return null}Wc(t){return wi(this.persistence,new pi,t.initialUser,this.O)}jc(t){return new Fi(qi.bi,this.O)}Gc(t){return new Wi}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Va extends Fa{constructor(t,e,n){super(),this.zc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=A(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",(t=>function(t){const e=br(t);let n=Q.min();return e.Qt({index:ys.readTimeIndex,reverse:!0},((t,e,s)=>{e.readTime&&(n=er(e.readTime)),s.done()})).next((()=>n))}(t))).then((t=>{e.Fs=t}))}(this.localStore),await this.zc.initialize(this,t),await Ma(this.zc.syncEngine),await Ao(this.zc.remoteStore),await this.persistence.Hn((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Wc(t){return wi(this.persistence,new pi,t.initialUser,this.O)}Qc(t){const e=this.persistence.referenceDelegate.garbageCollector;return new Wr(e,t.asyncQueue)}jc(t){const e=di(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Lr.withCacheSize(this.cacheSizeBytes):Lr.DEFAULT;return new ci(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,eo(),no(),this.O,this.sharedClientState,!!this.forceOwnership)}Gc(t){return new Wi}}class qa extends Va{constructor(t,e){super(t,e,!1),this.zc=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.zc.syncEngine;this.sharedClientState instanceof Hi&&(this.sharedClientState.syncEngine={hr:Ca.bind(null,e),lr:Ra.bind(null,e),dr:La.bind(null,e),ds:Oa.bind(null,e),ar:Na.bind(null,e)},await this.sharedClientState.start()),await this.persistence.Hn((async t=>{await async function(t,e){const n=A(t);if(Pa(n),Ma(n),!0===e&&!0!==n.Lc){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await Da(n,t.toArray());n.Lc=!0,await Fo(n.remoteStore,!0);for(const t of e)go(n.remoteStore,t)}else if(!1===e&&!1!==n.Lc){const t=[];let e=Promise.resolve();n.Nc.forEach(((s,i)=>{n.sharedClientState.isLocalQueryTarget(i)?t.push(i):e=e.then((()=>(va(n,i),Si(n.localStore,i,!0)))),mo(n.remoteStore,i)})),await e,await Da(n,t),function(t){const e=A(t);e.Oc.forEach(((t,n)=>{mo(e.remoteStore,n)})),e.Mc.ii(),e.Oc=new Map,e.kc=new rn(pt.comparator)}(n),n.Lc=!1,await Fo(n.remoteStore,!1)}}(this.zc.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())}))}Gc(t){const e=eo();if(!Hi.Vt(e))throw new C(N.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=di(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Hi(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class Ua{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>fa(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=_a.bind(null,this.syncEngine),await Fo(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Qo}createDatastore(t){const e=so(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new to(s));var s;return function(t,e,n,s){return new co(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>fa(this.syncEngine,t,0),r=Xi.Vt()?new Xi:new Yi,new ho(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const c=new ca(t,e,n,s,i,r);return o&&(c.Lc=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=A(t);I("RemoteStore","RemoteStore shutting down."),e.Ko.add(5),await fo(e),e.jo.shutdown(),e.Qo.set("Unknown")}(this.remoteStore)}}function ja(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Ba{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Hc(this.observer.next,t)}error(t){this.observer.error?this.Hc(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Jc(){this.muted=!0}Hc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Ka{constructor(t,e){this.Yc=t,this.O=e,this.metadata=new D,this.buffer=new Uint8Array,this.Xc=new TextDecoder("utf-8"),this.Zc().then((t=>{t&&t.ac()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Yc.cancel()}async getMetadata(){return this.metadata.promise}async Kc(){return await this.getMetadata(),this.Zc()}async Zc(){const t=await this.tu();if(null===t)return null;const e=this.Xc.decode(t),n=Number(e);isNaN(n)&&this.eu(`length string (${e}) is not valid number`);const s=await this.nu(n);return new Zo(JSON.parse(s),t.length+n)}su(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async tu(){for(;this.su()<0&&!await this.iu(););if(0===this.buffer.length)return null;const t=this.su();t<0&&this.eu("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async nu(t){for(;this.buffer.length<t;)await this.iu()&&this.eu("Reached the end of bundle when more is expected.");const e=this.Xc.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}eu(t){throw this.Yc.cancel(),new Error(`Invalid bundle format: ${t}`)}async iu(){const t=await this.Yc.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class Ga{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new C(N.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=A(t),s=Bn(n.O)+"/documents",i={documents:e.map((t=>Vn(n.O,t)))},r=await n.Lr("BatchGetDocuments",s,i),o=new Map;r.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){x(!!e.found),e.found.name,e.found.updateTime;const n=qn(t,e.found.name),s=Pn(e.found.updateTime),i=new Ot({mapValue:{fields:e.found.fields}});return Lt.newFoundDocument(n,s,i)}(t,e):"missing"in e?function(t,e){x(!!e.missing),x(!!e.readTime);const n=qn(t,e.missing),s=Pn(e.readTime);return Lt.newNoDocument(n,s)}(t,e):_()}(n.O,t);o.set(e.key.toString(),e)}));const c=[];return e.forEach((t=>{const e=o.get(t.toString());x(!!e),c.push(e)})),c}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Xe(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=pt.fromPath(e);this.mutations.push(new Je(n,this.precondition(n)))})),await async function(t,e){const n=A(t),s=Bn(n.O)+"/documents",i={writes:e.map((t=>Qn(n.O,t)))};await n.Mr("Commit",s,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw _();e=Q.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new C(N.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Ve.updateTime(e):Ve.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Q.min()))throw new C(N.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ve.updateTime(e)}return Ve.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class $a{constructor(t,e,n,s){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=s,this.ru=5,this.ro=new ro(this.asyncQueue,"transaction_retry")}run(){this.ru-=1,this.ou()}ou(){this.ro.Hr((async()=>{const t=new Ga(this.datastore),e=this.cu(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.uu(t)}))))})).catch((t=>{this.uu(t)}))}))}cu(t){try{const e=this.updateFunction(t);return!ft(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}uu(t){this.ru>0&&this.au(t)?(this.ru-=1,this.asyncQueue.enqueueAndForget((()=>(this.ou(),Promise.resolve())))):this.deferred.reject(t)}au(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!nn(e)}return!1}}class Qa{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=f.UNAUTHENTICATED,this.clientId=B.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{I("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(I("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(N.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new D;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=jo(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function za(t,e){t.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await vi(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function Ha(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Wa(t);I("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>Mo(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Mo(e.remoteStore,n))),t.onlineComponents=e}async function Wa(t){return t.offlineComponents||(I("FirestoreClient","Using default OfflineComponentProvider"),await za(t,new Fa)),t.offlineComponents}async function Ya(t){return t.onlineComponents||(I("FirestoreClient","Using default OnlineComponentProvider"),await Ha(t,new Ua)),t.onlineComponents}function Xa(t){return Wa(t).then((t=>t.persistence))}function Ja(t){return Wa(t).then((t=>t.localStore))}function Za(t){return Ya(t).then((t=>t.remoteStore))}function tc(t){return Ya(t).then((t=>t.syncEngine))}async function ec(t){const e=await Ya(t),n=e.eventManager;return n.onListen=ua.bind(null,e.syncEngine),n.onUnlisten=la.bind(null,e.syncEngine),n}function nc(t,e,n={}){const s=new D;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new Ba({next:r=>{e.enqueueAndForget((()=>Ho(t,o)));const c=r.docs.has(n);!c&&r.fromCache?i.reject(new C(N.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&r.fromCache&&s&&"server"===s.source?i.reject(new C(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new Jo(oe(n.path),r,{includeMetadataChanges:!0,uc:!0});return zo(t,o)}(await ec(t),t.asyncQueue,e,n,s))),s.promise}function sc(t,e,n={}){const s=new D;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new Ba({next:n=>{e.enqueueAndForget((()=>Ho(t,o))),n.fromCache&&"server"===s.source?i.reject(new C(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Jo(n,r,{includeMetadataChanges:!0,uc:!0});return zo(t,o)}(await ec(t),t.asyncQueue,e,n,s))),s.promise}function rc(t,e,n,s){const i=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new Ka(t,e)}(function(t,e){if(t instanceof Uint8Array)return ja(t,e);if(t instanceof ArrayBuffer)return ja(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,so(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const s=A(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=A(t),s=Pn(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Kn.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(s)>=0))}(t.localStore,s))return await e.close(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s));n._updateProgress(na(s));const i=new ea(s,t.localStore,e.O);let r=await e.Kc();for(;r;){const t=await i.lc(r);t&&n._updateProgress(t),r=await e.Kc()}const o=await i.complete();await Sa(t,o.ws,void 0),await function(t,e){const n=A(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Kn.saveBundleMetadata(t,e)))}(t.localStore,s),n._completeWith(o.progress)}catch(t){E("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t)}})(s,e,n).then((()=>{s.sharedClientState.notifyBundleLoaded()}))}(await tc(t),i,s)}))}const ic=new Map;function oc(t,e,n){if(!n)throw new C(N.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ac(t,e,n,s){if(!0===e&&!0===s)throw new C(N.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function cc(t){if(!pt.isDocumentKey(t))throw new C(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function uc(t){if(pt.isDocumentKey(t))throw new C(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function hc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":_()}function lc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new C(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=hc(t);throw new C(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function dc(t,e){if(e<=0)throw new C(N.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class fc{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new C(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new C(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ac("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class gc{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fc({}),this._settingsFrozen=!1,t instanceof lt?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new C(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new lt(t.options.projectId)}(t))}get app(){if(!this._app)throw new C(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new C(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fc(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new O;switch(t.type){case"gapi":const e=t.client;return x(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new M(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new C(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=ic.get(t);e&&(I("ComponentProvider","Removing Datastore"),ic.delete(t),e.terminate())}(this),Promise.resolve()}}function mc(t,e,n,s={}){var i;const r=(t=lc(t,gc))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&E("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=f.MOCK_USER;else{e=Object(h.h)(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new C(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new f(r)}t._authCredentials=new R(new k(e,n))}}class pc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new pc(this.firestore,t,this._key)}}class yc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new yc(this.firestore,t,this._query)}}class wc extends yc{constructor(t,e,n){super(t,e,oe(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new pc(this.firestore,null,new pt(t))}withConverter(t){return new wc(this.firestore,t,this._path)}}function vc(t,e,...n){if(t=Object(h.m)(t),oc("collection","path",e),t instanceof gc){const s=Y.fromString(e,...n);return uc(s),new wc(t,null,s)}{if(!(t instanceof pc||t instanceof wc))throw new C(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Y.fromString(e,...n));return uc(s),new wc(t.firestore,null,s)}}function bc(t,e){if(t=lc(t,gc),oc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(N.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new yc(t,null,function(t){return new re(Y.emptyPath(),t)}(e))}function Ic(t,e,...n){if(t=Object(h.m)(t),1===arguments.length&&(e=B.R()),oc("doc","path",e),t instanceof gc){const s=Y.fromString(e,...n);return cc(s),new pc(t,null,new pt(s))}{if(!(t instanceof pc||t instanceof wc))throw new C(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Y.fromString(e,...n));return cc(s),new pc(t.firestore,t instanceof wc?t.converter:null,new pt(s))}}function Tc(t,e){return t=Object(h.m)(t),e=Object(h.m)(e),(t instanceof pc||t instanceof wc)&&(e instanceof pc||e instanceof wc)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Ec(t,e){return t=Object(h.m)(t),e=Object(h.m)(e),t instanceof yc&&e instanceof yc&&t.firestore===e.firestore&&me(t._query,e._query)&&t.converter===e.converter}class Sc{constructor(){this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new ro(this,"async_queue_retry"),this.yu=()=>{const t=no();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ro.Yr()};const t=no();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.yu)}get isShuttingDown(){return this.fu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.fu){this.fu=!0,this.mu=t||!1;const e=no();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.yu)}}enqueue(t){if(this.pu(),this.fu)return new Promise((()=>{}));const e=new D;return this.Iu((()=>this.fu&&this.mu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.lu.push(t),this.Eu())))}async Eu(){if(0!==this.lu.length){try{await this.lu[0](),this.lu.shift(),this.ro.reset()}catch(t){if(!Us(t))throw t;I("AsyncQueue","Operation failed with retryable error: "+t)}this.lu.length>0&&this.ro.Hr((()=>this.Eu()))}}Iu(t){const e=this.hu.then((()=>(this.wu=!0,t().catch((t=>{this._u=t,this.wu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw T("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.wu=!1,t))))));return this.hu=e,e}enqueueAfterDelay(t,e,n){this.pu(),this.gu.indexOf(t)>-1&&(e=0);const s=Uo.createAndSchedule(this,t,e,n,(t=>this.Tu(t)));return this.du.push(s),s}pu(){this._u&&_()}verifyOperationInProgress(){}async Au(){let t;do{t=this.hu,await t}while(t!==this.hu)}Ru(t){for(const e of this.du)if(e.timerId===t)return!0;return!1}Pu(t){return this.Au().then((()=>{this.du.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.du)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Au()}))}bu(t){this.gu.push(t)}Tu(t){const e=this.du.indexOf(t);this.du.splice(e,1)}}function _c(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class xc{constructor(){this._progressObserver={},this._taskCompletionResolver=new D,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const Ac=-1;class Nc extends gc{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new Sc,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Dc(this),this._firestoreClient.terminate()}}function Cc(t){return t._firestoreClient||Dc(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Dc(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new ht(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Qa(t._authCredentials,t._appCheckCredentials,t._queue,s)}function kc(t,e){Uc(t=lc(t,Nc));const n=Cc(t),s=t._freezeSettings(),i=new Ua;return Rc(n,i,new Va(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function Oc(t){Uc(t=lc(t,Nc));const e=Cc(t),n=t._freezeSettings(),s=new Ua;return Rc(e,s,new qa(s,n.cacheSizeBytes))}function Rc(t,e,n){const s=new D;return t.asyncQueue.enqueue((async()=>{try{await za(t,n),await Ha(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===N.FAILED_PRECONDITION||t.code===N.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}})).then((()=>s.promise))}function Lc(t){if(t._initialized&&!t._terminated)throw new C(N.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new D;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Fs.Vt())return Promise.resolve();const e=t+"main";await Fs.delete(e)}(di(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Pc(t){return function(t){const e=new D;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=A(t);bo(n.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=A(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.gs.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const s=n.Fc.get(t)||[];s.push(e),n.Fc.set(t,s)}catch(t){const n=jo(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await tc(t),e))),e.promise}(Cc(t=lc(t,Nc)))}function Mc(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Xa(t),n=await Za(t);return e.setNetworkEnabled(!0),function(t){const e=A(t);return e.Ko.delete(0),lo(e)}(n)}))}(Cc(t=lc(t,Nc)))}function Fc(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Xa(t),n=await Za(t);return e.setNetworkEnabled(!1),async function(t){const e=A(t);e.Ko.add(0),await fo(e),e.Qo.set("Offline")}(n)}))}(Cc(t=lc(t,Nc)))}function Vc(t,e){const n=Cc(t=lc(t,Nc)),s=new xc;return rc(n,t._databaseId,e,s),s}function qc(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=A(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Kn.getNamedQuery(t,e)))}(await Ja(t),e)))}(Cc(t=lc(t,Nc)),e).then((e=>e?new yc(t,null,e.query):null))}function Uc(t){if(t._initialized||t._terminated)throw new C(N.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class jc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new C(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new J(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Bc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Bc(et.fromBase64String(t))}catch(t){throw new C(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Bc(et.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Kc{constructor(t){this._methodName=t}}class Gc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return rt(this._lat,t._lat)||rt(this._long,t._long)}}const $c=/^__.*__$/;class Qc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new ze(t,this.data,this.fieldMask,e,this.fieldTransforms):new Qe(t,this.data,e,this.fieldTransforms)}}class zc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new ze(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Hc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _()}}class Wc{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.O=n,this.ignoreUndefinedProperties=s,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}Su(t){return new Wc(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Du(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Su({path:n,Cu:!1});return s.Nu(t),s}xu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Su({path:n,Cu:!1});return s.vu(),s}ku(t){return this.Su({path:void 0,Cu:!0})}Ou(t){return gu(t,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Nu(this.path.get(t))}Nu(t){if(0===t.length)throw this.Ou("Document fields must not be empty");if(Hc(this.Vu)&&$c.test(t))throw this.Ou('Document fields cannot begin and end with "__"')}}class Yc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.O=n||so(t)}Fu(t,e,n,s=!1){return new Wc({Vu:t,methodName:e,$u:n,path:J.emptyPath(),Cu:!1,Mu:s},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function Xc(t){const e=t._freezeSettings(),n=so(t._databaseId);return new Yc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Jc(t,e,n,s,i,r={}){const o=t.Fu(r.merge||r.mergeFields?2:0,e,n,i);lu("Data must be an object, but it was:",o,s);const c=uu(s,o);let u,a;if(r.merge)u=new Z(o.fieldMask),a=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=du(e,s,n);if(!o.contains(i))throw new C(N.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);mu(t,i)||t.push(i)}u=new Z(t),a=o.fieldTransforms.filter((t=>u.covers(t.field)))}else u=null,a=o.fieldTransforms;return new Qc(new Ot(c),u,a)}class Zc extends Kc{_toFieldTransform(t){if(2!==t.Vu)throw 1===t.Vu?t.Ou(`${this._methodName}() can only appear at the top level of your update data`):t.Ou(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Zc}}function tu(t,e,n){return new Wc({Vu:3,$u:e.settings.$u,methodName:t._methodName,Cu:n},e.databaseId,e.O,e.ignoreUndefinedProperties)}class eu extends Kc{_toFieldTransform(t){return new Me(t.path,new Ne)}isEqual(t){return t instanceof eu}}class nu extends Kc{constructor(t,e){super(t),this.Bu=e}_toFieldTransform(t){const e=tu(this,t,!0),n=this.Bu.map((t=>cu(t,e))),s=new Ce(n);return new Me(t.path,s)}isEqual(t){return this===t}}class su extends Kc{constructor(t,e){super(t),this.Bu=e}_toFieldTransform(t){const e=tu(this,t,!0),n=this.Bu.map((t=>cu(t,e))),s=new ke(n);return new Me(t.path,s)}isEqual(t){return this===t}}class ru extends Kc{constructor(t,e){super(t),this.Lu=e}_toFieldTransform(t){const e=new Re(t.O,Ee(t.O,this.Lu));return new Me(t.path,e)}isEqual(t){return this===t}}function iu(t,e,n,s){const i=t.Fu(1,e,n);lu("Data must be an object, but it was:",i,s);const r=[],o=Ot.empty();H(s,((t,s)=>{const c=fu(e,t,n);s=Object(h.m)(s);const u=i.xu(c);if(s instanceof Zc)r.push(c);else{const t=cu(s,u);null!=t&&(r.push(c),o.set(c,t))}}));const c=new Z(r);return new zc(o,c,i.fieldTransforms)}function ou(t,e,n,s,i,r){const o=t.Fu(1,e,n),c=[du(e,s,n)],u=[i];if(r.length%2!=0)throw new C(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)c.push(du(e,r[t])),u.push(r[t+1]);const a=[],l=Ot.empty();for(let t=c.length-1;t>=0;--t)if(!mu(a,c[t])){const e=c[t];let n=u[t];n=Object(h.m)(n);const s=o.xu(e);if(n instanceof Zc)a.push(e);else{const t=cu(n,s);null!=t&&(a.push(e),l.set(e,t))}}const d=new Z(a);return new zc(l,d,o.fieldTransforms)}function au(t,e,n,s=!1){return cu(n,t.Fu(s?4:3,e))}function cu(t,e){if(hu(t=Object(h.m)(t)))return lu("Unsupported field value:",e,t),uu(t,e);if(t instanceof Kc)return function(t,e){if(!Hc(e.Vu))throw e.Ou(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Ou(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Cu&&4!==e.Vu)throw e.Ou("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=cu(i,e.ku(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(h.m)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ee(e.O,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=$.fromDate(t);return{timestampValue:On(e.O,n)}}if(t instanceof $){const n=new $(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:On(e.O,n)}}if(t instanceof Gc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Bc)return{bytesValue:Rn(e.O,t._byteString)};if(t instanceof pc){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.Ou(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Mn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Ou(`Unsupported field value: ${hc(t)}`)}(t,e)}function uu(t,e){const n={};return W(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):H(t,((t,s)=>{const i=cu(s,e.Du(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function hu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $||t instanceof Gc||t instanceof Bc||t instanceof pc||t instanceof Kc)}function lu(t,e,n){if(!hu(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=hc(n);throw"an object"===s?e.Ou(t+" a custom object"):e.Ou(t+" "+s)}}function du(t,e,n){if((e=Object(h.m)(e))instanceof jc)return e._internalPath;if("string"==typeof e)return fu(t,e);throw gu("Field path arguments must be of type string or ",t,!1,void 0,n)}const th=new RegExp("[~\\*/\\[\\]]");function fu(t,e,n){if(e.search(th)>=0)throw gu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new jc(...e.split("."))._internalPath}catch(r){throw gu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function gu(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let c=`Function ${e}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(r||o)&&(u+=" (found",r&&(u+=` in field ${s}`),o&&(u+=` in document ${i}`),u+=")"),new C(N.INVALID_ARGUMENT,c+t+u)}function mu(t,e){return t.some((t=>t.isEqual(e)))}class pu{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new pc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new yu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(wu("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class yu extends pu{data(){return super.data()}}function wu(t,e){return"string"==typeof e?fu(t,e):e instanceof jc?e._internalPath:e._delegate._internalPath}class vu{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class bu extends pu{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Iu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(wu("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Iu extends bu{data(t={}){return super.data(t)}}class Tu{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new vu(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Iu(this._firestore,this._userDataWriter,n.key,n,new vu(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Iu(t._firestore,t._userDataWriter,n.doc.key,n.doc,new vu(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Iu(t._firestore,t._userDataWriter,e.doc.key,e.doc,new vu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Eu(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Eu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _()}}function Su(t,e){return t instanceof bu&&e instanceof bu?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Tu&&e instanceof Tu&&t._firestore===e._firestore&&Ec(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function _u(t){if(ce(t)&&0===t.explicitOrderBy.length)throw new C(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xu{}function Au(t,...e){for(const n of e)t=n._apply(t);return t}class Nu extends xu{constructor(t,e,n){super(),this.Uu=t,this.qu=e,this.Ku=n,this.type="where"}_apply(t){const e=Xc(t.firestore),n=function(t,e,n,s,i,r,o){let c;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new C(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){Ku(o,r);const e=[];for(const n of o)e.push(Bu(s,t,n));c={arrayValue:{values:e}}}else c=Bu(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||Ku(o,r),c=au(n,"where",o,"in"===r||"not-in"===r);const u=Gt.create(i,r,c);return function(t,e){if(e.S()){const n=he(t);if(null!==n&&!n.isEqual(e.field))throw new C(N.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=ue(t);null!==s&&Gu(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new C(N.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new C(N.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t._query,0,e,t.firestore._databaseId,this.Uu,this.qu,this.Ku);return new yc(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new re(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function Cu(t,e,n){const s=e,i=wu("where",t);return new Nu(i,s,n)}class Du extends xu{constructor(t,e){super(),this.Uu=t,this.Gu=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new C(N.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new C(N.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new te(e,n);return function(t,e){if(null===ue(t)){const n=he(t);null!==n&&Gu(t,n,e.field)}}(t,s),s}(t._query,this.Uu,this.Gu);return new yc(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new re(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function ku(t,e="asc"){const n=e,s=wu("orderBy",t);return new Du(s,n)}class Ou extends xu{constructor(t,e,n){super(),this.type=t,this.ju=e,this.Qu=n}_apply(t){return new yc(t.firestore,t.converter,ge(t._query,this.ju,this.Qu))}}function Ru(t){return dc("limit",t),new Ou("limit",t,"F")}function Lu(t){return dc("limitToLast",t),new Ou("limitToLast",t,"L")}class Pu extends xu{constructor(t,e,n){super(),this.type=t,this.Wu=e,this.zu=n}_apply(t){const e=ju(t,this.type,this.Wu,this.zu);return new yc(t.firestore,t.converter,function(t,e){return new re(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function Mu(...t){return new Pu("startAt",t,!0)}function Fu(...t){return new Pu("startAfter",t,!1)}class Vu extends xu{constructor(t,e,n){super(),this.type=t,this.Wu=e,this.zu=n}_apply(t){const e=ju(t,this.type,this.Wu,this.zu);return new yc(t.firestore,t.converter,function(t,e){return new re(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function qu(...t){return new Vu("endBefore",t,!1)}function Uu(...t){return new Vu("endAt",t,!0)}function ju(t,e,n,s){if(n[0]=Object(h.m)(n[0]),n[0]instanceof pu)return function(t,e,n,s,i){if(!s)throw new C(N.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const r=[];for(const n of de(t))if(n.field.isKeyField())r.push(_t(e,s.key));else{const t=s.data.field(n.field);if(at(t))throw new C(N.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new C(N.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new Zt(r,i)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const i=Xc(t.firestore);return function(t,e,n,s,i,r){const o=t.explicitOrderBy;if(i.length>o.length)throw new C(N.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const c=[];for(let r=0;r<i.length;r++){const u=i[r];if(o[r].field.isKeyField()){if("string"!=typeof u)throw new C(N.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof u}`);if(!le(t)&&-1!==u.indexOf("/"))throw new C(N.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(Y.fromString(u));if(!pt.isDocumentKey(n))throw new C(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new pt(n);c.push(_t(e,i))}else{const t=au(n,s,u);c.push(t)}}return new Zt(c,r)}(t._query,t.firestore._databaseId,i,e,n,s)}}function Bu(t,e,n){if("string"==typeof(n=Object(h.m)(n))){if(""===n)throw new C(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!le(e)&&-1!==n.indexOf("/"))throw new C(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Y.fromString(n));if(!pt.isDocumentKey(s))throw new C(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return _t(t,new pt(s))}if(n instanceof pc)return _t(t,n._key);throw new C(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hc(n)}.`)}function Ku(t,e){if(!Array.isArray(t)||0===t.length)throw new C(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new C(N.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Gu(t,e,n){if(!n.isEqual(e))throw new C(N.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class $u{convertValue(t,e="none"){switch(wt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return it(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ot(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw _()}}convertObject(t,e){const n={};return H(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new Gc(it(t.latitude),it(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ct(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ut(t));default:return null}}convertTimestamp(t){const e=st(t);return new $(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Y.fromString(t);x(is(n));const s=new lt(n.get(1),n.get(3)),i=new pt(n.popFirst(5));return s.isEqual(e)||T(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function Qu(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class zu extends $u{constructor(t){super(),this.firestore=t}convertBytes(t){return new Bc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new pc(this.firestore,null,e)}}class Hu{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Xc(t)}set(t,e,n){this._verifyNotCommitted();const s=Wu(t,this._firestore),i=Qu(s.converter,e,n),r=Jc(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,n);return this._mutations.push(r.toMutation(s._key,Ve.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=Wu(t,this._firestore);let r;return r="string"==typeof(e=Object(h.m)(e))||e instanceof jc?ou(this._dataReader,"WriteBatch.update",i._key,e,n,s):iu(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(r.toMutation(i._key,Ve.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Wu(t,this._firestore);return this._mutations=this._mutations.concat(new Xe(e._key,Ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(N.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Wu(t,e){if((t=Object(h.m)(t)).firestore!==e)throw new C(N.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Yu(t){t=lc(t,pc);const e=lc(t.firestore,Nc);return nc(Cc(e),t._key).then((n=>lh(e,t,n)))}class Xu extends $u{constructor(t){super(),this.firestore=t}convertBytes(t){return new Bc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new pc(this.firestore,null,e)}}function Ju(t){t=lc(t,pc);const e=lc(t.firestore,Nc),n=Cc(e),s=new Xu(e);return function(t,e){const n=new D;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=A(t);return n.persistence.runTransaction("read document","readonly",(t=>n.Us.ys(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new C(N.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=jo(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await Ja(t),e,n))),n.promise}(n,t._key).then((n=>new bu(e,s,t._key,n,new vu(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Zu(t){t=lc(t,pc);const e=lc(t.firestore,Nc);return nc(Cc(e),t._key,{source:"server"}).then((n=>lh(e,t,n)))}function eh(t){t=lc(t,yc);const e=lc(t.firestore,Nc),n=Cc(e),s=new Xu(e);return _u(t._query),sc(n,t._query).then((n=>new Tu(e,s,t,n)))}function nh(t){t=lc(t,yc);const e=lc(t.firestore,Nc),n=Cc(e),s=new Xu(e);return function(t,e){const n=new D;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await _i(t,e,!0),i=new ia(e,s.Ks),r=i.Ic(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(t){const s=jo(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await Ja(t),e,n))),n.promise}(n,t._query).then((n=>new Tu(e,s,t,n)))}function sh(t){t=lc(t,yc);const e=lc(t.firestore,Nc),n=Cc(e),s=new Xu(e);return sc(n,t._query,{source:"server"}).then((n=>new Tu(e,s,t,n)))}function rh(t,e,n){t=lc(t,pc);const s=lc(t.firestore,Nc),i=Qu(t.converter,e,n);return hh(s,[Jc(Xc(s),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Ve.none())])}function ih(t,e,n,...s){t=lc(t,pc);const i=lc(t.firestore,Nc),r=Xc(i);let o;return o="string"==typeof(e=Object(h.m)(e))||e instanceof jc?ou(r,"updateDoc",t._key,e,n,s):iu(r,"updateDoc",t._key,e),hh(i,[o.toMutation(t._key,Ve.exists(!0))])}function oh(t){return hh(lc(t.firestore,Nc),[new Xe(t._key,Ve.none())])}function ah(t,e){const n=lc(t.firestore,Nc),s=Ic(t),i=Qu(t.converter,e);return hh(n,[Jc(Xc(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,Ve.exists(!1))]).then((()=>s))}function ch(t,...e){var n,s,i;t=Object(h.m)(t);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||_c(e[o])||(r=e[o],o++);const c={includeMetadataChanges:r.includeMetadataChanges};if(_c(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let u,a,l;if(t instanceof pc)a=lc(t.firestore,Nc),l=oe(t._key.path),u={next:n=>{e[o]&&e[o](lh(a,t,n))},error:e[o+1],complete:e[o+2]};else{const n=lc(t,yc);a=lc(n.firestore,Nc),l=n._query;const s=new Xu(a);u={next:t=>{e[o]&&e[o](new Tu(a,s,n,t))},error:e[o+1],complete:e[o+2]},_u(t._query)}return function(t,e,n,s){const i=new Ba(s),r=new Jo(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>zo(await ec(t),r))),()=>{i.Jc(),t.asyncQueue.enqueueAndForget((async()=>Ho(await ec(t),r)))}}(Cc(a),l,c,u)}function uh(t,e){return function(t,e){const n=new Ba(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){A(t).Zo.add(e),e.next()}(await ec(t),n))),()=>{n.Jc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){A(t).Zo.delete(e)}(await ec(t),n)))}}(Cc(t=lc(t,Nc)),_c(e)?e:{next:e})}function hh(t,e){return function(t,e){const n=new D;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=Ma(t);try{const t=await function(t,e){const n=A(t),s=$.now(),i=e.reduce(((t,e)=>t.add(e.key)),yn());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Us.Es(t,i).next((i=>{r=i;const o=[];for(const t of e){const e=Ke(t,r.get(t.key));null!=e&&o.push(new ze(t.key,e,Rt(e.value.mapValue),Ve.exists(!0)))}return n.gs.addMutationBatch(t,s,o,e)})))).then((t=>(t.applyToLocalDocumentSet(r),{batchId:t.batchId,changes:r})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.$c[t.currentUser.toKey()];s||(s=new rn(rt)),s=s.insert(e,n),t.$c[t.currentUser.toKey()]=s}(s,t.batchId,n),await Sa(s,t.changes),await Ao(s.remoteStore)}catch(t){const e=jo(t,"Failed to persist write");n.reject(e)}}(await tc(t),e,n))),n.promise}(Cc(t),e)}function lh(t,e,n){const s=n.docs.get(e._key),i=new Xu(t);return new bu(t,i,e._key,s,new vu(n.hasPendingWrites,n.fromCache),e.converter)}class dh extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Xc(t)}get(t){const e=Wu(t,this._firestore),n=new zu(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return _();const s=t[0];if(s.isFoundDocument())return new pu(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new pu(this._firestore,n,e._key,null,e.converter);throw _()}))}set(t,e,n){const s=Wu(t,this._firestore),i=Qu(s.converter,e,n),r=Jc(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,n);return this._transaction.set(s._key,r),this}update(t,e,n,...s){const i=Wu(t,this._firestore);let r;return r="string"==typeof(e=Object(h.m)(e))||e instanceof jc?ou(this._dataReader,"Transaction.update",i._key,e,n,s):iu(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,r),this}delete(t){const e=Wu(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=Wu(t,this._firestore),n=new Xu(this._firestore);return super.get(t).then((t=>new bu(this._firestore,n,e._key,t._document,new vu(!1,!1),e.converter)))}}function fh(t,e){return function(t,e){const n=new D;return t.asyncQueue.enqueueAndForget((async()=>{const s=await function(t){return Ya(t).then((t=>t.datastore))}(t);new $a(t.asyncQueue,s,e,n).run()})),n.promise}(Cc(t=lc(t,Nc)),(n=>e(new dh(t,n))))}function gh(){return new Zc("deleteField")}function mh(){return new eu("serverTimestamp")}function ph(...t){return new nu("arrayUnion",t)}function yh(...t){return new su("arrayRemove",t)}function wh(t){return new ru("increment",t)}!function(t,e=!0){!function(t){m=t}(r.SDK_VERSION),Object(r._registerComponent)(new o.a("firestore",((t,{options:n})=>{const s=t.getProvider("app").getImmediate(),i=new Nc(s,new L(t.getProvider("auth-internal")),new V(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),i._setSettings(n),i}),"PUBLIC")),Object(r.registerVersion)(d,"3.4.5",t),Object(r.registerVersion)(d,"3.4.5","esm2017")}()}).call(this,n(126))},956:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return fs})),n.d(e,"b",(function(){return ms})),n.d(e,"c",(function(){return gs})),n.d(e,"d",(function(){return ys})),n.d(e,"e",(function(){return ps})),n.d(e,"f",(function(){return ws})),n.d(e,"g",(function(){return vs})),n.d(e,"h",(function(){return ls})),n.d(e,"i",(function(){return ds}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},c={},h=h||{},l=o||self;function d(){}function f(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function w(a,b,t){return a.call.apply(a.bind,arguments)}function v(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function q(a,b,t){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:v).apply(null,arguments)}function I(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}function T(a,b){function t(){}t.prototype=b.prototype,a.Z=b.prototype,a.prototype=new t,a.prototype.constructor=a,a.Vb=function(t,e,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[e].apply(t,r)}}function E(){this.s=this.s,this.o=this.o}var S={};E.prototype.s=!1,E.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var a=function(a){return Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++y)}(this);delete S[a]}},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const _=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1},x=Array.prototype.forEach?function(a,b,t){Array.prototype.forEach.call(a,b,t)}:function(a,b,t){const e=a.length,n="string"==typeof a?a.split(""):a;for(let r=0;r<e;r++)r in n&&b.call(t,n[r],r,a)};function A(a){return Array.prototype.concat.apply([],arguments)}function N(a){const b=a.length;if(0<b){const t=Array(b);for(let e=0;e<b;e++)t[e]=a[e];return t}return[]}function C(a){return/^[\s\xa0]*$/.test(a)}var D,k=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function O(a,b){return-1!=a.indexOf(b)}function R(a,b){return a<b?-1:a>b?1:0}t:{var L=l.navigator;if(L){var P=L.userAgent;if(P){D=P;break t}}D=""}function M(a,b,t){for(const e in a)b.call(t,a[e],e,a)}function F(a){const b={};for(const t in a)b[t]=a[t];return b}var V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(a,b){let t,e;for(let n=1;n<arguments.length;n++){for(t in e=arguments[n],e)a[t]=e[t];for(let n=0;n<V.length;n++)t=V[n],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function j(a){return j[" "](a),a}j[" "]=d;var B,a,K=O(D,"Opera"),G=O(D,"Trident")||O(D,"MSIE"),$=O(D,"Edge"),Q=$||G,z=O(D,"Gecko")&&!(O(D.toLowerCase(),"webkit")&&!O(D,"Edge"))&&!(O(D,"Trident")||O(D,"MSIE"))&&!O(D,"Edge"),H=O(D.toLowerCase(),"webkit")&&!O(D,"Edge");function W(){var a=l.document;return a?a.documentMode:void 0}t:{var Y="",X=(a=D,z?/rv:([^\);]+)(\)|;)/.exec(a):$?/Edge\/([\d\.]+)/.exec(a):G?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):H?/WebKit\/(\S+)/.exec(a):K?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(X&&(Y=X?X[1]:""),G){var J=W();if(null!=J&&J>parseFloat(Y)){B=String(J);break t}}B=Y}var Z,tt={};function et(){return function(a){var b=tt;return Object.prototype.hasOwnProperty.call(b,9)?b[9]:b[9]=a(9)}((function(){let a=0;const b=k(String(B)).split("."),t=k("9").split("."),e=Math.max(b.length,t.length);for(let o=0;0==a&&o<e;o++){var n=b[o]||"",r=t[o]||"";do{if(n=/(\d*)(\D*)(.*)/.exec(n)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==n[0].length&&0==r[0].length)break;a=R(0==n[1].length?0:parseInt(n[1],10),0==r[1].length?0:parseInt(r[1],10))||R(0==n[2].length,0==r[2].length)||R(n[2],r[2]),n=n[3],r=r[3]}while(0==a)}return 0<=a}))}if(l.document&&G){var nt=W();Z=nt||(parseInt(B,10)||void 0)}else Z=void 0;var st=Z,it=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",d,b),l.removeEventListener("test",d,b)}catch(t){}return a}();function ot(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}function at(a,b){if(ot.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(z){t:{try{j(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:ct[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&at.Z.h.call(this)}}ot.prototype.h=function(){this.defaultPrevented=!0},T(at,ot);var ct={2:"touch",3:"pen",4:"mouse"};at.prototype.h=function(){at.Z.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ut="closure_listenable_"+(1e6*Math.random()|0),ht=0;function lt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ia=n,this.key=++ht,this.ca=this.fa=!1}function ft(a){a.ca=!0,a.listener=null,a.proxy=null,a.src=null,a.ia=null}function gt(a){this.src=a,this.g={},this.h=0}function mt(a,b){var t=b.type;if(t in a.g){var e,n=a.g[t],r=_(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(ft(b),0==a.g[t].length&&(delete a.g[t],a.h--))}}function pt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.ca&&r.listener==b&&r.capture==!!t&&r.ia==e)return n}return-1}gt.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=pt(a,b,e,n);return-1<o?(b=a[o],t||(b.fa=!1)):((b=new lt(b,this.src,r,!!e,n)).fa=t,a.push(b)),b};var yt="closure_lm_"+(1e6*Math.random()|0),wt={};function vt(a,b,t,e,n){if(e&&e.once)return It(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)vt(a,b[r],t,e,n);return null}return t=Nt(t),a&&a[ut]?a.N(b,t,p(e)?!!e.capture:!!e,n):bt(a,b,t,!1,e,n)}function bt(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=xt(a);if(c||(a[yt]=c=new gt(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){function a(t){return b.call(a.src,a.listener,t)}var b=_t;return a}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)it||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(St(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function It(a,b,t,e,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)It(a,b[r],t,e,n);return null}return t=Nt(t),a&&a[ut]?a.O(b,t,p(e)?!!e.capture:!!e,n):bt(a,b,t,!0,e,n)}function Tt(a,b,t,e,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)Tt(a,b[r],t,e,n);else e=p(e)?!!e.capture:!!e,t=Nt(t),a&&a[ut]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(t=pt(r=a.g[b],t,e,n))&&(ft(r[t]),Array.prototype.splice.call(r,t,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=xt(a))&&(b=a.g[b.toString()],a=-1,b&&(a=pt(b,t,e,n)),(t=-1<a?b[a]:null)&&Et(t))}function Et(a){if("number"!=typeof a&&a&&!a.ca){var b=a.src;if(b&&b[ut])mt(b.i,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(St(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=xt(b))?(mt(t,a),0==t.h&&(t.src=null,b[yt]=null)):ft(a)}}}function St(a){return a in wt?wt[a]:wt[a]="on"+a}function _t(a,b){if(a.ca)a=!0;else{b=new at(b,this);var t=a.listener,e=a.ia||a.src;a.fa&&Et(a),a=t.call(e,b)}return a}function xt(a){return(a=a[yt])instanceof gt?a:null}var At="__closure_events_fn_"+(1e9*Math.random()>>>0);function Nt(a){return"function"==typeof a?a:(a[At]||(a[At]=function(b){return a.handleEvent(b)}),a[At])}function Ct(){E.call(this),this.i=new gt(this),this.P=this,this.I=null}function Dt(a,b){var t,e=a.I;if(e)for(t=[];e;e=e.I)t.push(e);if(a=a.P,e=b.type||b,"string"==typeof b)b=new ot(b,a);else if(b instanceof ot)b.target=b.target||a;else{var n=b;U(b=new ot(e,a),n)}if(n=!0,t)for(var r=t.length-1;0<=r;r--){var o=b.g=t[r];n=kt(o,e,!0,b)&&n}if(n=kt(o=b.g=a,e,!0,b)&&n,n=kt(o,e,!1,b)&&n,t)for(r=0;r<t.length;r++)n=kt(o=b.g=t[r],e,!1,b)&&n}function kt(a,b,t,e){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.ca&&o.capture==t){var c=o.listener,u=o.ia||o.src;o.fa&&mt(a.i,o),n=!1!==c.call(u,e)&&n}}return n&&!e.defaultPrevented}T(Ct,E),Ct.prototype[ut]=!0,Ct.prototype.removeEventListener=function(a,b,t,e){Tt(this,a,b,t,e)},Ct.prototype.M=function(){if(Ct.Z.M.call(this),this.i){var t,a=this.i;for(t in a.g){for(var e=a.g[t],n=0;n<e.length;n++)ft(e[n]);delete a.g[t],a.h--}}this.I=null},Ct.prototype.N=function(a,b,t,e){return this.i.add(String(a),b,!1,t,e)},Ct.prototype.O=function(a,b,t,e){return this.i.add(String(a),b,!0,t,e)};var Ot=l.JSON.stringify;function Rt(){var a=Ut;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Lt,Pt=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new Mt),(a=>a.reset()));class Mt{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Ft(a){l.setTimeout((()=>{throw a}),0)}function Vt(a,b){Lt||function(){var a=l.Promise.resolve(void 0);Lt=function(){a.then(jt)}}(),qt||(Lt(),qt=!0),Ut.add(a,b)}var qt=!1,Ut=new class{constructor(){this.h=this.g=null}add(a,b){const t=Pt.get();t.set(a,b),this.h?this.h.next=t:this.g=t,this.h=t}};function jt(){for(var a;a=Rt();){try{a.h.call(a.g)}catch(t){Ft(t)}var b=Pt;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}qt=!1}function Bt(a,b){Ct.call(this),this.h=a||1,this.g=b||l,this.j=q(this.kb,this),this.l=Date.now()}function Kt(a){a.da=!1,a.S&&(a.g.clearTimeout(a.S),a.S=null)}function Gt(a,b,t){if("function"==typeof a)t&&(a=q(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function $t(a){a.g=Gt((()=>{a.g=null,a.i&&(a.i=!1,$t(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}T(Bt,Ct),(r=Bt.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-a):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Dt(this,"tick"),this.da&&(Kt(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Bt.Z.M.call(this),Kt(this),delete this.g};class Qt extends E{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:$t(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zt(a){E.call(this),this.h=a,this.g={}}T(zt,E);var Ht=[];function Wt(a,b,t,e){Array.isArray(t)||(t&&(Ht[0]=t.toString()),t=Ht);for(var n=0;n<t.length;n++){var r=vt(b,t[n],e||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Yt(a){M(a.g,(function(b,t){this.g.hasOwnProperty(t)&&Et(b)}),a),a.g={}}function Xt(){this.g=!0}function Jt(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Ot(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}zt.prototype.M=function(){zt.Z.M.call(this),Yt(this)},zt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Xt.prototype.Aa=function(){this.g=!1},Xt.prototype.info=function(){};var Zt={},te=null;function ee(){return te=te||new Ct}function ne(a){ot.call(this,Zt.Ma,a)}function se(a){const b=ee();Dt(b,new ne(b,a))}function re(a,b){ot.call(this,Zt.STAT_EVENT,a),this.stat=b}function ie(a){const b=ee();Dt(b,new re(b,a))}function oe(a,b){ot.call(this,Zt.Na,a),this.size=b}function ae(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}Zt.Ma="serverreachability",T(ne,ot),Zt.STAT_EVENT="statevent",T(re,ot),Zt.Na="timingevent",T(oe,ot);var ce={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ue={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function he(){}function le(a){return a.h||(a.h=a.i())}function de(){}he.prototype.h=null;var fe,ge={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function me(){ot.call(this,"d")}function pe(){ot.call(this,"c")}function ye(){}function we(a,b,t,e){this.l=a,this.j=b,this.m=t,this.X=e||1,this.V=new zt(this),this.P=be,a=Q?125:void 0,this.W=new Bt(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ve}function ve(){this.i=null,this.g="",this.h=!1}T(me,ot),T(pe,ot),T(ye,he),ye.prototype.g=function(){return new XMLHttpRequest},ye.prototype.i=function(){return{}},fe=new ye;var be=45e3,Ie={},Te={};function Ee(a,b,t){a.K=1,a.v=Qe(Ue(b)),a.s=t,a.U=!0,Se(a,null)}function Se(a,b){a.F=Date.now(),Ne(a),a.A=Ue(a.v);var t=a.A,e=a.X;Array.isArray(e)||(e=[String(e)]),rn(t.h,"t",e),a.C=0,t=a.l.H,a.h=new ve,a.g=rs(a.l,t?b:null,!a.s),0<a.O&&(a.L=new Qt(q(a.Ia,a,a.g),a.O)),Wt(a.V,a.g,"readystatechange",a.gb),b=a.H?F(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.s,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b)),se(1),function(a,b,t,e,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),u=0;u<c.length;u++){var h=c[u].split("=");if(1<h.length){var l=h[0];h=h[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.j,a.u,a.A,a.m,a.X,a.s)}function _e(a){return!!a.g&&("GET"==a.u&&2!=a.K&&a.l.Ba)}function xe(a,b,t){let e,n=!0;for(;!a.I&&a.C<t.length;){if(e=Ae(a,t),e==Te){4==b&&(a.o=4,ie(14),n=!1),Jt(a.j,a.m,null,"[Incomplete Response]");break}if(e==Ie){a.o=4,ie(15),Jt(a.j,a.m,t,"[Invalid Chunk]"),n=!1;break}Jt(a.j,a.m,e,null),Re(a,e)}_e(a)&&e!=Te&&e!=Ie&&(a.h.g="",a.C=0),4!=b||0!=t.length||a.h.h||(a.o=1,ie(16),n=!1),a.i=a.i&&n,n?0<t.length&&!a.aa&&(a.aa=!0,(b=a.l).g==a&&b.$&&!b.L&&(b.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Yn(b),b.L=!0,ie(11))):(Jt(a.j,a.m,t,"[Invalid Chunked Response]"),Oe(a),ke(a))}function Ae(a,b){var t=a.C,e=b.indexOf("\n",t);return-1==e?Te:(t=Number(b.substring(t,e)),isNaN(t)?Ie:(e+=1)+t>b.length?Te:(b=b.substr(e,t),a.C=e+t,b))}function Ne(a){a.Y=Date.now()+a.P,Ce(a,a.P)}function Ce(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=ae(q(a.eb,a),b)}function De(a){a.B&&(l.clearTimeout(a.B),a.B=null)}function ke(a){0==a.l.G||a.I||Zn(a.l,a)}function Oe(a){De(a);var b=a.L;b&&"function"==typeof b.na&&b.na(),a.L=null,Kt(a.W),Yt(a.V),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function Re(a,b){try{var t=a.l;if(0!=t.G&&(t.g==a||ln(t.i,a)))if(t.I=a.N,!a.J&&ln(t.i,a)&&3==t.G){try{var e=t.Ca.g.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.u){if(t.g){if(!(t.g.F+3e3<a.F))break t;Jn(t),jn(t)}Wn(t),ie(18)}}else t.ta=n[1],0<t.ta-t.U&&37500>n[2]&&t.N&&0==t.A&&!t.v&&(t.v=ae(q(t.ab,t),6e3));if(1>=hn(t.i)&&t.ka){try{t.ka()}catch(t){}t.ka=void 0}}else es(t,11)}else if((a.J||t.g==a)&&Jn(t),!C(b))for(n=t.Ca.g.parse(b),b=0;b<n.length;b++){let h=n[b];if(t.U=h[0],h=h[1],2==t.G)if("c"==h[0]){t.J=h[1],t.la=h[2];const n=h[3];null!=n&&(t.ma=n,t.h.info("VER="+t.ma));const l=h[4];null!=l&&(t.za=l,t.h.info("SVER="+t.za));const d=h[5];null!=d&&"number"==typeof d&&0<d&&(e=1.5*d,t.K=e,t.h.info("backChannelRequestTimeoutMs_="+e)),e=t;const f=a.g;if(f){const t=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=e.i;!r.g&&(O(t,"spdy")||O(t,"quic")||O(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(dn(r,r.h),r.h=null))}if(e.D){const t=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(e.sa=t,$e(e.F,e.D,t))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-a.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=a;if((e=t).oa=ss(e,e.H?e.la:null,e.W),o.J){fn(e.i,o);var c=o,u=e.K;u&&c.setTimeout(u),c.B&&(De(c),Ne(c)),e.g=o}else Hn(e);0<t.l.length&&Gn(t)}else"stop"!=h[0]&&"close"!=h[0]||es(t,7);else 3==t.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?es(t,7):Un(t):"noop"!=h[0]&&t.j&&t.j.wa(h),t.A=0)}se(4)}catch(t){}}function Le(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(f(a)||"string"==typeof a)x(a,b,void 0);else{if(a.T&&"function"==typeof a.T)var t=a.T();else if(a.R&&"function"==typeof a.R)t=void 0;else if(f(a)||"string"==typeof a){t=[];for(var e=a.length,n=0;n<e;n++)t.push(n)}else for(n in t=[],e=0,a)t[e++]=n;e=function(a){if(a.R&&"function"==typeof a.R)return a.R();if("string"==typeof a)return a.split("");if(f(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a),n=e.length;for(var r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}}function Pe(a,b){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var e=0;e<t;e+=2)this.set(arguments[e],arguments[e+1])}else if(a)if(a instanceof Pe)for(t=a.T(),e=0;e<t.length;e++)this.set(t[e],a.get(t[e]));else for(e in a)this.set(e,a[e])}function Me(a){if(a.i!=a.g.length){for(var b=0,t=0;b<a.g.length;){var e=a.g[b];Fe(a.h,e)&&(a.g[t++]=e),b++}a.g.length=t}if(a.i!=a.g.length){var n={};for(t=b=0;b<a.g.length;)Fe(n,e=a.g[b])||(a.g[t++]=e,n[e]=1),b++;a.g.length=t}}function Fe(a,b){return Object.prototype.hasOwnProperty.call(a,b)}(r=we.prototype).setTimeout=function(a){this.P=a},r.gb=function(a){a=a.target;const b=this.L;b&&3==Pn(a)?b.l():this.Ia(a)},r.Ia=function(a){try{if(a==this.g)t:{const d=Pn(this.g);var b=this.g.Da();const f=this.g.ba();if(!(3>d)&&(3!=d||Q||this.g&&(this.h.h||this.g.ga()||Mn(this.g)))){this.I||4!=d||7==b||se(8==b||0>=f?3:2),De(this);var t=this.g.ba();this.N=t;e:if(_e(this)){var e=Mn(this.g);a="";var n=e.length,r=4==Pn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Oe(this),ke(this);var o="";break e}this.h.i=new l.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(e[b],{stream:r&&b==n-1});e.splice(0,n),this.h.g+=a,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,d,t),this.i){if(this.$&&!this.J){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(c)){var h=c;break e}}h=null}if(!(t=h)){this.i=!1,this.o=3,ie(12),Oe(this),ke(this);break t}Jt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Re(this,t)}this.U?(xe(this,d,o),Q&&this.i&&3==d&&(Wt(this.V,this.W,"tick",this.fb),this.W.start())):(Jt(this.j,this.m,o,null),Re(this,o)),4==d&&Oe(this),this.i&&!this.I&&(4==d?Zn(this.l,this):(this.i=!1,Ne(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ie(12)):(this.o=0,ie(13)),Oe(this),ke(this)}}}catch(t){}},r.fb=function(){if(this.g){var a=Pn(this.g),b=this.g.ga();this.C<b.length&&(De(this),xe(this,a,b),this.i&&4!=a&&Ne(this))}},r.cancel=function(){this.I=!0,Oe(this)},r.eb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.A),2!=this.K&&(se(3),ie(17)),Oe(this),this.o=2,ke(this)):Ce(this,this.Y-a)},(r=Pe.prototype).R=function(){Me(this);for(var a=[],b=0;b<this.g.length;b++)a.push(this.h[this.g[b]]);return a},r.T=function(){return Me(this),this.g.concat()},r.get=function(a,b){return Fe(this.h,a)?this.h[a]:b},r.set=function(a,b){Fe(this.h,a)||(this.i++,this.g.push(a)),this.h[a]=b},r.forEach=function(a,b){for(var t=this.T(),e=0;e<t.length;e++){var n=t[e],r=this.get(n);a.call(b,r,n,this)}};var Ve=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function qe(a,b){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,a instanceof qe){this.g=void 0!==b?b:a.g,je(this,a.j),this.s=a.s,Be(this,a.i),Ke(this,a.m),this.l=a.l,b=a.h;var t=new en;t.i=b.i,b.g&&(t.g=new Pe(b.g),t.h=b.h),Ge(this,t),this.o=a.o}else a&&(t=String(a).match(Ve))?(this.g=!!b,je(this,t[1]||"",!0),this.s=ze(t[2]||""),Be(this,t[3]||"",!0),Ke(this,t[4]),this.l=ze(t[5]||"",!0),Ge(this,t[6]||"",!0),this.o=ze(t[7]||"")):(this.g=!!b,this.h=new en(null,this.g))}function Ue(a){return new qe(a)}function je(a,b,t){a.j=t?ze(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Be(a,b,t){a.i=t?ze(b,!0):b}function Ke(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Ge(a,b,t){b instanceof en?(a.h=b,function(a,b){b&&!a.j&&(nn(a),a.i=null,a.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(dd(this,e),rn(this,n,t))}),a)),a.j=b}(a.h,a.g)):(t||(b=He(b,Ze)),a.h=new en(b,a.g))}function $e(a,b,t){a.h.set(b,t)}function Qe(a){return $e(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ze(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function He(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,We),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function We(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}qe.prototype.toString=function(){var a=[],b=this.j;b&&a.push(He(b,Ye,!0),":");var t=this.i;return(t||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(He(b,Ye,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&a.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&a.push("/"),a.push(He(t,"/"==t.charAt(0)?Je:Xe,!0))),(t=this.h.toString())&&a.push("?",t),(t=this.o)&&a.push("#",He(t,tn)),a.join("")};var Ye=/[#\/\?@]/g,Xe=/[#\?:]/g,Je=/[#\?]/g,Ze=/[#\?@]/g,tn=/#/g;function en(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function nn(a){a.g||(a.g=new Pe,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function dd(a,b){nn(a),b=on(a,b),Fe(a.g.h,b)&&(a.i=null,a.h-=a.g.get(b).length,Fe((a=a.g).h,b)&&(delete a.h[b],a.i--,a.g.length>2*a.i&&Me(a)))}function sn(a,b){return nn(a),b=on(a,b),Fe(a.g.h,b)}function rn(a,b,t){dd(a,b),0<t.length&&(a.i=null,a.g.set(on(a,b),N(t)),a.h+=t.length)}function on(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=en.prototype).add=function(a,b){nn(this),this.i=null,a=on(this,a);var t=this.g.get(a);return t||this.g.set(a,t=[]),t.push(b),this.h+=1,this},r.forEach=function(a,b){nn(this),this.g.forEach((function(t,e){x(t,(function(t){a.call(b,t,e,this)}),this)}),this)},r.T=function(){nn(this);for(var a=this.g.R(),b=this.g.T(),t=[],e=0;e<b.length;e++)for(var n=a[e],r=0;r<n.length;r++)t.push(b[e]);return t},r.R=function(a){nn(this);var b=[];if("string"==typeof a)sn(this,a)&&(b=A(b,this.g.get(on(this,a))));else{a=this.g.R();for(var t=0;t<a.length;t++)b=A(b,a[t])}return b},r.set=function(a,b){return nn(this),this.i=null,sn(this,a=on(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.R(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var a=[],b=this.g.T(),t=0;t<b.length;t++){var e=b[t],n=encodeURIComponent(String(e));e=this.R(e);for(var r=0;r<e.length;r++){var o=n;""!==e[r]&&(o+="="+encodeURIComponent(String(e[r]))),a.push(o)}}return this.i=a.join("&")};function an(a){this.l=a||cn,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var cn=10;function un(a){return!!a.h||!!a.g&&a.g.size>=a.j}function hn(a){return a.h?1:a.g?a.g.size:0}function ln(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function dn(a,b){a.g?a.g.add(b):a.h=b}function fn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function gn(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const t of a.g.values())b=b.concat(t.D);return b}return N(a.i)}function mn(){}function pn(){this.g=new mn}function yn(a,b,t){const e=t||"";try{Le(a,(function(t,n){let r=t;p(t)&&(r=Ot(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function wn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}function vn(a){this.l=a.$b||null,this.j=a.ib||!1}function bn(a,b){Ct.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=In,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}an.prototype.cancel=function(){if(this.i=gn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}},mn.prototype.stringify=function(a){return l.JSON.stringify(a,void 0)},mn.prototype.parse=function(a){return l.JSON.parse(a,void 0)},T(vn,he),vn.prototype.g=function(){return new bn(this.l,this.j)},vn.prototype.i=function(a){return function(){return a}}({}),T(bn,Ct);var In=0;function Tn(a){a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a))}function td(a){a.readyState=4,a.l=null,a.j=null,a.A=null,En(a)}function En(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=bn.prototype).open=function(a,b){if(this.readyState!=In)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,En(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||l).fetch(new Request(this.B,b)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,td(this)),this.readyState=In},r.Va=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Tn(this)}else a.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?td(this):En(this),3==this.readyState&&Tn(this)}},r.Ua=function(a){this.g&&(this.response=this.responseText=a,td(this))},r.Ta=function(a){this.g&&(this.response=a,td(this))},r.ha=function(){this.g&&td(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var t=b.next();!t.done;)t=t.value,a.push(t[0]+": "+t[1]),t=b.next();return a.join("\r\n")},Object.defineProperty(bn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var Sn=l.JSON.parse;function _n(a){Ct.call(this),this.headers=new Pe,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=xn,this.K=this.L=!1}T(_n,Ct);var xn="",An=/^https?$/i,Nn=["POST","PUT"];function Cn(a){return"content-type"==a.toLowerCase()}function Dn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,kn(a),Rn(a)}function kn(a){a.D||(a.D=!0,Dt(a,"complete"),Dt(a,"error"))}function On(a){if(a.h&&void 0!==h&&(!a.C[1]||4!=Pn(a)||2!=a.ba()))if(a.v&&4==Pn(a))Gt(a.Fa,0,a);else if(Dt(a,"readystatechange"),4==Pn(a)){a.h=!1;try{const c=a.ba();t:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break t;default:b=!1}var t;if(!(t=b)){var e;if(e=0===c){var n=String(a.H).match(Ve)[1]||null;if(!n&&l.self&&l.self.location){var r=l.self.location.protocol;n=r.substr(0,r.length-1)}e=!An.test(n?n.toLowerCase():"")}t=e}if(t)Dt(a,"complete"),Dt(a,"success");else{a.m=6;try{var o=2<Pn(a)?a.g.statusText:""}catch(t){o=""}a.j=o+" ["+a.ba()+"]",kn(a)}}finally{Rn(a)}}}function Rn(a,b){if(a.g){Ln(a);const t=a.g,e=a.C[0]?d:null;a.g=null,a.C=null,b||Dt(a,"ready");try{t.onreadystatechange=e}catch(t){}}}function Ln(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(l.clearTimeout(a.A),a.A=null)}function Pn(a){return a.g?a.g.readyState:0}function Mn(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case xn:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Fn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=function(a){let b="";return M(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):$e(a,b,t))}function Vn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function qn(a){this.za=0,this.l=[],this.h=new Xt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Vn("failFast",!1,a),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Vn("baseRetryDelayMs",5e3,a),this.$a=Vn("retryDelaySeedMs",1e4,a),this.Ya=Vn("forwardChannelMaxRetries",2,a),this.ra=Vn("forwardChannelRequestTimeoutMs",2e4,a),this.qa=a&&a.xmlHttpFactory||void 0,this.Ba=a&&a.Yb||!1,this.K=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.J="",this.i=new an(a&&a.concurrentRequestLimit),this.Ca=new pn,this.ja=a&&a.fastHandshake||!1,this.Ra=a&&a.Wb||!1,a&&a.Aa&&this.h.Aa(),a&&a.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&a&&a.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!a||!1!==a.Xb}function Un(a){if(Bn(a),3==a.G){var b=a.V++,t=Ue(a.F);$e(t,"SID",a.J),$e(t,"RID",b),$e(t,"TYPE","terminate"),Qn(a,t),(b=new we(a,a.h,b,void 0)).K=2,b.v=Qe(Ue(t)),t=!1,l.navigator&&l.navigator.sendBeacon&&(t=l.navigator.sendBeacon(b.v.toString(),"")),!t&&l.Image&&((new Image).src=b.v,t=!0),t||(b.g=rs(b.l,null),b.g.ea(b.v)),b.F=Date.now(),Ne(b)}ns(a)}function jn(a){a.g&&(Yn(a),a.g.cancel(),a.g=null)}function Bn(a){jn(a),a.u&&(l.clearTimeout(a.u),a.u=null),Jn(a),a.i.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Kn(a,b){a.l.push(new class{constructor(a,b){this.h=a,this.g=b}}(a.Za++,b)),3==a.G&&Gn(a)}function Gn(a){un(a.i)||a.m||(a.m=!0,Vt(a.Ha,a),a.C=0)}function $n(a,b){var t;t=b?b.m:a.V++;const e=Ue(a.F);$e(e,"SID",a.J),$e(e,"RID",t),$e(e,"AID",a.U),Qn(a,e),a.o&&a.s&&Fn(e,a.o,a.s),t=new we(a,a.h,t,a.C+1),null===a.o&&(t.H=a.s),b&&(a.l=b.D.concat(a.l)),b=zn(a,t,1e3),t.setTimeout(Math.round(.5*a.ra)+Math.round(.5*a.ra*Math.random())),dn(a.i,t),Ee(t,e,b)}function Qn(a,b){a.j&&Le({},(function(t,e){$e(b,e,t)}))}function zn(a,b,t){t=Math.min(a.l.length,t);var e=a.j?q(a.j.Oa,a.j,a):null;t:{var n=a.l;let r=-1;for(;;){const o=["count="+t];-1==r?0<t?(r=n[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let u=0;u<t;u++){let t=n[u].h;const h=n[u].g;if(t-=r,0>t)r=Math.max(0,n[u].h-100),c=!1;else try{yn(h,o,"req"+t+"_")}catch(t){e&&e(h)}}if(c){e=o.join("&");break t}}}return a=a.l.splice(0,t),b.D=a,e}function Hn(a){a.g||a.u||(a.Y=1,Vt(a.Ga,a),a.A=0)}function Wn(a){return!(a.g||a.u||3<=a.A)&&(a.Y++,a.u=ae(q(a.Ga,a),ts(a,a.A)),a.A++,!0)}function Yn(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function Xn(a){a.g=new we(a,a.h,"rpc",a.Y),null===a.o&&(a.g.H=a.s),a.g.O=0;var b=Ue(a.oa);$e(b,"RID","rpc"),$e(b,"SID",a.J),$e(b,"CI",a.N?"0":"1"),$e(b,"AID",a.U),Qn(a,b),$e(b,"TYPE","xmlhttp"),a.o&&a.s&&Fn(b,a.o,a.s),a.K&&a.g.setTimeout(a.K);var t=a.g;a=a.la,t.K=1,t.v=Qe(Ue(b)),t.s=null,t.U=!0,Se(t,a)}function Jn(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function Zn(a,b){var t=null;if(a.g==b){Jn(a),Yn(a),a.g=null;var e=2}else{if(!ln(a.i,b))return;t=b.D,fn(a.i,b),e=1}if(a.I=b.N,0!=a.G)if(b.i)if(1==e){t=b.s?b.s.length:0,b=Date.now()-b.F;var n=a.C;Dt(e=ee(),new oe(e,t,b,n)),Gn(a)}else Hn(a);else if(3==(n=b.o)||0==n&&0<a.I||!(1==e&&function(a,b){return!(hn(a.i)>=a.i.j-(a.m?1:0)||(a.m?(a.l=b.D.concat(a.l),0):1==a.G||2==a.G||a.C>=(a.Xa?0:a.Ya)||(a.m=ae(q(a.Ha,a,b),ts(a,a.C)),a.C++,0)))}(a,b)||2==e&&Wn(a)))switch(t&&0<t.length&&(b=a.i,b.i=b.i.concat(t)),n){case 1:es(a,5);break;case 4:es(a,10);break;case 3:es(a,6);break;default:es(a,2)}}function ts(a,b){let t=a.Pa+Math.floor(Math.random()*a.$a);return a.j||(t*=2),t*b}function es(a,b){if(a.h.info("Error code "+b),2==b){var t=null;a.j&&(t=null);var e=q(a.jb,a);t||(t=new qe("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||je(t,"https"),Qe(t)),function(a,b){const t=new Xt;if(l.Image){const e=new Image;e.onload=I(wn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=I(wn,t,e,"TestLoadImage: error",!1,b),e.onabort=I(wn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=I(wn,t,e,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else ie(2);a.G=0,a.j&&a.j.va(b),ns(a),Bn(a)}function ns(a){a.G=0,a.I=-1,a.j&&(0==gn(a.i).length&&0==a.l.length||(a.i.i.length=0,N(a.l),a.l.length=0),a.j.ua())}function ss(a,b,t){let e=function(a){return a instanceof qe?Ue(a):new qe(a,void 0)}(t);if(""!=e.i)b&&Be(e,b+"."+e.i),Ke(e,e.m);else{const n=l.location;e=function(a,b,t,e){var n=new qe(null,void 0);return a&&je(n,a),b&&Be(n,b),t&&Ke(n,t),e&&(n.l=e),n}(n.protocol,b?b+"."+n.hostname:n.hostname,+n.port,t)}return a.aa&&M(a.aa,(function(t,n){$e(e,n,t)})),b=a.D,t=a.sa,b&&t&&$e(e,b,t),$e(e,"VER",a.ma),Qn(a,e),e}function rs(a,b,t){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return(b=t&&a.Ba&&!a.qa?new _n(new vn({ib:!0})):new _n(a.qa)).L=a.H,b}function is(){}function os(){if(G&&!(10<=Number(st)))throw Error("Environmental error: no available transport.")}function as(a,b){Ct.call(this),this.g=new qn(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.ya&&(a?a["X-WebChannel-Client-Profile"]=b.ya:a={"X-WebChannel-Client-Profile":b.ya}),this.g.P=a,(a=b&&b.httpHeadersOverwriteParam)&&!C(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!C(b)&&(this.g.D=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new hs(this)}function cs(a){me.call(this);var b=a.__sm__;if(b){t:{for(const t in b){a=t;break t}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function us(){pe.call(this),this.status=1}function hs(a){this.g=a}(r=_n.prototype).ea=function(a,b,t,e){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():fe.g(),this.C=this.u?le(this.u):le(fe),this.g.onreadystatechange=q(this.Fa,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(t){return void Dn(this,t)}a=t||"";const n=new Pe(this.headers);e&&Le(e,(function(t,e){n.set(e,t)})),e=function(a){t:{var b=Cn;const t=a.length,e="string"==typeof a?a.split(""):a;for(let n=0;n<t;n++)if(n in e&&b.call(void 0,e[n],n,a)){b=n;break t}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}(n.T()),t=l.FormData&&a instanceof l.FormData,!(0<=_(Nn,b))||e||t||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ln(this),0<this.B&&((this.K=function(a){return G&&et()&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.pa,this)):this.A=Gt(this.pa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(t){Dn(this,t)}},r.pa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Dt(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,Dt(this,"complete"),Dt(this,"abort"),Rn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Rn(this,!0)),_n.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?On(this):this.cb())},r.cb=function(){On(this)},r.ba=function(){try{return 2<Pn(this)?this.g.status:-1}catch(t){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Qa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),Sn(b)}},r.Da=function(){return this.m},r.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=qn.prototype).ma=8,r.G=1,r.hb=function(a){try{this.h.info("Origin Trials invoked: "+a)}catch(t){}},r.Ha=function(a){if(this.m)if(this.m=null,1==this.G){if(!a){this.V=Math.floor(1e5*Math.random()),a=this.V++;const n=new we(this,this.h,a,void 0);let r=this.s;if(this.P&&(r?(r=F(r),U(r,this.P)):r=this.P),null===this.o&&(n.H=r),this.ja)t:{for(var b=0,t=0;t<this.l.length;t++){var e=this.l[t];if(void 0===(e="__data__"in e.g&&"string"==typeof(e=e.g.__data__)?e.length:void 0))break;if(4096<(b+=e)){b=t;break t}if(4096===b||t===this.l.length-1){b=t+1;break t}}b=1e3}else b=1e3;b=zn(this,n,b),$e(t=Ue(this.F),"RID",a),$e(t,"CVER",22),this.D&&$e(t,"X-HTTP-Session-Id",this.D),Qn(this,t),this.o&&r&&Fn(t,this.o,r),dn(this.i,n),this.Ra&&$e(t,"TYPE","init"),this.ja?($e(t,"$req",b),$e(t,"SID","null"),n.$=!0,Ee(n,t,null)):Ee(n,t,b),this.G=2}}else 3==this.G&&(a?$n(this,a):0==this.l.length||un(this.i)||$n(this))},r.Ga=function(){if(this.u=null,Xn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var a=2*this.O;this.h.info("BP detection timer enabled: "+a),this.B=ae(q(this.bb,this),a)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ie(10),jn(this),Xn(this))},r.ab=function(){null!=this.v&&(this.v=null,jn(this),Wn(this),ie(19))},r.jb=function(a){a?(this.h.info("Successfully pinged google.com"),ie(2)):(this.h.info("Failed to ping google.com"),ie(1))},(r=is.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},os.prototype.g=function(a,b){return new as(a,b)},T(as,Ct),as.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,t=this.h||void 0;a.Wa&&(a.h.info("Origin Trials enabled."),Vt(q(a.hb,a,b))),ie(0),a.W=b,a.aa=t||{},a.N=a.X,a.F=ss(a,null,a.W),Gn(a)},as.prototype.close=function(){Un(this.g)},as.prototype.u=function(a){if("string"==typeof a){var b={};b.__data__=a,Kn(this.g,b)}else this.v?((b={}).__data__=Ot(a),Kn(this.g,b)):Kn(this.g,a)},as.prototype.M=function(){this.g.j=null,delete this.j,Un(this.g),delete this.g,as.Z.M.call(this)},T(cs,me),T(us,pe),T(hs,is),hs.prototype.xa=function(){Dt(this.g,"a")},hs.prototype.wa=function(a){Dt(this.g,new cs(a))},hs.prototype.va=function(a){Dt(this.g,new us(a))},hs.prototype.ua=function(){Dt(this.g,"b")},os.prototype.createWebChannel=os.prototype.g,as.prototype.send=as.prototype.u,as.prototype.open=as.prototype.m,as.prototype.close=as.prototype.close,ce.NO_ERROR=0,ce.TIMEOUT=8,ce.HTTP_ERROR=6,ue.COMPLETE="complete",de.EventType=ge,ge.OPEN="a",ge.CLOSE="b",ge.ERROR="c",ge.MESSAGE="d",Ct.prototype.listen=Ct.prototype.N,_n.prototype.listenOnce=_n.prototype.O,_n.prototype.getLastError=_n.prototype.La,_n.prototype.getLastErrorCode=_n.prototype.Da,_n.prototype.getStatus=_n.prototype.ba,_n.prototype.getResponseJson=_n.prototype.Qa,_n.prototype.getResponseText=_n.prototype.ga,_n.prototype.send=_n.prototype.ea;var ls=c.createWebChannelTransport=function(){return new os},ds=c.getStatEventTarget=function(){return ee()},fs=c.ErrorCode=ce,gs=c.EventType=ue,ms=c.Event=Zt,ps=c.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},ys=c.FetchXmlHttpFactory=vn,ws=c.WebChannel=de,vs=c.XhrIo=_n}).call(this,n(61))},981:function(t,e,n){"use strict";n.r(e);var r=n(908),o=n(955),c=n(900),h=n(901);function l(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(t){this._delegate=t}static fromBase64String(t){return f(),new m(o.b.fromBase64String(t))}static fromUint8Array(t){return d(),new m(o.b.fromUint8Array(t))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function y(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const object=t;for(const t of e)if(t in object&&"function"==typeof object[t])return!0;return!1}(t,["next","error","complete"])}class w{enableIndexedDbPersistence(t,e){return Object(o.F)(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return Object(o.G)(t._delegate)}clearIndexedDbPersistence(t){return Object(o.x)(t._delegate)}}class v{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof o.m||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){Object(o.A)(this._delegate,t,e,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(t){return Object(o.Y)(this._delegate,t)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new L(this,Object(o.y)(this._delegate,t))}catch(t){throw x(t,"collection()","Firestore.collection()")}}doc(t){try{return new _(this,Object(o.E)(this._delegate,t))}catch(t){throw x(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new k(this,Object(o.z)(this._delegate,t))}catch(t){throw x(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Object(o.db)(this._delegate,(e=>t(new T(this,e))))}batch(){return Object(o.K)(this._delegate),new E(new o.l(this._delegate,(t=>Object(o.L)(this._delegate,t))))}loadBundle(t){return Object(o.V)(this._delegate,t)}namedQuery(t){return Object(o.W)(this._delegate,t).then((t=>t?new k(this,t):null))}}class I extends o.a{constructor(t){super(),this.firestore=t}convertBytes(t){return new m(new o.b(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return _.forKey(e,this.firestore,null)}}class T{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new I(t)}get(t){const e=P(t);return this._delegate.get(e).then((t=>new C(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter))))}set(t,data,e){const n=P(t);return e?(l("Transaction.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=P(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=P(t);return this._delegate.delete(e),this}}class E{constructor(t){this._delegate=t}set(t,data,e){const n=P(t);return e?(l("WriteBatch.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=P(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=P(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class S{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new o.i(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new D(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=S.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let o=r.get(e);return o||(o=new S(t,new I(t),e),r.set(e,o)),o}}S.INSTANCES=new WeakMap;class _{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new I(t)}static forPath(path,t,e){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new _(t,new o.d(t._delegate,e,new o.n(path)))}static forKey(t,e,n){return new _(e,new o.d(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new L(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new L(this.firestore,Object(o.y)(this._delegate,t))}catch(t){throw x(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=Object(c.m)(t))instanceof o.d&&Object(o.cb)(this._delegate,t)}set(t,e){e=l("DocumentReference.set",e);try{return e?Object(o.fb)(this._delegate,t,e):Object(o.fb)(this._delegate,t)}catch(t){throw x(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,t):Object(o.kb)(this._delegate,t,e,...n)}catch(t){throw x(t,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...t){const e=A(t),n=N(t,(t=>new C(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.N)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),e.then((t=>new C(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))))}withConverter(t){return new _(this.firestore,t?this._delegate.withConverter(S.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function x(t,e,n){return t.message=t.message.replace(e,n),t}function A(t){for(const e of t)if("object"==typeof e&&!y(e))return e;return{}}function N(t,e){var n,r;let o;return o=y(t[0])?t[0]:y(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{o.next&&o.next(e(t))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class C{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new _(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class D extends C{data(t){const data=this._delegate.data(t);return Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class k{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new I(t)}where(t,e,n){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(t,e,n)))}catch(t){throw x(t,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(t,e)))}catch(t){throw x(t,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(t)))}catch(t){throw x(t,"limit()","Query.limit()")}}limitToLast(t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(t)))}catch(t){throw x(t,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...t)))}catch(t){throw x(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...t)))}catch(t){throw x(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...t)))}catch(t){throw x(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...t)))}catch(t){throw x(t,"endAt()","Query.endAt()")}}isEqual(t){return Object(o.bb)(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.Q)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),e.then((t=>new R(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))))}onSnapshot(...t){const e=A(t),n=N(t,(t=>new R(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))));return Object(o.X)(this._delegate,e,n)}withConverter(t){return new k(this.firestore,t?this._delegate.withConverter(S.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class O{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new D(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class R{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new k(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((t=>new D(this._firestore,t)))}docChanges(t){return this._delegate.docChanges(t).map((t=>new O(this._firestore,t)))}forEach(t,e){this._delegate.forEach((n=>{t.call(e,new D(this._firestore,n))}))}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class L extends k{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new _(this.firestore,t):null}doc(t){try{return new _(this.firestore,void 0===t?Object(o.E)(this._delegate):Object(o.E)(this._delegate,t))}catch(t){throw x(t,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((t=>new _(this.firestore,t)))}isEqual(t){return Object(o.cb)(this._delegate,t._delegate)}withConverter(t){return new L(this.firestore,t?this._delegate.withConverter(S.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function P(t){return Object(o.p)(t,o.d)}class M{constructor(...t){this._delegate=new o.f(...t)}static documentId(){return new M(o.o.keyField().canonicalString())}isEqual(t){return(t=Object(c.m)(t))instanceof o.f&&this._delegate._internalPath.isEqual(t._internalPath)}}class F{constructor(t){this._delegate=t}static serverTimestamp(){const t=Object(o.eb)();return t._methodName="FieldValue.serverTimestamp",new F(t)}static delete(){const t=Object(o.C)();return t._methodName="FieldValue.delete",new F(t)}static arrayUnion(...t){const e=Object(o.w)(...t);return e._methodName="FieldValue.arrayUnion",new F(e)}static arrayRemove(...t){const e=Object(o.v)(...t);return e._methodName="FieldValue.arrayRemove",new F(e)}static increment(t){const e=Object(o.S)(t);return e._methodName="FieldValue.increment",new F(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const V={Firestore:v,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:T,WriteBatch:E,DocumentReference:_,DocumentSnapshot:C,Query:k,QueryDocumentSnapshot:D,QuerySnapshot:R,CollectionReference:L,FieldPath:M,FieldValue:F,setLogLevel:function(t){Object(o.gb)(t)},CACHE_SIZE_UNLIMITED:o.c};var U,j;U=r.a,j=(t,e)=>new v(t,e,new w),U.INTERNAL.registerComponent(new h.a("firestore-compat",(t=>{const e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("firestore").getImmediate();return j(e,n)}),"PUBLIC").setServiceProps(Object.assign({},V))),U.registerVersion("@firebase/firestore-compat","0.1.14")}}]);
//# sourceMappingURL=2fdbe2b.js.map